"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Helpers){class InteractiveWritePrompt extends Helpers.OkCancelPrompt{constructor(symbol,options,parentControl){super(parentControl);let guid=tchmi_create_guid(),localization=new TcHmi.Locale.PackageLocalization("Beckhoff.TwinCAT.HMI.Controls");this.__symbolName=symbol.name,this.__options=options??null,this.__schema=null;let symbolMetaData=symbol.metaData;if(symbolMetaData&&(this.__reauthenticationRequired=symbolMetaData.reauthenticationRequired??!1,this.__commentRequired=symbolMetaData.auditTrail?.commentRequired??!1),this.__controlTextblockMessageGeneral=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Message_Overview_"+guid,{"data-tchmi-width":240,"data-tchmi-height-mode":"Content","data-tchmi-width-mode":"Content","data-tchmi-word-wrap":!0,"data-tchmi-visibility":"Collapsed"},this.__parentControl)??null,this.__controlTextblockMessageGeneral){let elementTextblockMessage=this.__controlTextblockMessageGeneral.getElement()[0];elementTextblockMessage&&(elementTextblockMessage.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message"),this.__elementContent.appendChild(elementTextblockMessage))}let elementLoadingSpinnerContainerContainer=document.createElement("div");elementLoadingSpinnerContainerContainer.innerHTML='<div class="TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Loading-Spinner-Container"><div class="TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Loading-Spinner"><div></div><div></div><div></div><div></div></div></div>',elementLoadingSpinnerContainerContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Loading-Spinner-Container-Container"),this.__elementLoadingSpinnerContainerContainer=elementLoadingSpinnerContainerContainer;let elementHeadlineContainer=document.createElement("div");elementHeadlineContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Headline-Container");let elementHeadline=document.createElement("h2");elementHeadline.textContent=this.__symbolName;let elementProgressContainer=document.createElement("div");elementProgressContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Container"),this.__elementProgressContainer=elementProgressContainer,elementHeadlineContainer.appendChild(elementHeadline),elementHeadlineContainer.appendChild(elementProgressContainer),this.__elementContent.appendChild(elementHeadlineContainer);let controlTextblockMessage=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Message_"+guid,{"data-tchmi-width":240,"data-tchmi-height-mode":"Content","data-tchmi-width-mode":"Content","data-tchmi-word-wrap":!0,"data-tchmi-visibility":"Collapsed"},this.__parentControl);this.__controlTextblockMessage=controlTextblockMessage??null;let elementTextblockMessage=controlTextblockMessage?.getElement()[0];elementTextblockMessage&&(elementTextblockMessage.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message"),this.__elementContent.appendChild(elementTextblockMessage));let controlTextblockDomainLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Auth_Domain_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_Domain%/l%"},this.__parentControl);this.__controlTextblockDomainLabel=controlTextblockDomainLabel??null;let controlComboboxDomain=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox","InteractiveWritePrompt_Combobox_Domain_"+guid,{"data-tchmi-width":240,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-allow-text-input":!0,"data-tchmi-combobox-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Combobox_Domain_Text%/l%"},this.__parentControl);this.__controlComboboxDomain=controlComboboxDomain??null;let controlInputUsername,controlComboboxUsername,controlTextblockUsernameLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Username_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_Username%/l%"},this.__parentControl);this.__controlTextblockUsernameLabel=controlTextblockUsernameLabel??null,controlInputUsername=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput","InteractiveWritePrompt_Input_Username_"+guid,{"data-tchmi-width":240,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl),this.__controlInputUsername=controlInputUsername??null,"Input"!==this.__options?.authOptions?.usernameSelection&&(controlComboboxUsername=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox","InteractiveWritePrompt_Combobox_Username_"+guid,{"data-tchmi-width":240,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-allow-text-input":!0,"data-tchmi-combobox-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Combobox_Username_Text%/l%"},this.__parentControl),this.__controlComboboxUsername=controlComboboxUsername??null);let controlTextblockPasswordLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Password_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_Password%/l%"},this.__parentControl);this.__controlTextblockPasswordLabel=controlTextblockPasswordLabel??null;let controlInputPassword=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput","InteractiveWritePrompt_Password_"+guid,{"data-tchmi-width":240,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);this.__controlInputPassword=controlInputPassword??null;let elementTextblockDomainLabel=controlTextblockDomainLabel?.getElement()[0];elementTextblockDomainLabel&&(elementTextblockDomainLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockDomainLabel));let elementComboboxDomain=controlComboboxDomain?.getElement()[0];elementComboboxDomain&&(elementComboboxDomain.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Auth-Combobox-Username"),this.__elementContent.appendChild(elementComboboxDomain));let elementTextblockUsernameLabel=controlTextblockUsernameLabel?.getElement()[0];if(elementTextblockUsernameLabel&&(elementTextblockUsernameLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockUsernameLabel)),"Input"===this.__options?.authOptions?.usernameSelection){let elementInputUsername=controlInputUsername?.getElement()[0];elementInputUsername&&(elementInputUsername.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Auth-Input-Username"),this.__elementContent.appendChild(elementInputUsername))}else{let elementComboboxUsername=controlComboboxUsername?.getElement()[0];elementComboboxUsername&&(elementComboboxUsername.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Auth-Combobox-Username"),this.__elementContent.appendChild(elementComboboxUsername))}let elementTextblockPasswordLabel=controlTextblockPasswordLabel?.getElement()[0];elementTextblockPasswordLabel&&(elementTextblockPasswordLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockPasswordLabel));let controlTextblockPrevValueLabel,controlTextblockNewValueLabel,controlTextblockCommentLabel,controlTextboxComment,elementInputPassword=controlInputPassword?.getElement()[0];elementInputPassword&&(elementInputPassword.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Auth-Input-Password"),this.__elementContent.appendChild(elementInputPassword)),controlTextblockPrevValueLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_PrevValue_Label_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_PrevValue%/l%"},this.__parentControl),this.__controlTextblockPrevValueLabel=controlTextblockPrevValueLabel??null,controlTextblockNewValueLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_NewValue_Label_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_NewValue%/l%"},this.__parentControl),this.__controlTextblockNewValueLabel=controlTextblockNewValueLabel??null,controlTextblockCommentLabel=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextblock","InteractiveWritePrompt_Textblock_Comment_Label_"+guid,{"data-tchmi-width":240,"data-tchmi-height":20,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_InteractiveWritePrompt_Label_Comment%/l%"},this.__parentControl),this.__controlTextblockCommentLabel=controlTextblockCommentLabel??null,controlTextboxComment=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox","InteractiveWritePrompt_Textbox_Comment_"+guid,{"data-tchmi-width":240,"data-tchmi-height":150,"data-tchmi-content-padding":{left:3,right:3,top:3,bottom:3},"data-tchmi-multiline":!0,"data-tchmi-vertical-scroll":"Auto","data-tchmi-horizontal-scroll":"Auto"},this.__parentControl),this.__controlTextboxComment=controlTextboxComment??null,symbol.comment&&this.__controlTextboxComment?.setText(symbol.comment);let elementTextblockPrevValueLabel=controlTextblockPrevValueLabel?.getElement()[0];elementTextblockPrevValueLabel&&(elementTextblockPrevValueLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockPrevValueLabel));let elementPrevValueEditorContainer=document.createElement("div");elementPrevValueEditorContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Editor-Container"),this.__elementPrevValueEditorContainer=elementPrevValueEditorContainer,this.__elementContent.appendChild(elementPrevValueEditorContainer);let elementTextblockNewValueLabel=controlTextblockNewValueLabel?.getElement()[0];elementTextblockNewValueLabel&&(elementTextblockNewValueLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockNewValueLabel));let elementNewValueEditorContainer=document.createElement("div");elementNewValueEditorContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Editor-Container"),this.__elementNewValueEditorContainer=elementNewValueEditorContainer,this.__elementContent.appendChild(elementNewValueEditorContainer);let elementTextblockCommentLabel=controlTextblockCommentLabel?.getElement()[0];elementTextblockCommentLabel&&(elementTextblockCommentLabel.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Label"),this.__elementContent.appendChild(elementTextblockCommentLabel));let elementControlTextboxComment=controlTextboxComment?.getElement()[0];elementControlTextboxComment&&(elementControlTextboxComment.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Auth-Textbox-Comment"),this.__elementContent.appendChild(elementControlTextboxComment)),this.__destroyComboboxDomainSelectionChanged=TcHmi.EventProvider.register("InteractiveWritePrompt_Combobox_Domain_"+guid+".onSelectionChanged",this.__onComboboxDomainSelectionChanged()),this.__elementContent.appendChild(document.createElement("br")),this.__hideSymbolControls(),this.__showSymbolLoading(),this.__disableSymbolControls(),TcHmi.Server.resolveSymbolSchema(this.__symbolName,(data=>{if(!this.__done){if(data.error!==TcHmi.Errors.NONE||!data.schema){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init")+"\n";return data.error!==TcHmi.Errors.NONE?data.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(data.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+data.error:message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SCHEMA_INVALID,message:TcHmi.Errors[TcHmi.Errors.E_SCHEMA_INVALID],domain:"TcHmi.Controls.Helpers.InteractiveWritePrompt"}),this.__showSymbolError(message),this.__disableSymbolControls(),void this.__hideSymbolControls()}{if(this.__schema=data.schema,this.__elementPrevValueEditorContainer&&!this.__schema.function){let editorInfoPrevValue=Helpers.SchemaParser.parse(this.__schema),editorPrevValue=Helpers.Editor.create(this.__elementPrevValueEditorContainer,editorInfoPrevValue,this.__parentControl);editorPrevValue.setIsEnabled(!0),editorPrevValue.setIsReadOnly(!0),this.__editorPrevValue=editorPrevValue,this.__texts&&void 0!==this.__texts.editorTexts&&null!==this.__texts.editorTexts&&this.__editorPrevValue.setLocalizations(this.__texts.editorTexts)}if(this.__elementNewValueEditorContainer){let editorInfoNewValue=Helpers.SchemaParser.parse(this.__schema),editorNewValue=Helpers.Editor.create(this.__elementNewValueEditorContainer,editorInfoNewValue,this.__parentControl);editorNewValue.setIsEnabled(!0),editorNewValue.setValue(symbol.writeValue),this.__editorNewValue=editorNewValue,this.__texts&&void 0!==this.__texts.editorTexts&&null!==this.__texts.editorTexts&&this.__editorNewValue.setLocalizations(this.__texts.editorTexts)}if(this.__schema&&!this.__schema.function){let requestSymbolData={requestType:"ReadWrite",commands:[]};this.__symbolName&&requestSymbolData.commands?.push({commandOptions:["SendErrorMessage"],symbol:this.__symbolName}),TcHmi.Server.requestEx(requestSymbolData,options?.requestOptions??null,(data=>{if(this.__done)return;if(data.error!==TcHmi.Errors.NONE){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init")+"\n";return data.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(data.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+data.error,this.__showSymbolError(message),this.__disableSymbolControls(),void this.__hideSymbolControls()}if(!data.results){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init")+"\n"+localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init_Unexpected_Result_Object_1");return this.__showSymbolError(message),this.__disableSymbolControls(),void this.__hideSymbolControls()}let result=data.results[0];if(!result){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init")+".\n"+localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+localization.getText("Popup_InteractiveWritePrompt_Message_Error_Init_Unexpected_Result_Object_2");return this.__showSymbolError(message),this.__disableSymbolControls(),void this.__hideSymbolControls()}this.__editorPrevValue?.setValue(result.value),this.__showSymbolReady(),this.__enableSymbolControls(),this.__showSymbolControls(),this.__okButton.setIsEnabled(!0)}))}else this.__showSymbolReady(),this.__enableSymbolControls(),this.__showSymbolControls(),this.__okButton.setIsEnabled(!0);let requestDomainData={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:"ListDomains"}]};TcHmi.Server.requestEx(requestDomainData,options?.requestOptions??null,(data=>{if(this.__done)return;if(data.error!==TcHmi.Errors.NONE)return;if(!data.results)return;let result=data.results[0];if(!result)return;if(result.error!==TcHmi.Errors.NONE)return;if(!result.value)return;let domains=[];for(const[name,domain]of Object.entries(result.value))domain&&domain.authExtension&&domains.push(name);if(domains){for(let domain of domains)this.__domainUserNames??={},this.__domainUserNames[domain]=[];domains.length>1?this.__controlComboboxDomain?.setSrcData(domains):(this.__controlComboboxDomain?.getElement()[0].remove(),this.__controlTextblockDomainLabel?.getElement()[0].remove())}TcHmi.Server.requestEx({requestType:"ReadWrite",commands:[{symbol:"ListUserNames"},{symbol:"DefaultAuthExtension"}]},options?.requestOptions??null,(data=>{if(this.__done)return;if(data.error!==TcHmi.Errors.NONE)return;if(!data.results)return;if(!data.results[0])return;let usernames=[];for(let result of data.results)result.error===TcHmi.Errors.NONE&&result.symbol&&("DefaultAuthExtension"===result.symbol?this.__defaultDomain=result.value:"ListUserNames"===result.symbol&&(usernames=result.value));for(let username of usernames){let token=username.split("::"),tokenDomain=null,tokenUsername=null;2===token.length?(tokenDomain=token[0],tokenUsername=token[1]):1===token.length&&(tokenDomain=this.__defaultDomain,tokenUsername=token[0]),tokenDomain&&tokenUsername&&this.__domainUserNames&&this.__domainUserNames[tokenDomain]&&this.__domainUserNames[tokenDomain].push(tokenUsername)}let currentUserConfig=TcHmi.Server.getCurrentUserConfig(),currentUserDomain=currentUserConfig.domain,currentUser=currentUserConfig.name;if(currentUserDomain&&this.__domainUserNames&&this.__domainUserNames[currentUserDomain]&&(this.__targetDomain=currentUserDomain),!this.__targetDomain)if(this.__defaultDomain&&this.__domainUserNames&&this.__domainUserNames[this.__defaultDomain])this.__targetDomain=this.__defaultDomain;else for(let key in this.__domainUserNames){this.__targetDomain=key;break}if(this.__targetDomain){let comboboxDomainSelectedIndex=this.__controlComboboxDomain?.getSelectedIndex(),comboboxDomainData=this.__controlComboboxDomain?.getSrcData();if(comboboxDomainData&&comboboxDomainData.length>0){let domainIndex=comboboxDomainData.indexOf(this.__targetDomain);-1!==domainIndex&&domainIndex!==comboboxDomainSelectedIndex&&this.__controlComboboxDomain?.setSelectedIndex(domainIndex)}if(this.__domainUserNames){let usernames=this.__domainUserNames[this.__targetDomain];if(usernames&&usernames.length>0){if(this.__controlComboboxUsername&&(this.__controlComboboxUsername.setSelectedIndex(null),this.__controlComboboxUsername.setText(null),this.__controlComboboxUsername.setSrcData(usernames),currentUser&&currentUserDomain===this.__targetDomain)){let currentUserIndex=usernames.indexOf(currentUser);currentUserIndex>-1&&this.__controlComboboxUsername.setSelectedIndex(currentUserIndex)}}else this.__controlComboboxUsername&&this.__controlInputUsername&&this.__controlComboboxUsername.getIsAttached()&&this.__controlComboboxUsername.getElement()[0].replaceWith(this.__controlInputUsername.getElement()[0])}}}))}))}}}))}__texts=null;__controlTextblockMessageGeneral=null;__options=null;__symbolName=null;__schema=null;__reauthenticationRequired=!1;__commentRequired=!1;__domainUserNames=null;__defaultDomain=null;__targetDomain=null;__result;__error=null;__done=!1;__editorNewValue=null;__editorPrevValue=null;__controlTextblockMessage=null;__controlTextboxComment=null;__controlInputUsername=null;__controlComboboxUsername=null;__controlInputPassword=null;__controlTextblockDomainLabel=null;__controlComboboxDomain=null;__controlTextblockUsernameLabel=null;__controlTextblockPrevValueLabel=null;__controlTextblockNewValueLabel=null;__controlTextblockCommentLabel=null;__controlTextblockPasswordLabel=null;__elementNewValueEditorContainer=null;__elementPrevValueEditorContainer=null;__elementProgressContainer=null;__elementLoadingSpinnerContainerContainer=null;__destroyComboboxDomainSelectionChanged=null;destroy(force=!1){super.destroy(force),this.__controlTextblockMessageGeneral?.destroy(),this.__controlTextblockMessageGeneral=null,this.__controlComboboxUsername?.destroy(),this.__controlComboboxUsername=null,this.__controlInputPassword?.destroy(),this.__controlInputPassword=null,this.__controlInputUsername?.destroy(),this.__controlInputUsername=null,this.__controlTextblockCommentLabel?.destroy(),this.__controlTextblockCommentLabel=null,this.__controlTextblockMessage?.destroy(),this.__controlTextblockMessage=null,this.__controlTextblockNewValueLabel?.destroy(),this.__controlTextblockNewValueLabel=null,this.__controlTextblockPrevValueLabel?.destroy(),this.__controlTextblockPrevValueLabel=null,this.__controlTextblockDomainLabel?.destroy(),this.__controlTextblockDomainLabel=null,this.__controlComboboxDomain?.destroy(),this.__controlComboboxDomain=null,this.__controlTextblockUsernameLabel?.destroy(),this.__controlTextblockUsernameLabel=null,this.__controlTextblockPasswordLabel?.destroy(),this.__controlTextblockPasswordLabel=null,this.__controlTextboxComment?.destroy(),this.__controlTextboxComment=null,this.__editorPrevValue?.destroy(),this.__editorPrevValue=null,this.__editorNewValue?.destroy(),this.__editorNewValue=null,this.__destroyComboboxDomainSelectionChanged?.()}__onComboboxDomainSelectionChanged(){return(e,data)=>{if(!data)return;if(!data.text)return;if(this.__targetDomain=data.text,!this.__domainUserNames)return;this.__controlComboboxUsername?.setSelectedIndex(null),this.__controlComboboxUsername?.setText(null);let usernames=this.__domainUserNames[this.__targetDomain];if(!usernames||0===usernames.length)return this.__controlComboboxUsername?.setSrcData(null),void(this.__controlComboboxUsername&&this.__controlInputUsername&&this.__controlComboboxUsername.getIsAttached()&&this.__controlComboboxUsername.getElement()[0].replaceWith(this.__controlInputUsername.getElement()[0]));if(this.__controlComboboxUsername&&this.__controlInputUsername&&this.__controlInputUsername.getIsAttached()&&this.__controlInputUsername.getElement()[0].replaceWith(this.__controlComboboxUsername.getElement()[0]),this.__controlComboboxUsername){this.__controlComboboxUsername.setSelectedIndex(null),this.__controlComboboxUsername.setText(null),this.__controlComboboxUsername.setSrcData(usernames);let currentUserConfig=TcHmi.Server.getCurrentUserConfig(),currentUser=currentUserConfig.name,currentUserDomain=currentUserConfig.domain;if(currentUser&&currentUserDomain===this.__targetDomain){let currentUserIndex=usernames.indexOf(currentUser);currentUserIndex>-1&&this.__controlComboboxUsername.setSelectedIndex(currentUserIndex)}}}}__ok(){this.__okButton.setIsEnabled(!1);let host,port,localization=new TcHmi.Locale.PackageLocalization("Beckhoff.TwinCAT.HMI.Controls"),protocol=window.location.protocol,baseUri=TcHmi.Environment.getHostBaseUri();const tchmiConfigOverride=TCHMI_CONFIG_OVERRIDE;tchmiConfigOverride?.tcHmiServer?.websocketOverwrite&&(protocol=window.location.protocol,host=tchmiConfigOverride.tcHmiServer.websocketOverwrite.host??window.location.host,port=tchmiConfigOverride.tcHmiServer.websocketOverwrite.port,baseUri=protocol+"//"+host+(port?":"+port:""));let websocketUri=baseUri.replace("http:","ws:").replace("https:","wss:"),done=()=>{this.__done?this.__prompt?.answer({isOk:!0,value:{result:this.__result}}):this.__okButton.setIsEnabled(!0)};if(this.__done)return void done();if(!this.__symbolName)return void done();let username,password,handshakeRequest={requestType:"ReadWrite",id:1,commands:[{commandOptions:["ProcessTimingAsTimespan","SendErrorMessage"],symbol:"__FrameworkHandshake",writeValue:{frameworkApiVersion:"1.0.0.0"}}]},request={requestType:"ReadWrite",id:2,commands:[]};if(this.__showSymbolLoading(),this.__disableSymbolControls(),this.__reauthenticationRequired&&this.__controlInputUsername&&this.__controlInputUsername.getIsAttached()){let text=this.__controlInputUsername.getText();null!=text&&(username=text)}if(this.__reauthenticationRequired&&this.__controlComboboxUsername&&this.__controlComboboxUsername.getIsAttached()){let text=this.__controlComboboxUsername.getText();null!=text&&(username=text)}if(username&&this.__targetDomain!==this.__defaultDomain&&(username=this.__targetDomain+"::"+username),this.__reauthenticationRequired&&this.__controlInputPassword){let text=this.__controlInputPassword.getText();null!=text&&(password=text)}let writeValue,comment=null;if(this.__controlTextboxComment&&(comment=this.__controlTextboxComment.getText()??null),this.__editorNewValue&&(writeValue=this.__editorNewValue.getState()),!writeValue||!writeValue.isValid){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Value_Invalid")+"\n";return this.__showSymbolError(message),this.__enableSymbolControls(),this.__showSymbolControls(),void done()}if(this.__reauthenticationRequired){let commandLogin={commandOptions:["SendErrorMessage"],symbol:"Login",writeValue:{userName:username,password:password,persistPreviousSession:!0}};request.commands?.push(commandLogin)}let commandWrite={commandOptions:["SendErrorMessage"],symbol:this.__symbolName,writeValue:writeValue.value};this.__commentRequired&&comment&&(commandWrite.extensionData={TcHmiAuditTrail:{comment:comment}}),request.commands?.push(commandWrite);let websocket=new WebSocket(websocketUri);websocket.onopen=e=>{websocket?.send(JSON.stringify(handshakeRequest))},websocket.onclose=e=>{this.__result={error:TcHmi.Errors.E_WEBSOCKET_CLOSED,details:{code:TcHmi.Errors.E_WEBSOCKET_CLOSED,message:TcHmi.Errors[TcHmi.Errors.E_WEBSOCKET_CLOSED],reason:"The underlying websocket was closed.",domain:"TcHmi.Controls.Helpers.InteractiveWritePrompt"}},websocket?.close(),websocket=null,done()},websocket.onmessage=e=>{const response=TcHmi.ValueConverter.toObject(e.data,null);response?TcHmi.Server.handleResponse({completed:data=>{if(data.error!==TcHmi.Errors.NONE){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Write")+".\n";return data.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(data.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+data.error,this.__showSymbolError(message),this.__enableSymbolControls(),this.__showSymbolControls(),void done()}if(!data.results||!data.results)return websocket?.close(),websocket=null,void done();const handshakeResponse=data.results.find((result=>"__FrameworkHandshake"===result.symbol));if(handshakeResponse){if(handshakeResponse.error!==TcHmi.Errors.NONE){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Write")+".\n";return handshakeResponse.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(handshakeResponse.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+handshakeResponse.error,this.__showSymbolError(message),this.__enableSymbolControls(),this.__showSymbolControls(),websocket?.close(),websocket=null,void done()}return void websocket?.send(JSON.stringify(request))}if(this.__reauthenticationRequired){let resultLogin=data.results[0];if(!resultLogin)return websocket?.close(),websocket=null,void done();if(resultLogin.error!==TcHmi.Errors.NONE){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Login")+".\n";return resultLogin.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(resultLogin.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+data.error,this.__showSymbolError(message),this.__enableSymbolControls(),this.__showSymbolControls(),websocket?.close(),websocket=null,void done()}}let resultWrite=data.results[data.results.length-1];if(!resultWrite)return websocket?.close(),websocket=null,void done();if(!resultWrite.symbol)return websocket?.close(),websocket=null,void done();if(this.__reauthenticationRequired&&resultWrite.response?.commands.shift(),this.__result=resultWrite,resultWrite.error!==TcHmi.Errors.NONE){let message=localization.getText("Popup_InteractiveWritePrompt_Message_Error_Write")+".\n";return resultWrite.details?message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Details")+": "+TcHmi.Log.buildMessage(resultWrite.details):message+=localization.getText("Popup_InteractiveWritePrompt_Message_Label_Error")+": "+resultWrite.error,this.__showSymbolError(message),this.__enableSymbolControls(),this.__showSymbolControls(),websocket?.close(),websocket=null,void done()}this.__done=!0,this.__showSymbolSuccess(),this.__disableSymbolControls(),this.__showSymbolControls(),websocket?.close(),websocket=null,done()}})({error:TcHmi.Errors.NONE,response:response}):done()}}__cancel(){this.__prompt?.answer({isOk:!1,value:{result:this.__result}})}__showError(message){if(this.__controlTextblockMessageGeneral){let elementTextblockMessage=this.__controlTextblockMessageGeneral.getElement()[0];elementTextblockMessage&&elementTextblockMessage.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message-Error"),this.__controlTextblockMessageGeneral.setText(message),this.__controlTextblockMessageGeneral.setVisibility("Visible")}}__clearError(){if(this.__controlTextblockMessageGeneral){let elementTextblockMessage=this.__controlTextblockMessageGeneral.getElement()[0];elementTextblockMessage&&elementTextblockMessage.classList.remove("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message-Error"),this.__controlTextblockMessageGeneral.setText(""),this.__controlTextblockMessageGeneral.setVisibility("Collapsed")}}__enableSymbolControls(){this.__reauthenticationRequired&&(this.__controlComboboxDomain?.setIsEnabled(!0),this.__controlInputUsername?.setIsEnabled(!0),this.__controlComboboxUsername?.setIsEnabled(!0),this.__controlInputPassword?.setIsEnabled(!0)),this.__commentRequired&&this.__controlTextboxComment?.setIsEnabled(!0),this.__editorNewValue?.setIsEnabled(!0)}__disableSymbolControls(){this.__controlComboboxDomain?.setIsEnabled(!1),this.__controlInputUsername?.setIsEnabled(!1),this.__controlComboboxUsername?.setIsEnabled(!1),this.__controlInputPassword?.setIsEnabled(!1),this.__controlTextboxComment?.setIsEnabled(!1),this.__editorNewValue?.setIsEnabled(!1)}__showSymbolControls(){this.__reauthenticationRequired&&(this.__controlTextblockDomainLabel?.setVisibility("Visible"),this.__controlComboboxDomain?.setVisibility("Visible"),this.__controlTextblockUsernameLabel?.setVisibility("Visible"),this.__controlComboboxUsername?.setVisibility("Visible"),this.__controlInputUsername?.setVisibility("Visible"),this.__controlTextblockPasswordLabel?.setVisibility("Visible"),this.__controlInputPassword?.setVisibility("Visible")),this.__commentRequired&&(this.__controlTextboxComment?.setVisibility("Visible"),this.__controlTextblockCommentLabel?.setVisibility("Visible")),this.__schema&&!this.__schema.function&&(this.__controlTextblockPrevValueLabel?.setVisibility("Visible"),this.__editorPrevValue?.setVisibility("Visible")),this.__controlTextblockNewValueLabel?.setVisibility("Visible"),this.__editorNewValue?.setVisibility("Visible")}__hideSymbolControls(){this.__controlTextblockDomainLabel?.setVisibility("Collapsed"),this.__controlComboboxDomain?.setVisibility("Collapsed"),this.__controlTextblockUsernameLabel?.setVisibility("Collapsed"),this.__controlComboboxUsername?.setVisibility("Collapsed"),this.__controlInputUsername?.setVisibility("Collapsed"),this.__controlTextblockPasswordLabel?.setVisibility("Collapsed"),this.__controlInputPassword?.setVisibility("Collapsed"),this.__controlTextboxComment?.setVisibility("Collapsed"),this.__controlTextblockCommentLabel?.setVisibility("Collapsed"),this.__controlTextblockPrevValueLabel?.setVisibility("Collapsed"),this.__editorPrevValue?.setVisibility("Collapsed"),this.__controlTextblockNewValueLabel?.setVisibility("Collapsed"),this.__editorNewValue?.setVisibility("Collapsed")}__showSymbolLoading(){if(this.__elementProgressContainer&&this.__elementLoadingSpinnerContainerContainer&&(this.__elementProgressContainer.classList.remove("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Success","TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Failure"),this.__elementProgressContainer.appendChild(this.__elementLoadingSpinnerContainerContainer)),this.__controlTextblockMessage){let elementTextblockMessage=this.__controlTextblockMessage.getElement()[0];elementTextblockMessage&&elementTextblockMessage.classList.remove("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message-Error"),this.__controlTextblockMessage.setText(""),this.__controlTextblockMessage.setVisibility("Collapsed")}}__showSymbolError(message){if(this.__elementLoadingSpinnerContainerContainer?.remove(),this.__elementProgressContainer&&this.__elementProgressContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Failure"),this.__controlTextblockMessage){let elementTextblockMessage=this.__controlTextblockMessage.getElement()[0];elementTextblockMessage&&elementTextblockMessage.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message-Error"),this.__controlTextblockMessage.setText(message),this.__controlTextblockMessage.setVisibility("Visible")}}__showSymbolSuccess(){this.__elementLoadingSpinnerContainerContainer?.remove(),this.__disableSymbolControls(),this.__elementProgressContainer&&this.__elementProgressContainer.classList.add("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Success")}__showSymbolReady(){if(this.__elementLoadingSpinnerContainerContainer?.remove(),this.__elementProgressContainer&&this.__elementProgressContainer.classList.remove("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Success","TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Symbol-Progress-Failure"),this.__controlTextblockMessage){let elementTextblockMessage=this.__controlTextblockMessage.getElement()[0];elementTextblockMessage&&elementTextblockMessage.classList.remove("TcHmi_Controls_Helpers_Popup_InteractiveWritePrompt-Message-Error"),this.__controlTextblockMessage.setText(""),this.__controlTextblockMessage.setVisibility("Collapsed")}}setTexts(texts){super.setTexts(texts),this.__texts=texts,this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader),void 0!==texts.editorTexts&&null!==texts.editorTexts&&(this.__editorPrevValue&&void 0!==texts.editorTexts&&null!==texts.editorTexts&&this.__editorPrevValue.setLocalizations(texts.editorTexts),this.__editorNewValue&&void 0!==texts.editorTexts&&null!==texts.editorTexts&&this.__editorNewValue.setLocalizations(texts.editorTexts))}}Helpers.InteractiveWritePrompt=InteractiveWritePrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));