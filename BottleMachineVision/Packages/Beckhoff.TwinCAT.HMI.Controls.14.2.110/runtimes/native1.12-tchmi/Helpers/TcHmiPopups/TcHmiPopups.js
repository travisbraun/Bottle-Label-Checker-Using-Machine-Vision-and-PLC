"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Helpers){class Popup{__parentControl;static#tchmiFQN="TcHmi.Controls.Helpers."+this.name;__name;__element;__elementHeaderContainer;__elementHeader;__elementClose;__elementContent;__elementFooter;__childControls=[];__destroyers=[];__prompt=null;__isShowing=!1;__onShowManager=new Helpers.CallbackManager;onShow=this.__onShowManager.getManipulators();__onHideManager=new Helpers.CallbackManager;onHide=this.__onHideManager.getManipulators();__onBoundsChangeManager=new Helpers.CallbackManager;onBoundsChange=this.__onBoundsChangeManager.getManipulators();__backgroundAction={close:!0};__closeButton={show:!1};__backgroundMode=Popup.BackgroundMode.Dimmed;__positioningMode=Popup.PositioningMode.Centered;__bounds=null;__movable=!1;__justAbove;__className="TcHmi_Controls_Helpers_Popup";__localizationSymbols=new Map;__eventHandlers={onCloseClick:this.__onCloseClick.bind(this),onPopupMouseDown:this.__onPopupMouseDown.bind(this),onDocumentMouseMove:this.__onDocumentMouseMove.bind(this),onDocumentMouseUp:this.__onDocumentMouseUp.bind(this),onPopupTouchStart:this.__onPopupTouchStart.bind(this),onDocumentTouchMove:this.__onDocumentTouchMove.bind(this),onDocumentTouchEndOrCancel:this.__onDocumentTouchEndOrCancel.bind(this)};static __passiveEventOptions={passive:!0,capture:!1};__touchLock=!1;__touchLockTimeoutId=0;__activeTouches=new Map;__movingInfo={moving:!1,startLeftOffset:0,startTopOffset:0,minLeft:0,minTop:0,maxLeft:0,maxTop:0};__activePointerInteraction=!1;__animationFrameId=0;__storage;__storageSettings;__resizeObserver;constructor(__parentControl){this.__parentControl=__parentControl,this.__name=`${this.constructor.name}-${tchmi_create_guid()}`,this.__parentControl&&(this.__name=`${this.__parentControl.getId()}.${this.__name}`);const controlClass=this.__parentControl?.getType().replace(/\./g,"_");this.__element=document.createElement("div"),this.__element.classList.add(this.__className,`${this.__className}-${this.constructor.name}`),controlClass&&this.__element.classList.add(`${controlClass}-popup`),this.__elementHeaderContainer=document.createElement("div"),this.__elementHeaderContainer.classList.add(`${this.__className}-header-container`),this.__elementHeader=document.createElement("h1"),this.__elementHeaderContainer.appendChild(this.__elementHeader),this.__elementClose=document.createElement("a"),this.__element.appendChild(this.__elementHeaderContainer),this.__elementContent=document.createElement("div"),this.__elementContent.classList.add(`${this.__className}-content`),this.__element.appendChild(this.__elementContent),this.__elementFooter=document.createElement("div"),this.__elementFooter.classList.add(`${this.__className}-footer`),this.__element.appendChild(this.__elementFooter),this.__parentControl&&this.__destroyers.push(TcHmi.EventProvider.register(this.__parentControl.getId()+".onDestroyed",(()=>{this.destroy()}))),this.__elementClose.addEventListener("click",this.__eventHandlers.onCloseClick,Popup.__passiveEventOptions),this.__element.addEventListener("mousedown",this.__eventHandlers.onPopupMouseDown,Popup.__passiveEventOptions),this.__element.addEventListener("touchstart",this.__eventHandlers.onPopupTouchStart,Popup.__passiveEventOptions),this.__resizeObserver=new ResizeObserver(this.__handleResize)}__handleResize=()=>{if(!this.__isShowing)return;const boundsElement=this.__element.getBoundingClientRect(),minLeft=50-boundsElement.width,maxLeft=window.innerWidth-50,maxTop=window.innerHeight-50;if(this.__bounds){let update=!1;const newBounds=tchmi_clone_object(this.__bounds);boundsElement.top<0?(update=!0,newBounds.top=0):boundsElement.top>maxTop&&(update=!0,newBounds.top=maxTop),boundsElement.left<minLeft?(update=!0,newBounds.left=minLeft):boundsElement.left>maxLeft&&(update=!0,newBounds.left=maxLeft),update&&this.setBounds(newBounds)}};show(){if(this.__isShowing)return;this.__positioningMode===Popup.PositioningMode.Centered&&this.__movable&&TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${Popup.#tchmiFQN}${this.__parentControl?`, Id=${this.__parentControl.getId()}`:""}] Invalid popup configuration. PositionMode=Centered and Movable=true is not useful.`),this.__resizeObserver.observe(this.__element),window.addEventListener("resize",this.__handleResize,{passive:!0}),this.__isShowing=!0;const options={removeCb:data=>{data.canceled&&this.__backgroundAction.close&&this.__performPromptAction(this.__backgroundAction),this.__isShowing=!1},centerHorizontal:this.__positioningMode===Popup.PositioningMode.Centered,centerVertical:this.__positioningMode===Popup.PositioningMode.Centered,dimBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed,closeOnBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed&&this.__backgroundAction.close,modal:this.__backgroundMode===Popup.BackgroundMode.Dimmed,justAbove:this.__justAbove};this.__parentControl?TcHmi.TopMostLayer.add(this.__parentControl,this.__element,options):TcHmi.TopMostLayer.addEx(this.__element,options),this.__onShowManager.trigger()}hide(){this.__isShowing&&(this.__isShowing=!1,this.__parentControl?TcHmi.TopMostLayer.remove(this.__parentControl,this.__element):TcHmi.TopMostLayer.removeEx(this.__element),this.__resizeObserver.unobserve(this.__element),window.removeEventListener("resize",this.__handleResize),this.__onHideManager.trigger())}prompt(){return this.__prompt?.error(new Error("Popup was prompted again without the previous prompt having been resolved.")),this.show(),new Promise(((resolve,reject)=>{this.__prompt={answer:value=>{resolve(value),this.__prompt=null,this.hide()},error:value=>{reject(value),this.__prompt=null,this.hide()}}}))}abort(action){this.hide(),action&&this.__performPromptAction(action),this.__prompt?.error(new Error("Popup was aborted, but no action to answer the prompt was specified."))}destroy(force=!1){this.hide();for(const destroy of this.__destroyers)destroy();this.__destroyers=[];for(const control of this.__childControls)force&&this.__parentControl&&this.__parentControl.__removeChild(control),control.destroy();this.__childControls=[];for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear(),this.__elementClose.removeEventListener("click",this.__eventHandlers.onCloseClick,Popup.__passiveEventOptions),this.__element.removeEventListener("mousedown",this.__eventHandlers.onPopupMouseDown,Popup.__passiveEventOptions),document.removeEventListener("mouseup",this.__eventHandlers.onDocumentMouseUp,Popup.__passiveEventOptions),document.removeEventListener("mousemove",this.__eventHandlers.onDocumentMouseMove,Popup.__passiveEventOptions),this.__element.removeEventListener("touchstart",this.__eventHandlers.onPopupTouchStart,Popup.__passiveEventOptions),document.removeEventListener("touchmove",this.__eventHandlers.onDocumentTouchMove,Popup.__passiveEventOptions),document.removeEventListener("touchend",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),document.removeEventListener("touchcancel",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),this.__resizeObserver.disconnect()}isShowing(){return this.__isShowing}hasActivePrompt(){return null!==this.__prompt}getElement(){return this.__element}resetBounds(){this.__storage?.delete("bounds"),this.setBounds(null)}setBackgroundAction(action){this.__backgroundAction=action,this.__isShowing&&TcHmi.TopMostLayer.addEx(this.__element,{allowMultipleCall:!0,dimBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed,closeOnBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed&&this.__backgroundAction.close})}setBackgroundMode(mode){this.__backgroundMode=mode,this.__isShowing&&TcHmi.TopMostLayer.addEx(this.__element,{allowMultipleCall:!0,dimBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed,closeOnBackground:this.__backgroundMode===Popup.BackgroundMode.Dimmed&&this.__backgroundAction.close})}setPositioningMode(mode){this.__positioningMode=mode,this.__processBounds(this.__bounds),this.__isShowing&&TcHmi.TopMostLayer.addEx(this.__element,{allowMultipleCall:!0,centerHorizontal:this.__positioningMode===Popup.PositioningMode.Centered,centerVertical:this.__positioningMode===Popup.PositioningMode.Centered,modal:this.__positioningMode!==Popup.PositioningMode.Floating})}setBounds(bounds){this.__bounds=bounds,this.__processBounds(this.__bounds),this.__onBoundsChangeManager.trigger({bounds:this.__bounds})}__processBounds(bounds){bounds&&("number"==typeof bounds.width?this.__element.style.width=bounds.width+(bounds.widthUnit??"px"):this.__element.style.width="","number"==typeof bounds.height?this.__element.style.height=bounds.height+(bounds.heightUnit??"px"):this.__element.style.height="",this.__positioningMode===Popup.PositioningMode.Floating&&("number"==typeof bounds.left?this.__element.style.left=bounds.left+(bounds.leftUnit??"px"):this.__element.style.left="","number"==typeof bounds.top?this.__element.style.top=bounds.top+(bounds.topUnit??"px"):this.__element.style.top="","number"==typeof bounds.right?this.__element.style.right=bounds.right+(bounds.rightUnit??"px"):this.__element.style.right="","number"==typeof bounds.bottom?this.__element.style.bottom=bounds.bottom+(bounds.bottomUnit??"px"):this.__element.style.bottom=""))}setMovable(movable){this.__movable=movable,this.__movable?this.__element.style.touchAction="pinch-zoom":this.__element.style.touchAction=""}setStorageSettings(settings){if(this.__storage=new TcHmi.LocalStorage(settings.name,{bounds:tchmi_clone_object(this.__bounds)}),this.__storageSettings=settings,this.__storageSettings.restoreBounds){const storedBounds=this.__storage.get("bounds");storedBounds&&this.setBounds(storedBounds)}}setCloseButton(buttonOrShow){const button="boolean"==typeof buttonOrShow?{show:buttonOrShow}:buttonOrShow;button.show?this.__elementHeaderContainer.appendChild(this.__elementClose):this.__elementClose.remove(),this.__closeButton=button}getCloseButton(){return this.__closeButton}setJustAbove(reference,conflictResolution){if(reference){if(this.__justAbove?.reference===reference&&this.__justAbove.conflictResolution===conflictResolution)return;this.__justAbove={reference:reference,conflictResolution:conflictResolution}}else{if(!this.__justAbove)return;this.__justAbove=void 0}if(this.__isShowing){const options={allowMultipleCall:!0,justAbove:this.__justAbove};this.__parentControl?TcHmi.TopMostLayer.add(this.__parentControl,this.__element,options):TcHmi.TopMostLayer.addEx(this.__element,options)}}hasActiveUserInteraction(){return this.__activePointerInteraction||this.__element.contains(document.activeElement)}__onCloseClick(event){this.__closeButton.show&&this.__performPromptAction(this.__closeButton),this.hide()}__onPopupMouseDown(event){if(!this.__touchLock&&this.__isShowing&&(this.__activePointerInteraction=!0,document.addEventListener("mouseup",this.__eventHandlers.onDocumentMouseUp,{...Popup.__passiveEventOptions,once:!0}),event.target!==this.__elementClose&&(this.__parentControl?TcHmi.TopMostLayer.add(this.__parentControl,this.__element,{allowMultipleCall:!0}):TcHmi.TopMostLayer.addEx(this.__element,{allowMultipleCall:!0}),this.__elementHeaderContainer.contains(event.target)&&this.__movable))){document.addEventListener("mousemove",this.__eventHandlers.onDocumentMouseMove,Popup.__passiveEventOptions);const boundsElement=this.__element.getBoundingClientRect();this.__movingInfo.startLeftOffset=event.clientX-boundsElement.x,this.__movingInfo.startTopOffset=event.clientY-boundsElement.y,this.__movingInfo.minLeft=50-boundsElement.width,this.__movingInfo.maxLeft=window.innerWidth-50,this.__movingInfo.maxTop=window.innerHeight-50,this.__movingInfo.moving=!0}}__onDocumentMouseUp(event){this.__touchLock||(this.__activePointerInteraction=!1,document.removeEventListener("mousemove",this.__eventHandlers.onDocumentMouseMove,Popup.__passiveEventOptions),this.__movingInfo.moving&&(this.__movingInfo.moving=!1,this.__movingInfo.startLeftOffset=0,this.__movingInfo.startTopOffset=0,this.__bounds&&this.__movable&&(this.__storage?.set("bounds",this.__bounds),this.__onBoundsChangeManager.trigger({bounds:this.__bounds}))))}__onDocumentMouseMove(event){if(0===event.buttons)return this.__movingInfo.moving=!1,this.__movingInfo.startLeftOffset=0,this.__movingInfo.startTopOffset=0,this.__touchLock=!1,void document.removeEventListener("mousemove",this.__eventHandlers.onDocumentMouseMove,Popup.__passiveEventOptions);if(this.__touchLock)return;if(!this.__movable)return;if(!this.__movingInfo.moving)return;let left=event.clientX-this.__movingInfo.startLeftOffset;left<this.__movingInfo.minLeft?left=this.__movingInfo.minLeft:left>this.__movingInfo.maxLeft&&(left=this.__movingInfo.maxLeft);let top=event.clientY-this.__movingInfo.startTopOffset;top<this.__movingInfo.minTop?top=this.__movingInfo.minTop:top>this.__movingInfo.maxTop&&(top=this.__movingInfo.maxTop),this.__bounds||(this.__bounds={}),this.__bounds.left=left,this.__bounds.leftUnit="px",this.__bounds.top=top,this.__bounds.topUnit="px",this.__animationFrameId||(this.__animationFrameId=window.requestAnimationFrame((()=>this.__updatePosition())))}__onPopupTouchStart(event){if(this.__activePointerInteraction=!0,document.addEventListener("touchend",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),document.addEventListener("touchcancel",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),event.target!==this.__elementClose)if(this.__parentControl?TcHmi.TopMostLayer.add(this.__parentControl,this.__element,{allowMultipleCall:!0}):TcHmi.TopMostLayer.addEx(this.__element,{allowMultipleCall:!0}),this.__elementHeaderContainer.contains(event.target)){if(this.__movable){const boundsElement=this.__element.getBoundingClientRect();this.__movingInfo.moving||(document.addEventListener("touchmove",this.__eventHandlers.onDocumentTouchMove,Popup.__passiveEventOptions),this.__movingInfo.startLeftOffset=event.changedTouches[0].clientX-boundsElement.x,this.__movingInfo.startTopOffset=event.changedTouches[0].clientY-boundsElement.y,this.__movingInfo.minLeft=50-boundsElement.width,this.__movingInfo.maxLeft=window.innerWidth-50,this.__movingInfo.maxTop=window.innerHeight-50,this.__movingInfo.moving=!0);for(const touch of event.changedTouches)this.__activeTouches.set(touch.identifier,{useForDragging:!0,offsetLeft:touch.clientX-boundsElement.x,offsetTop:touch.clientY-boundsElement.y})}else for(const touch of event.changedTouches)this.__activeTouches.set(touch.identifier,{useForDragging:!1});this.__touchLockTimeoutId&&(clearTimeout(this.__touchLockTimeoutId),this.__touchLockTimeoutId=0),this.__touchLock=!0}else for(const touch of event.changedTouches)this.__activeTouches.set(touch.identifier,{useForDragging:!1});else for(const touch of event.changedTouches)this.__activeTouches.set(touch.identifier,{useForDragging:!1})}__onDocumentTouchEndOrCancel(event){for(const touch of event.changedTouches)this.__activeTouches.delete(touch.identifier);0===this.__activeTouches.size&&(document.removeEventListener("touchmove",this.__eventHandlers.onDocumentTouchMove,Popup.__passiveEventOptions),document.removeEventListener("touchend",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),document.removeEventListener("touchcancel",this.__eventHandlers.onDocumentTouchEndOrCancel,Popup.__passiveEventOptions),this.__activePointerInteraction=!1);let draggingTouchFound=!1;for(const touchInfo of this.__activeTouches.values())if(touchInfo.useForDragging){this.__movingInfo.startLeftOffset=touchInfo.offsetLeft,this.__movingInfo.startTopOffset=touchInfo.offsetTop,draggingTouchFound=!0;break}draggingTouchFound||(this.__movingInfo.moving&&(this.__movingInfo.moving=!1,this.__movingInfo.startLeftOffset=0,this.__movingInfo.startTopOffset=0,this.__bounds&&this.__movable&&(this.__storage?.set("bounds",this.__bounds),this.__onBoundsChangeManager.trigger({bounds:this.__bounds}))),this.__touchLockTimeoutId&&(clearTimeout(this.__touchLockTimeoutId),this.__touchLockTimeoutId=0),this.__touchLockTimeoutId=setTimeout((()=>{this.__touchLock=!1}),500))}__onDocumentTouchMove(event){if(!this.__movable)return;if(!this.__movingInfo.moving)return;if(1!==event.touches.length)return;if(!this.__activeTouches.get(event.changedTouches[0].identifier)?.useForDragging)return;let left=event.changedTouches[0].clientX-this.__movingInfo.startLeftOffset;left<this.__movingInfo.minLeft?left=this.__movingInfo.minLeft:left>this.__movingInfo.maxLeft&&(left=this.__movingInfo.maxLeft);let top=event.changedTouches[0].clientY-this.__movingInfo.startTopOffset;top<this.__movingInfo.minTop?top=this.__movingInfo.minTop:top>this.__movingInfo.maxTop&&(top=this.__movingInfo.maxTop),this.__bounds||(this.__bounds={}),this.__bounds.left=left,this.__bounds.leftUnit="px",this.__bounds.top=top,this.__bounds.topUnit="px",this.__animationFrameId||(this.__animationFrameId=window.requestAnimationFrame((()=>this.__updatePosition())))}__updatePosition(){this.__movingInfo.moving&&this.__bounds&&(this.__element.style.left=this.__bounds.left+(this.__bounds.leftUnit??"px"),this.__element.style.top=this.__bounds.top+(this.__bounds.topUnit??"px")),this.__animationFrameId=0}__applyTextToElement(name,text,elementOrSetter){if(null==text)return;const setter="object"==typeof elementOrSetter?text=>{elementOrSetter.textContent=text}:elementOrSetter;"object"==typeof text||TcHmi.Symbol.isSymbolExpression(text)?this.__watchLocalization(name,"string"==typeof text?{symbolExpression:text,formatValues:[]}:text,setter):(this.__unwatchLocalization(name),setter(text))}__applyTextToControl(name,text,control,property){if(null!=text)if("string"==typeof text)if(this.__unwatchLocalization(name),TcHmi.Symbol.isSymbolExpression(text))TcHmi.Binding.createEx2(text,property,control);else{const attribute=TcHmi.System.Services.controlManager.getAttributeByPropertyName(control,property);attribute?.propertySetterName&&attribute.propertySetterName in control?control[attribute.propertySetterName](text):TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${Popup.#tchmiFQN}${this.__parentControl?`, Id=${this.__parentControl.getId()}`:""}] The attribute property name ${property} does not exist on control ${control.getId()} or is not writable.`)}else{const attribute=TcHmi.System.Services.controlManager.getAttributeByPropertyName(control,property);let setter;if(!attribute?.propertySetterName||!(attribute.propertySetterName in control))return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${Popup.#tchmiFQN}${this.__parentControl?`, Id=${this.__parentControl.getId()}`:""}] The attribute property name ${property} does not exist on control ${control.getId()} or is not writable.`);setter=control[attribute.propertySetterName],TcHmi.Binding.removeEx2(null,property,control),this.__watchLocalization(name,text,(text=>setter(text)))}}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);existing?.destroyWatch(),existing?.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbolExpression),destroyWatch=symbol.watch((data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${Popup.#tchmiFQN}${this.__parentControl?`, Id=${this.__parentControl.getId()}`:""}, SymbolExpression=${localization.symbolExpression}] `+TcHmi.Log.buildMessage(data.details));let text=data.value??"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)}));this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}}Helpers.Popup=Popup,function(Popup){let PositioningMode,BackgroundMode;!function(PositioningMode){PositioningMode[PositioningMode.Centered=1]="Centered",PositioningMode[PositioningMode.Floating=2]="Floating"}(PositioningMode=Popup.PositioningMode||(Popup.PositioningMode={})),function(BackgroundMode){BackgroundMode[BackgroundMode.None=1]="None",BackgroundMode[BackgroundMode.Dimmed=2]="Dimmed"}(BackgroundMode=Popup.BackgroundMode||(Popup.BackgroundMode={}))}(Popup=Helpers.Popup||(Helpers.Popup={}))}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class ButtonsPrompt extends Helpers.Popup{__buttons=new Map;__onButtonPressedManager=new Helpers.CallbackManager;onButtonPressed=this.__onButtonPressedManager.getManipulators();__backgroundAction={close:!0};__closeButton={show:!1};constructor(buttons,parentControl){super(parentControl);for(const[name,buttonDef]of Object.entries(buttons)){const button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${name}`,buttonDef.attributes,this.__parentControl);if(!button)throw new Error("Could not create controls for ButtonsPrompt.");const buttonElement=button.getElement()[0];buttonElement.classList.add(name+"-button"),this.__elementFooter.appendChild(buttonElement),this.__destroyers.push(TcHmi.EventProvider.register(button.getId()+".onPressed",this.__createPressedHandler(buttonDef.value,name,!buttonDef.keepPopupOpen))),this.__buttons.set(name,{value:buttonDef.value,button:button}),this.__childControls.push(button)}}destroy(force=!1){for(const button of this.__buttons.values())TcHmi.Binding.removeEx2(null,"Text",button.button),TcHmi.Binding.removeEx2(null,"Tooltip",button.button);super.destroy(force)}abort(action){super.abort(action)}__createPressedHandler(value,name,closePopup){return()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}closePopup&&(this.__prompt?this.__prompt.answer(value):this.hide()),this.__onButtonPressedManager.trigger(name,value)}}getButtons(){return this.__buttons}setBackgroundAction(action){super.setBackgroundAction(action)}setCloseButton(buttonOrShow){super.setCloseButton(buttonOrShow)}__performPromptAction(toPerform){if(this.__prompt)if("action"in toPerform&&void 0!==toPerform.action){const button=this.__buttons.get(toPerform.action);button&&this.__prompt.answer(button.value)}else"result"in toPerform&&this.__prompt.answer(toPerform.result)}setLocalizations(texts){this.setTexts(texts)}setTexts(texts){if(this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader),texts.buttons)for(const[name,localization]of Object.entries(texts.buttons)){const button=this.__buttons.get(name)?.button;button&&localization&&(this.__applyTextToControl("buttonText"+name,localization.text,button,"Text"),this.__applyTextToControl("buttonTooltip"+name,localization.tooltip,button,"Tooltip"))}}}Helpers.ButtonsPrompt=ButtonsPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class HtmlAndButtonsPrompt extends Helpers.ButtonsPrompt{__elementContentContent;constructor(buttons,parentControl){super(buttons,parentControl),this.__elementContentContent=null}destroy(force=!1){super.destroy(force),this.__elementContentContent=null}setContentElement(element){this.__elementContentContent&&this.__elementContentContent.remove(),this.__elementContentContent=element,this.__elementContent.appendChild(this.__elementContentContent)}}Helpers.HtmlAndButtonsPrompt=HtmlAndButtonsPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class TextAndButtonsPrompt extends Helpers.ButtonsPrompt{constructor(buttons,parentControl){super(buttons,parentControl)}setLocalizations(texts){this.setTexts(texts)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("contentText",texts.contentText,this.__elementContent)}}Helpers.TextAndButtonsPrompt=TextAndButtonsPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class OkCancelPrompt extends Helpers.Popup{__okButton;__cancelButton;__backgroundAction={close:!0};__closeButton={show:!1};constructor(parentControl){super(parentControl);const okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.okButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl);if(!okButton||!cancelButton)throw new Error("Could not create controls for OkCancelPrompt.");this.__elementFooter.appendChild(okButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",this.__onOkPressed)),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",this.__onCancelPressed)),this.__okButton=okButton,this.__cancelButton=cancelButton,this.__childControls.push(okButton,cancelButton)}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Text",this.__okButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__okButton),TcHmi.Binding.removeEx2(null,"Text",this.__cancelButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelButton),super.destroy(force)}abort(action){super.abort(action)}__onOkPressed=()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__ok()};__onCancelPressed=()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__cancel()};__cancel(){this.__prompt?.answer({isOk:!1})}setBackgroundAction(action){super.setBackgroundAction(action)}__performBackgroundAction(){if(this.__backgroundAction.close&&this.__backgroundAction.action)switch(this.__backgroundAction.action){case"ok":this.__ok();break;case"cancel":this.__cancel()}}setCloseButton(buttonOrShow){super.setCloseButton(buttonOrShow)}__performPromptAction(toPerform){if(toPerform.action)switch(toPerform.action){case"ok":this.__ok();break;case"cancel":this.__cancel()}}setLocalizations(texts){this.setTexts(texts)}setTexts(texts){this.__applyTextToControl("buttonTextOk",texts.buttonTextOk,this.__okButton,"Text"),this.__applyTextToControl("buttonTooltipOk",texts.buttonTooltipOk,this.__okButton,"Tooltip"),this.__applyTextToControl("buttonTextCancel",texts.buttonTextCancel,this.__cancelButton,"Text"),this.__applyTextToControl("buttonTooltipCancel",texts.buttonTooltipCancel,this.__cancelButton,"Tooltip")}}Helpers.OkCancelPrompt=OkCancelPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class InputPrompt extends Helpers.OkCancelPrompt{__input;__forbiddenValues=new Set;__validationPatterns=[];__elementLabel;constructor(parentControl){super(parentControl),this.__elementLabel=document.createElement("span"),this.__elementLabel.className=`${this.__className}-label-block`,this.__elementContent.appendChild(this.__elementLabel);const input=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",`${this.__name}.input`,{"data-tchmi-height":26,"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl);if(!input)throw new Error("Could not create controls for InputPrompt.");this.__input=input,this.__childControls.push(input);const inputElement=input.getElement()[0];inputElement.classList.add("with-validation"),this.__elementContent.appendChild(inputElement),this.__destroyers.push(TcHmi.EventProvider.register(input.getId()+".onTextChanged",this.__onTextChanged)),this.__element.addEventListener("keydown",this.__onKeydown),this.__destroyers.push((()=>this.__element.removeEventListener("keydown",this.__onKeydown)))}__onTextChanged=()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__validate()};__onKeydown=e=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}"Enter"===e.key&&this.__ok()};__validate(){const text=this.__input.getText(),isValid=void 0!==text&&this.__isValid(text);this.__okButton.setIsEnabled(isValid),this.__input.getElement()[0].classList.toggle("invalid",!isValid)}__isValid(text){return!this.__forbiddenValues.has(text)&&this.__validationPatterns.every((validation=>validation.pattern.test(text)===validation.expectedTestResult))}__ok(){const text=this.__input.getText();void 0!==text&&this.__isValid(text)?this.__prompt?.answer({isOk:!0,value:text}):this.__prompt?.error(new Error("Invalid input."))}prompt(forbiddenValues=null,defaultValue=""){this.__forbiddenValues=new Set(forbiddenValues),this.__input.setText(defaultValue),this.__validate();const input=this.__input.getElement()[0].querySelector("input");return input instanceof HTMLInputElement&&(input.selectionDirection="forward",input.selectionStart=0,input.selectionEnd=input.value.length),super.prompt()}show(){const oldOpeningState=this.isShowing();if(super.show(),oldOpeningState)return;const input=this.__input.getElement()[0].querySelector("input");input instanceof HTMLInputElement&&input.focus()}setValidationPatterns(patterns){this.__validationPatterns=patterns,this.__validate()}getValidationPatterns(){return this.__validationPatterns}setLocalizations(texts){this.setTexts(texts)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("labelText",texts.labelText,this.__elementLabel),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}}Helpers.InputPrompt=InputPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Helpers){class FilterPrompt extends Helpers.Popup{__okButton;__cancelButton;__resetButton;__removeButton;__groupButton;__ungroupButton;__elementMenuBar;__elementFilterTableHeader;__elementIndentationHeader;__elementFilterTable;__elementFilterTableBody;__filter=[];__currentFilter=[];__originalFilter=[];__schemaInfo;__localizableEnums=[];__domainPaths=new Map;__rows=[];__selectedRows=[];__updateRequired=!0;__groupInfo=null;__ungroupInfo=null;__onScroll=_event=>{this.__elementFilterTableHeader.scrollLeft=this.__elementFilterTable.scrollLeft};__onLocaleChangedDestroyer=null;__onLocaleChanged=()=>{this.__localizeEnumLabels()};__localizeRequestId=null;__localization;__localizedElements=new Map;__localizationReader=void 0;__listDomainsSubscriptionId=null;__backgroundAction={close:!0,action:"cancel"};__closeButton={show:!1};constructor(schema,originalFilter,parentControl){super(parentControl),this.__originalFilter=originalFilter,this.__element.classList.add("TcHmi_Controls_Helpers_FilterPrompt-popup"),this.__elementHeader.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Header_Text_Filter"),this.__elementMenuBar=document.createElement("div"),this.__elementMenuBar.classList.add("TcHmi_Controls_Helpers_FilterPrompt-menubar"),this.__elementContent.appendChild(this.__elementMenuBar),this.__elementFilterTableHeader=document.createElement("table"),this.__elementFilterTableHeader.classList.add("TcHmi_Controls_Helpers_FilterPrompt-table-header"),this.__elementContent.appendChild(this.__elementFilterTableHeader);let thead=document.createElement("thead");this.__elementFilterTableHeader.appendChild(thead);let tr=document.createElement("tr");thead.appendChild(tr);let selectColumn=document.createElement("th");selectColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-selection-column"),tr.appendChild(selectColumn),this.__elementIndentationHeader=document.createElement("th"),this.__elementIndentationHeader.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-column"),tr.appendChild(this.__elementIndentationHeader);let logicColumn=document.createElement("th");logicColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-logic-column"),logicColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Logic"),tr.appendChild(logicColumn);let pathColumn=document.createElement("th");pathColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-path-column"),pathColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Path"),tr.appendChild(pathColumn);let comparatorColumn=document.createElement("th");comparatorColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-comparator-column"),comparatorColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Operator"),tr.appendChild(comparatorColumn);let valueColumn=document.createElement("th");valueColumn.classList.add("TcHmi_Controls_Helpers_FilterPrompt-value-column"),valueColumn.setAttribute("data-tchmi-localized-content-key","Popup_FilterPrompt_Column_Header_Filter_Value"),tr.appendChild(valueColumn);let scrollPlaceholder=document.createElement("th");scrollPlaceholder.classList.add("TcHmi_Controls_Helpers_FilterPrompt-scroll-placeholder"),tr.appendChild(scrollPlaceholder),this.__elementFilterTable=document.createElement("table"),this.__elementFilterTable.classList.add("TcHmi_Controls_Helpers_FilterPrompt-table"),this.__elementContent.appendChild(this.__elementFilterTable),this.__elementFilterTableBody=document.createElement("tbody"),this.__elementFilterTable.appendChild(this.__elementFilterTableBody);const resetButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.resetButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Reset_Config%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Reset_Config%/l%","data-tchmi-is-enabled":!1},this.__parentControl),okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.okButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Ok%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Ok%/l%"},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Cancel%/l%"},this.__parentControl),addButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.addButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Add%/l%"},this.__parentControl),removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.removeButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Remove%/l%"},this.__parentControl),groupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.groupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Group%/l%"},this.__parentControl),ungroupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.ungroupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Button_Tooltip_Filter_Ungroup%/l%"},this.__parentControl);if(!(resetButton&&okButton&&cancelButton&&addButton&&removeButton&&groupButton&&ungroupButton))throw new Error("Could not create controls for FilterPrompt.");const resetButtonElement=resetButton.getElement()[0];resetButtonElement.classList.add("align-left"),this.__elementFooter.appendChild(resetButtonElement),this.__elementFooter.appendChild(okButton.getElement()[0]),this.__elementFooter.appendChild(cancelButton.getElement()[0]);const addButtonElement=addButton.getElement()[0];addButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-add-button"),this.__elementMenuBar.appendChild(addButtonElement);const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-remove-button"),this.__elementMenuBar.appendChild(removeButtonElement);const groupButtonElement=groupButton.getElement()[0];groupButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-group-button"),this.__elementMenuBar.appendChild(groupButtonElement);const ungroupButtonElement=ungroupButton.getElement()[0];ungroupButtonElement.classList.add("TcHmi_Controls_Helpers_FilterPrompt-ungroup-button"),this.__elementMenuBar.appendChild(ungroupButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",this.__onOkPressed)),this.__destroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",this.__onCancelPressed)),this.__destroyers.push(TcHmi.EventProvider.register(resetButton.getId()+".onPressed",(()=>{this.__reset()}))),this.__destroyers.push(TcHmi.EventProvider.register(addButton.getId()+".onPressed",(()=>{this.__add()}))),this.__destroyers.push(TcHmi.EventProvider.register(removeButton.getId()+".onPressed",(()=>{this.__remove()}))),this.__destroyers.push(TcHmi.EventProvider.register(groupButton.getId()+".onPressed",(()=>{this.__group()}))),this.__destroyers.push(TcHmi.EventProvider.register(ungroupButton.getId()+".onPressed",(()=>{this.__ungroupInfo&&this.__ungroup(this.__ungroupInfo,this.__selectedRows)}))),this.__okButton=okButton,this.__cancelButton=cancelButton,this.__resetButton=resetButton,this.__removeButton=removeButton,this.__groupButton=groupButton,this.__ungroupButton=ungroupButton,this.__childControls.push(okButton,cancelButton);let parsedSchema=this.__parseSchema(schema);this.__schemaInfo=parsedSchema.schemaInfo,this.__localizableEnums=parsedSchema.localizationInfo;for(const path of parsedSchema.domainPaths){let info=this.__schemaInfo.availablePaths.get(path);info&&this.__domainPaths.set(path,info)}this.__localizeEnumLabels(),this.__subscribeListDomains();let localizedElements=this.__element.querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__localization=new TcHmi.Locale.PackageLocalization("Beckhoff.TwinCAT.HMI.Controls"),this.__destroyers.push(this.__localization.watch((data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}}))),this.__onLocaleChangedDestroyer=TcHmi.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Text",this.__okButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__okButton),TcHmi.Binding.removeEx2(null,"Text",this.__cancelButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelButton),super.destroy(force),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__localizeRequestId&&(TcHmi.Server.releaseRequest(this.__localizeRequestId),this.__localizeRequestId=null),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null),this.__clear()}abort(action){super.abort(action)}__onOkPressed=()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__ok()};__onCancelPressed=()=>{if(this.__parentControl){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return}this.__cancel()};__ok(){this.__prompt?.answer(this.__filter)}__cancel(){this.__prompt?.answer(this.__currentFilter)}__reset(){this.__clear(),this.__filter=this.__originalFilter,this.__resetButton.setIsEnabled(!1),this.__update()}getOriginalFilter(){return tchmi_clone_object(this.__originalFilter)}setBackgroundAction(action){super.setBackgroundAction(action)}setCloseButton(buttonOrShow){super.setCloseButton(buttonOrShow)}__performPromptAction(toPerform){if(toPerform.action)switch(toPerform.action){case"ok":this.__ok();break;case"cancel":this.__cancel()}}update(filter,_resetable){this.__currentFilter=tchmi_clone_object(filter),this.__filter=tchmi_clone_object(filter),this.__resetButton.setIsEnabled(!tchmi_equal(this.__originalFilter,this.__filter)),this.__update()}__update(){this.__selectedRows=[];let fragment=document.createDocumentFragment(),indentation=[],maxIndentDepth=0,nesting={filter:this.__filter,parent:null},createRows=(filter,logic,endsPreviousIndentations=0)=>{for(let i=0,ii=filter.length;i<ii;i++){const item=filter[i],isLast=i===ii-1;if(TcHmi.isLogicOperator(item))logic=item;else if(Array.isArray(item)){indentation.push({opens:!0,closes:1===item.length}),maxIndentDepth=Math.max(maxIndentDepth,indentation.length),nesting={filter:item,parent:nesting},isLast?createRows(item,logic,endsPreviousIndentations+1):createRows(item,logic),nesting.parent&&(nesting=nesting.parent)}else if(TcHmi.isComparison(item)){const indentationsToEnd=Math.min(endsPreviousIndentations+1,indentation.length);if(isLast)for(let j=1;j<=indentationsToEnd;j++)indentation[indentation.length-j].closes=!0;if(fragment.appendChild(this.__createRow(indentation,nesting,item,logic)),isLast)indentation=indentation.slice(0,-indentationsToEnd);else for(let j=0,jj=indentation.length;j<jj;j++)indentation[j].opens=!1}}};createRows(this.__filter),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(fragment),this.__elementIndentationHeader.style.minWidth=maxIndentDepth?6*maxIndentDepth+5+"px":"1px",this.__processSelection()}show(){super.show(),this.__subscribeListDomains()}hide(){super.hide(),this.__updateRequired&&this.__clear(),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null)}__clear(){this.__elementFilterTableBody.innerHTML="";for(let i=0,ii=this.__rows.length;i<ii;i++){let row=this.__rows[i];row.selection.destroyer(),row.selection.control.destroy(),row.logic&&(row.logic.destroyer(),row.logic.control.destroy()),row.path.destroyer&&row.path.destroyer(),row.path.control&&row.path.control.destroy(),row.comparator.destroyer&&row.comparator.destroyer(),row.comparator.control&&row.comparator.control.destroy(),row.value.destroyer&&row.value.destroyer(),row.value.control&&row.value.control.destroy()}this.__rows=[]}__createRow(indentation,parent,comparison,logic){let row=document.createElement("tr"),selectionCell=document.createElement("td");selectionCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-selection-column");let selectionCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__newControlId(),null,this.__parentControl);if(!selectionCheckbox)throw new Error("Could not create controls for FilterPopup.");let parentClone=this.__cloneNesting(parent),selectionCheckboxEventDestroyer=TcHmi.EventProvider.register(selectionCheckbox.getId()+".onStateChanged",((_event,data)=>{let selection={rowElement:row,comparison:comparison,parent:parentClone};data.state?this.__selectRow(selection):this.__deselectRow(selection)}));selectionCell.appendChild(selectionCheckbox.getElement()[0]);let indentationCell=document.createElement("td");indentationCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-column");for(let i=0,ii=indentation.length;i<ii;i++){let indentationMarker=document.createElement("div");indentationMarker.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),indentationMarker.classList.toggle("first",indentation[i].opens),indentationMarker.classList.toggle("last",indentation[i].closes),indentationMarker.classList.toggle("middle",!indentation[i].opens&&!indentation[i].closes),indentationCell.appendChild(indentationMarker)}let logicCell=document.createElement("td");logicCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-logic-column");let pathCell=document.createElement("td");pathCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-path-column");let comparatorCell=document.createElement("td");comparatorCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-comparator-column");let valueCell=document.createElement("td");valueCell.classList.add("TcHmi_Controls_Helpers_FilterPrompt-value-column");let rowData={row:row,comparison:comparison,parent:parentClone,selection:{control:selectionCheckbox,destroyer:selectionCheckboxEventDestroyer},path:{control:null,destroyer:null},comparator:{cell:comparatorCell,control:null,destroyer:null},value:{cell:valueCell,control:null,destroyer:null}};if(logic){const constlogic=logic;rowData.logicOperator=logic;let logicLocalizationMap={AND:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_And%/l%",OR:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_Or%/l%"},logicCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic.map((value=>({value:value,text:logicLocalizationMap[value]??value}))),"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(logic.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!logicCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.logic={control:logicCombobox,destroyer:TcHmi.EventProvider.register(logicCombobox.getId()+".onSelectionChanged",((_event,data)=>{constlogic.logic=data.value}))},logicCell.appendChild(logicCombobox.getElement()[0])}let availablePathNames=Array.from(this.__schemaInfo.availablePaths.keys());if(availablePathNames.length>0){let pathCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":availablePathNames,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":500},this.__parentControl);if(!pathCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathCombobox;let selectedIndex=availablePathNames.indexOf(comparison.path||"");availablePathNames.includes(comparison.path||"")?pathCombobox.setSelectedIndex(selectedIndex):pathCombobox.setText(comparison.path),rowData.path.destroyer=TcHmi.EventProvider.register(pathCombobox.getId()+".onUserInteractionFinished",(()=>{let path=pathCombobox.getText();comparison.path!==path&&(null==path||""===path?delete comparison.path:comparison.path=path.toString(),comparison.value="",this.__updateControls(rowData))})),pathCell.appendChild(pathCombobox.getElement()[0])}else{let pathTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!pathTextbox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathTextbox,rowData.path.destroyer=TcHmi.EventProvider.register(pathTextbox.getId()+".onUserInteractionFinished",(()=>{let path=pathTextbox.getText();null==path||""===path?delete comparison.path:comparison.path=path})),pathCell.appendChild(pathTextbox.getElement()[0])}return this.__updateControls(rowData),row.appendChild(selectionCell),row.appendChild(indentationCell),row.appendChild(logicCell),row.appendChild(pathCell),row.appendChild(comparatorCell),row.appendChild(valueCell),this.__rows.push(rowData),row}__updateControls(row){let pathInfo=this.__getPathInfo(row.comparison.path);if(row.path.control instanceof Controls.Beckhoff.TcHmiCombobox&&(pathInfo?.isSuggestion?(row.path.control.setAllowTextInput(!0),row.path.control.getElement()[0].getElementsByTagName("input")[0]?.focus()):row.path.control.setAllowTextInput(!1)),!row.comparator.control){if(row.comparator.control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!row.comparator.control)throw new Error("Could not create controls for FilterPopup.");row.comparator.destroyer=TcHmi.EventProvider.register(row.comparator.control.getId()+".onUserInteractionFinished",(()=>{let comparator=row.comparator.control.getAllowTextInput()?row.comparator.control.getText():row.comparator.control.getSelectedValue();"string"==typeof comparator&&""!==comparator&&(row.comparison.comparator=comparator)})),row.comparator.cell.appendChild(row.comparator.control.getElement()[0])}let comparatorControl=row.comparator.control;if(pathInfo){let comparatorLocalizationMap={contains:"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_Contains%/l%","contains not":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsNot%/l%","== [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_EqualsIgnoreCase%/l%","!= [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_EqualsNotIgnoreCase%/l%","contains [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsIgnoreCase%/l%","contains not [ignore case]":"%l%Package::Beckhoff.TwinCAT.HMI.Controls::Popup_FilterPrompt_Combobox_Entry_ContainsNotIgnoreCase%/l%"};comparatorControl.setAllowTextInput(!1),comparatorControl.setSrcData(pathInfo.comparators.map((comparator=>({value:comparator,text:comparatorLocalizationMap[comparator]??comparator})))),comparatorControl.setSelectedIndex(pathInfo.comparators.indexOf(row.comparison.comparator))}else comparatorControl.setAllowTextInput(!0);let valueControlType="TcHmi.Controls.Beckhoff.TcHmiTextbox";pathInfo&&pathInfo.values.length>0&&(valueControlType="TcHmi.Controls.Beckhoff.TcHmiCombobox"),pathInfo&&pathInfo.valueIsDate&&(valueControlType="TcHmi.Controls.Beckhoff.TcHmiDateTimeInput"),row.value.control&&row.value.control.getType()!==valueControlType&&(row.value.destroyer&&(row.value.destroyer(),row.value.destroyer=null),row.value.cell.removeChild(row.value.control.getElement()[0]),row.value.control.destroy(),row.value.control=null);let eventRegistrationNeeded=!1;if(!row.value.control){if(row.value.control=TcHmi.ControlFactory.createEx(valueControlType,this.__newControlId(),"TcHmi.Controls.Beckhoff.TcHmiCombobox"===valueControlType?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!row.value.control)throw new Error("Could not create controls for FilterPopup.");eventRegistrationNeeded=!0,row.value.cell.appendChild(row.value.control.getElement()[0])}switch(valueControlType){case"TcHmi.Controls.Beckhoff.TcHmiTextbox":let text,textbox=row.value.control;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),textbox.setText(text),eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(textbox.getId()+".onUserInteractionFinished",(()=>{let value=textbox.getText();if(null==value)return;let pathInfo=this.__getPathInfo(row.comparison.path);if(pathInfo?.nullable&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}})));break;case"TcHmi.Controls.Beckhoff.TcHmiCombobox":let combobox=row.value.control;if(!pathInfo)break;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}if(combobox.setSrcData(srcData),combobox.setAllowTextInput(pathInfo.allowFreeValue),combobox.setSelectedIndex(pathInfo.values.indexOf(row.comparison.value)),pathInfo.allowFreeValue&&!pathInfo.values.includes(row.comparison.value)){let text;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),combobox.setText(text)}eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(combobox.getId()+".onUserInteractionFinished",(()=>{let value=combobox.getSelectedValue(),pathInfo=this.__getPathInfo(row.comparison.path);if(null==value&&pathInfo.allowFreeValue&&(value=combobox.getText()),null!=value)if(pathInfo?.nullable&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}})));break;case"TcHmi.Controls.Beckhoff.TcHmiDateTimeInput":let value,dateTimeInput=row.value.control;value=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),dateTimeInput.setValue(value),eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(dateTimeInput.getId()+".onUserInteractionFinished",(()=>{let value=dateTimeInput.getValue();if(null==value)return;let pathInfo=this.__getPathInfo(row.comparison.path);pathInfo?.nullable&&"null"===value.toLowerCase()?row.comparison.value=null:row.comparison.value=value})))}}__getPathInfo(path=""){let pathInfo=this.__schemaInfo.availablePaths.get(path);if(!pathInfo)for(const[key,value]of this.__schemaInfo.availablePaths)if(value.isSuggestion&&path.startsWith(key)){pathInfo=value;break}return!pathInfo&&this.__schemaInfo.freePath&&(pathInfo=this.__schemaInfo.freePath),pathInfo??null}__selectRow(row){this.__selectedRows.push(row),this.__processSelection()}__deselectRow(row){for(let i=0,ii=this.__selectedRows.length;i<ii;i++)if(this.__selectedRows[i].comparison===row.comparison){this.__selectedRows.splice(i,1);break}this.__processSelection()}__add(){let[path,pathInfo]=this.__schemaInfo.freePath?["",this.__schemaInfo.freePath]:this.__schemaInfo.availablePaths.entries().next().value,logic={logic:this.__schemaInfo.availableLogic[0]},comparison={path:path,comparator:pathInfo.comparators[0],value:pathInfo.allowFreeValue?"":pathInfo.values[0]};if(this.__selectedRows.length>0){this.__selectedRows.sort(((a,b)=>b.rowElement.rowIndex-a.rowElement.rowIndex));let lastRow=this.__selectedRows[0];lastRow.parent.filter.splice(lastRow.parent.filter.indexOf(lastRow.comparison)+1,0,logic,comparison);let indentation=[],indentationElements=lastRow.rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker");for(let i=0,ii=indentationElements.length;i<ii;i++)indentationElements[i].classList.contains("last")?(indentationElements[i].classList.remove("last"),indentationElements[i].classList.add("middle"),indentation.push({opens:!1,closes:!0})):indentation.push({opens:!1,closes:!1});lastRow.rowElement.insertAdjacentElement("afterend",this.__createRow(indentation,lastRow.parent,comparison,logic))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__filter,parent:null},comparison,this.__filter.length>0?logic:void 0)),this.__filter.length>0&&this.__filter.push(logic),this.__filter.push(comparison);this.__processSelection()}__remove(){for(const selectedRow of this.__selectedRows){let index=selectedRow.parent.filter.indexOf(selectedRow.comparison);if(-1===index)continue;let indentationElements=selectedRow.rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),siblingIndentation=null;for(let i=0,ii=indentationElements.length;i<ii;i++){const containsFirst=indentationElements[i].classList.contains("first"),containsLast=indentationElements[i].classList.contains("last");if(containsFirst&&!containsLast){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.nextElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("first")}else if(containsLast&&!containsFirst){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.previousElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("last")}}const rowDataIndex=this.__rows.findIndex((rowData=>rowData.row===selectedRow.rowElement));if(-1!==rowDataIndex){const rowData=this.__rows[rowDataIndex];rowData.selection.destroyer(),rowData.selection.control.destroy(),rowData.logic&&(rowData.logic.destroyer(),rowData.logic.control.destroy()),rowData.path.destroyer&&rowData.path.destroyer(),rowData.path.control&&rowData.path.control.destroy(),rowData.comparator.destroyer&&rowData.comparator.destroyer(),rowData.comparator.control&&rowData.comparator.control.destroy(),rowData.value.destroyer&&rowData.value.destroyer(),rowData.value.control&&rowData.value.control.destroy(),this.__rows.splice(rowDataIndex,1)}if(this.__elementFilterTableBody.removeChild(selectedRow.rowElement),selectedRow.parent.filter.splice(index,1),index>0)selectedRow.parent.filter.splice(index-1,1);else{let parent=selectedRow.parent,parentIndex=0;for(;parent.parent&&0!==parentIndex;){if(parentIndex=parent.parent.filter.indexOf(parent.filter),-1===parentIndex)throw new Error("Filter in invalid state. Parent filter does not contain child filter.");parent=parent.parent}if(0===parentIndex){selectedRow.parent.filter.length>0&&selectedRow.parent.filter.splice(0,1);let firstRow=this.__elementFilterTableBody.firstElementChild;if(firstRow){for(let j=0,jj=this.__rows.length;j<jj;j++)if(this.__rows[j].row===selectedRow.rowElement){this.__rows[j].logic&&(this.__rows[j].logic.destroyer(),this.__rows[j].logic.control.destroy(),delete this.__rows[j].logic);break}let comboboxElement=firstRow.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-logic-column .TcHmi_Controls_Beckhoff_TcHmiCombobox");comboboxElement&&comboboxElement.remove()}}else parent.filter.splice(parentIndex-1,1,selectedRow.parent.filter.splice(0,1)[0])}if(1===selectedRow.parent.filter.length&&selectedRow.parent.parent){let ungroupRows=[];for(let j=0,jj=this.__rows.length;j<jj;j++){let parent=this.__rows[j].parent;for(;parent&&parent.filter!==selectedRow.parent.filter;)parent=parent.parent;parent&&ungroupRows.push({rowElement:this.__rows[j].row,comparison:this.__rows[j].comparison,parent:this.__rows[j].parent})}ungroupRows.length>0&&this.__ungroup({parent:selectedRow.parent.parent,toUngroup:selectedRow.parent},ungroupRows)}}this.__selectedRows=[],this.__processSelection()}__group(){if(!this.__groupInfo)return;let start=this.__groupInfo.parent.filter.length,end=-1;for(let i=0,ii=this.__groupInfo.toGroup.length;i<ii;i++){let index=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[i]);if(-1===index)return;start=index<start?index:start,end=index>end?index:end}let newNested=this.__groupInfo.parent.filter.splice(start,end-start+1);this.__groupInfo.parent.filter.splice(start,0,newNested),this.__selectedRows.sort(((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex));let newParent={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},groupInfoParentFilter=this.__groupInfo.parent.filter;for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let parentToModify=this.__selectedRows[i].parent,indentationMarkerPosition=0;for(;parentToModify.parent&&parentToModify.filter!==groupInfoParentFilter;)parentToModify=parentToModify.parent,indentationMarkerPosition++;parentToModify.filter=newNested,parentToModify.parent=this.__cloneNesting(newParent);let indentationCell=this.__selectedRows[i].rowElement.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-column")[0];if(indentationCell){let elementToAdd=document.createElement("div");elementToAdd.classList.add("TcHmi_Controls_Helpers_FilterPrompt-indentation-marker"),0===i?elementToAdd.classList.add("first"):i+1===ii?elementToAdd.classList.add("last"):elementToAdd.classList.add("middle"),indentationCell.insertBefore(elementToAdd,indentationCell.childNodes[indentationCell.childElementCount-indentationMarkerPosition]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}__ungroup(ungroupInfo,rows){let index=ungroupInfo.parent.filter.indexOf(ungroupInfo.toUngroup.filter);if(-1!==index){ungroupInfo.parent.filter.splice(index,1,...ungroupInfo.toUngroup.filter),rows.sort(((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex));for(let i=0,ii=rows.length;i<ii;i++){let elementToRemove,parentToModify=rows[i].parent;for(;parentToModify.parent&&parentToModify.parent.filter!==ungroupInfo.parent.filter;)parentToModify=parentToModify.parent;parentToModify.filter=ungroupInfo.parent.filter,parentToModify.parent=ungroupInfo.parent.parent?this.__cloneNesting(ungroupInfo.parent.parent):null,elementToRemove=0===i?rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.first"):i+1===ii?rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.last"):rows[i].rowElement.querySelector(".TcHmi_Controls_Helpers_FilterPrompt-indentation-marker.middle"),elementToRemove&&elementToRemove.parentElement.removeChild(elementToRemove)}this.__processSelection(),this.__resizeIndentationHeader()}}__processSelection(){if(this.__removeButton.setIsEnabled(this.__selectedRows.length>0),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let selectedParents=[],continuityTest=[];for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let row=this.__selectedRows[i];continuityTest[row.rowElement.rowIndex]=!0;let selectedParent=selectedParents.find((sp=>sp.nesting.filter===row.parent.filter));for(selectedParent||(selectedParent={nesting:row.parent,itemCount:Math.ceil(row.parent.filter.length/2),selectedItems:[]},selectedParents.push(selectedParent)),selectedParent.selectedItems.push(row.comparison);selectedParent.selectedItems.length>=selectedParent.itemCount&&(i+1<ii||selectedParents.length>1);){if(!selectedParent.nesting.parent)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let grandparent=selectedParents.find((sp=>sp.nesting.filter===selectedParent.nesting.parent.filter));grandparent||(grandparent={nesting:selectedParent.nesting.parent,itemCount:Math.ceil(selectedParent.nesting.parent.filter.length/2),selectedItems:[]},selectedParents.push(grandparent)),grandparent.selectedItems.push(selectedParent.nesting.filter),selectedParents.splice(selectedParents.indexOf(selectedParent),1),selectedParent=grandparent}}if(1===selectedParents.length){let groupingBase=selectedParents[0],isContinuous=!0;for(let i=continuityTest.indexOf(!0),ii=continuityTest.length;i<ii;i++)if(!continuityTest[i]){isContinuous=!1;break}groupingBase.selectedItems.length<groupingBase.itemCount&&isContinuous?this.__groupInfo={parent:groupingBase.nesting,toGroup:groupingBase.selectedItems}:groupingBase.selectedItems.length===groupingBase.itemCount&&groupingBase.nesting.parent&&(this.__ungroupInfo={parent:groupingBase.nesting.parent,toUngroup:groupingBase.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)}__resizeIndentationHeader(){let indentationCell=this.__elementFilterTableBody.getElementsByClassName("TcHmi_Controls_Helpers_FilterPrompt-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(indentationCell?indentationCell.offsetWidth:0)+"px"}__newControlId(){return`${this.__name}.${tchmi_create_guid()}`}__cloneNesting(nesting){return{filter:nesting.filter,parent:nesting.parent?this.__cloneNesting(nesting.parent):null}}__parseSchema(schema){if(schema&&"array"===schema.type&&schema.items){let items=null;if(Array.isArray(schema.items)?items=schema.items:"object"===schema.items.type?items=[schema.items]:schema.items.anyOf?items=schema.items.anyOf:schema.items.oneOf&&(items=schema.items.oneOf),items){let info={availablePaths:new Map,freePath:null,availableLogic:[]},localizables=[],domainPaths=[];for(let i=0,ii=items.length;i<ii;i++){let item=items[i];if("object"===item.type&&item.properties&&item.properties.logic&&item.properties.logic.enum){for(let j=0,jj=item.properties.logic.enum.length;j<jj;j++)info.availableLogic.includes(item.properties.logic.enum[j])||info.availableLogic.push(item.properties.logic.enum[j]);continue}if(!("object"===item.type&&item.properties&&item.properties.comparator&&item.properties.comparator.enum&&item.properties.value))continue;let pathValues=null,isSuggestion=!1;if(item.properties.path){if(item.properties.path.enum)pathValues=item.properties.path.enum;else if(item.properties.path.pattern){let pattern=item.properties.path.pattern;if(pattern.startsWith("^")){let escaped=pattern.substring(1).replace(/\\(.)/g,"$1");new RegExp(pattern).test(escaped)&&(pathValues=[escaped],isSuggestion=!0)}}}else pathValues=[""];let pathInfos=[];if(pathValues)for(let j=0,jj=pathValues.length;j<jj;j++)info.availablePaths.has(pathValues[j])||info.availablePaths.set(pathValues[j],{comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:isSuggestion}),pathInfos.push(info.availablePaths.get(pathValues[j]));else info.freePath||(info.freePath={comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1}),pathInfos.push(info.freePath);for(let j=0,jj=pathInfos.length;j<jj;j++){for(let k=0,kk=item.properties.comparator.enum.length;k<kk;k++)pathInfos[j].comparators.includes(item.properties.comparator.enum[k])||pathInfos[j].comparators.push(item.properties.comparator.enum[k]);let valueItems=item.properties.value.oneOf??item.properties.value.anyOf??[item.properties.value],typeFound=!1;valueItems.forEach((valueItem=>{if("string"===valueItem.type||"number"===valueItem.type||"integer"===valueItem.type||"boolean"===valueItem.type?typeFound?pathInfos[j].valueType="any":(pathInfos[j].valueType=valueItem.type,typeFound=!0):"null"===valueItem.type&&(pathInfos[j].nullable=!0),valueItem.enum)for(let k=0,kk=valueItem.enum.length;k<kk;k++)pathInfos[j].values.includes(valueItem.enum[k])||pathInfos[j].values.push(valueItem.enum[k]);else pathValues&&pathValues[j].toLowerCase().includes("domain")?(pathInfos[j].values=[""],pathInfos[j].allowFreeValue=!0,domainPaths.push(pathValues[j])):"boolean"===valueItem.type?pathInfos[j].values=[!1,!0]:pathInfos[j].allowFreeValue=!0;if(valueItem.options){let options=valueItem.options;for(let k=0,kk=options.length;k<kk;k++)pathInfos[j].labels.set(options[k].value,options[k].label);localizables.includes(pathInfos[j])||localizables.push(pathInfos[j])}"date-time"===valueItem.format&&(pathInfos[j].valueIsDate=!0)}))}}return{schemaInfo:info,localizationInfo:localizables,domainPaths:domainPaths}}}return{schemaInfo:{availablePaths:new Map,freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!0,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1},availableLogic:["AND","OR"]},localizationInfo:[],domainPaths:[]}}__localizeEnumLabels(){if(0===this.__localizableEnums.length)return;let request={requestType:"ReadWrite",commands:[]},map={};for(let i=0,ii=this.__localizableEnums.length;i<ii;i++)for(const[key,label]of this.__localizableEnums[i].labels)map[label]={pathInfo:this.__localizableEnums[i],key:key},request.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:label},commandOptions:["SendWriteValue","SendErrorMessage"]});this.__localizeRequestId=TcHmi.Server.requestEx(request,null,(data=>{if(this.__localizeRequestId=null,data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`);else if(data.response.commands&&0!==data.response.commands.length){for(let i=0,ii=data.response.commands.length;i<ii;i++){if(data.response.commands[i].error){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.commands[i].error)}`);continue}if(!data.response.commands[i].readValue){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[i].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__name}));continue}let writeValue=data.response.commands[i].writeValue;"object"==typeof writeValue&&writeValue.name&&map[writeValue.name]&&map[writeValue.name].pathInfo.localizedLabels.set(map[writeValue.name].key,data.response.commands[i].readValue)}for(let i=0,ii=this.__rows.length;i<ii;i++){let combobox=this.__rows[i].value.control;if(combobox instanceof Controls.Beckhoff.TcHmiCombobox){let pathInfo=this.__getPathInfo(this.__rows[i].comparison.path);if(!pathInfo||0===pathInfo.localizedLabels.size)continue;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}let selectedIndex=combobox.getSelectedIndex();combobox.setSrcData(srcData),combobox.setSelectedIndex(void 0===selectedIndex?null:selectedIndex)}}}else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__name}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name},\n                            ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__name}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.details)}`)}))}__subscribeListDomains(){0!==this.__domainPaths.size&&null===this.__listDomainsSubscriptionId&&(this.__listDomainsSubscriptionId=TcHmi.Server.subscribeEx([{symbol:"ListDomains"}],1e3,null,(data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.details)}`);if(!data.response)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__name}));if(data.response.error)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`);if(!data.response.commands||0===data.response.commands.length)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__name}));if(data.response.commands[0].error)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.commands[0].error)}`);if(!data.response.commands[0].readValue)return void TcHmi.Log.errorEx(`[Source=Control, Module=${this.__name}, ControlId=$(this.__name), Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[0].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__name}));let domains=Object.keys(data.response.commands[0].readValue);for(const pathInfo of this.__domainPaths.values())pathInfo.values=domains;this.__rows.filter((row=>row.comparison.path&&this.__domainPaths.has(row.comparison.path))).forEach((row=>{let combobox=row.value.control;if(combobox instanceof Controls.Beckhoff.TcHmiCombobox){let pathInfo=this.__getPathInfo(row.comparison.path);if(!pathInfo)return;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:pathInfo.localizedLabels.get(value)??pathInfo.labels.get(value)??value})}let selectedValue=combobox.getSelectedValue()??combobox.getText(),selectedIndex=srcData.findIndex((item=>item.value===selectedValue));combobox.setSrcData(srcData),-1!==selectedIndex?(combobox.getAllowTextInput()&&combobox.setText(null),combobox.setSelectedIndex(selectedIndex)):(combobox.setSelectedIndex(null),combobox.getAllowTextInput()&&combobox.setText(selectedValue))}}))})))}}Helpers.FilterPrompt=FilterPrompt}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));