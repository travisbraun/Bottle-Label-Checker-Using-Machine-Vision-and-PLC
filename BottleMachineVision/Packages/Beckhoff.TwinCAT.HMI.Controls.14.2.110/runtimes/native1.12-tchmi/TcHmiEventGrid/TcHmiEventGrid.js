"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Beckhoff){class TcHmiEventGrid extends TcHmi.Controls.System.TcHmiControl{static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__elementTemplateRoot;__elementGridContainer;__elementMenuBar;__elementTypeToggles;__elementSeverityToggles;__elementOptions;__elementMessageActions;__elementFilterPopup;__elementColumnsPopup;__elementDetailsPopup;__elementConfirmAllPopup;__filter;__internalFilter=[];__noPayloadsFilter=new TcHmi.FilterInstance("type","!=",TcHmi.Server.Events.Type.Payload);__serverInterval;__columns;__internalColumns=[];__allowDetailsPopup;__showMenuBar;__menuBarPosition;__buttonFontFamily;__buttonFontSize;__buttonFontSizeUnit;__buttonFontStyle;__buttonFontWeight;__buttonHeight;__storage;__datagrid;__sortingInitialized=!1;__headerFontFamilyInitialized=!1;__headerFontSizeInitialized=!1;__headerFontSizeUnitInitialized=!1;__headerFontStyleInitialized=!1;__headerFontWeightInitialized=!1;__gridFontFamilyInitialized=!1;__gridFontSizeInitialized=!1;__gridFontSizeUnitInitialized=!1;__gridFontStyleInitialized=!1;__gridFontWeightInitialized=!1;__headerHeightInitialized=!1;__headerHeightUnitInitialized=!1;__rowHeightInitialized=!1;__ignoreEscapeSequences;__typeToggles=new Map([[TcHmi.Server.Events.Type.Alarm,void 0],[TcHmi.Server.Events.Type.Message,void 0]]);__severityToggles=new Map([[TcHmi.Server.Events.Severity.Verbose,void 0],[TcHmi.Server.Events.Severity.Info,void 0],[TcHmi.Server.Events.Severity.Warning,void 0],[TcHmi.Server.Events.Severity.Error,void 0],[TcHmi.Server.Events.Severity.Critical,void 0]]);__menuBarButtons=new Map([["filter",void 0],["columns",void 0],["confirm",void 0],["confirmAll",void 0]]);__buttonTooltips={message:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Message%/l%",alarm:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Alarm%/l%",verbose:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Verbose%/l%",info:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Info%/l%",warning:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Warning%/l%",error:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Error%/l%",critical:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Critical%/l%",filter:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter%/l%",columns:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Columns%/l%",confirm:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Confirm%/l%",confirmAll:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll%/l%"};__canConfirm=!0;__filterPrompt=null;__columnsPopup=null;__detailsPopup=null;__confirmAllPopup=null;__typesToShow=new Map([[TcHmi.Server.Events.Type.Alarm,!0],[TcHmi.Server.Events.Type.Message,!0]]);__severitiesToShow=new Map([[TcHmi.Server.Events.Severity.Verbose,!0],[TcHmi.Server.Events.Severity.Info,!0],[TcHmi.Server.Events.Severity.Warning,!0],[TcHmi.Server.Events.Severity.Error,!0],[TcHmi.Server.Events.Severity.Critical,!0]]);__themedIcons={types:new Map,severities:new Map};__localizedElements=new Map;__localizationReader=void 0;__subscriptionId=null;__availableColumns={severity:{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Verbose%/l%",value:TcHmi.Server.Events.Severity.Verbose,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/verbose.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Info%/l%",value:TcHmi.Server.Events.Severity.Info,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/info.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Warning%/l%",value:TcHmi.Server.Events.Severity.Warning,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/warning.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Error%/l%",value:TcHmi.Server.Events.Severity.Error,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/error.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Critical%/l%",value:TcHmi.Server.Events.Severity.Critical,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/critical.svg"}]},type:{name:"type",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Message%/l%",value:TcHmi.Server.Events.Type.Message,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/message.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Alarm%/l%",value:TcHmi.Server.Events.Type.Alarm,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/alarm.svg"}]},domain:{name:"domain",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Domain%/l%",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},sourceDomain:{name:"sourceDomain",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_SourceDomain%/l%",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},name:{name:"name",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Name%/l%",control:"TextBlock",width:200,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},text:{name:"text",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Text%/l%",control:"TextBlock",width:373,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},alarmState:{name:"alarmState",label:"",control:"TextBlock",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},confirmationState:{name:"confirmationState",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_ConfirmationState%/l%",control:"TextBlock",format:{objectType:"Function",fn:"EnumToString",fnParams:[{objectType:"StaticValue",valueType:"tchmi:framework#/definitions/EnumMapping",value:{0:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Enum_ConfirmationState_NotSupported%/l%",1:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Enum_ConfirmationState_NotRequired%/l%",2:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Enum_ConfirmationState_Wait%/l%",3:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Enum_ConfirmationState_Confirmed%/l%",4:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Enum_ConfirmationState_Reset%/l%"}}]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},timeAndDateRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Raised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeRaised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateRaised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Confirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeConfirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateConfirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Cleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeCleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateCleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"}};__destroyersToCallOnDetach=[];__destroyersToCallOnDestroy=[];__doubletapStartTime=0;__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-event-grid-template")),this.__elementGridContainer=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-grid-container"),0===this.__elementGridContainer.length&&(this.__elementGridContainer=this.__elementTemplateRoot.find(".tchmi-event-grid-template-grid-container")),this.__elementMenuBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-menu-bar"),0===this.__elementMenuBar.length&&(this.__elementMenuBar=this.__elementTemplateRoot.find(".tchmi-event-grid-template-menu-bar")),this.__elementTypeToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-type-toggles"),0===this.__elementTypeToggles.length&&(this.__elementTypeToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-type-toggles")),this.__elementSeverityToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-severity-toggles"),0===this.__elementSeverityToggles.length&&(this.__elementSeverityToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-severity-toggles")),this.__elementOptions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-options"),0===this.__elementOptions.length&&(this.__elementOptions=this.__elementMenuBar.find(".tchmi-event-grid-template-options")),this.__elementMessageActions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-event-actions"),0===this.__elementMessageActions.length&&(this.__elementMessageActions=this.__elementMenuBar.find(".tchmi-event-grid-template-event-actions")),this.__elementFilterPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-popup"),0===this.__elementFilterPopup.length&&(this.__elementFilterPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-filter-popup")),this.__elementColumnsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-popup"),0===this.__elementColumnsPopup.length&&(this.__elementColumnsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-columns-popup")),this.__elementDetailsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-details-popup"),0===this.__elementDetailsPopup.length&&(this.__elementDetailsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-details-popup")),this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup"),0===this.__elementConfirmAllPopup.length&&(this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-confirm-all-popup")),0===this.__elementTemplateRoot.length||0===this.__elementGridContainer.length||0===this.__elementMenuBar.length||0===this.__elementTypeToggles.length||0===this.__elementSeverityToggles.length||0===this.__elementOptions.length||0===this.__elementMessageActions.length||0===this.__elementFilterPopup.length||0===this.__elementColumnsPopup.length||0===this.__elementDetailsPopup.length||0===this.__elementConfirmAllPopup.length)throw new Error("Invalid Template.html");let datagrid=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",`${this.__id}.eventDatagrid`,{"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-row-classes-provider":{objectType:"Function",active:!0,fn:"EventClassesProvider",fnParams:[]},"data-tchmi-cell-content-padding":{left:3,right:3}},this);if(!datagrid)throw new Error("Could not create controls for TcHmiEventGrid.");datagrid.__setDataSymbolTransform(TcHmi.Server.Events.parseServerEvent),this.__datagrid=datagrid;let localizedElements=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__destroyersToCallOnDestroy.push(this.__localization.watch((data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}}))),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged",this.__onDataGridPropertyChanged)),super.__previnit()}__init(){super.__init(),this.__storage=new TcHmi.LocalStorage(this,{filter:this.getFilter(),columns:this.getColumns()}),this.__elementGridContainer.append(this.__datagrid.getElement());for(const type of this.__typeToggles.keys()){let buttonName=TcHmi.Server.Events.Type[type].toLowerCase(),button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${buttonName}ToggleButton`,{"data-tchmi-height":this.__buttonHeight??30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:this.__buttonHeight??30,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[buttonName],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-toggle-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-toggle-button`),this.__typeToggles.set(type,button),this.__elementTypeToggles.append(buttonElement)}for(const severity of this.__severityToggles.keys()){let buttonName=TcHmi.Server.Events.Severity[severity].toLowerCase(),button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${buttonName}ToggleButton`,{"data-tchmi-height":this.__buttonHeight??30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:this.__buttonHeight??30,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[buttonName],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-toggle-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-toggle-button`),this.__severityToggles.set(severity,button),this.__elementSeverityToggles.append(buttonElement)}for(const buttonName of this.__menuBarButtons.keys()){let button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}.${buttonName}Button`,{"data-tchmi-width":this.__buttonHeight??30,"data-tchmi-height":this.__buttonHeight??30,"data-tchmi-tooltip":this.__buttonTooltips[buttonName]},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-button`),this.__menuBarButtons.set(buttonName,button),"confirm"===buttonName||"confirmAll"===buttonName?(button.setIsEnabled(!1),this.__elementMessageActions.append(buttonElement)):this.__elementOptions.append(buttonElement)}let configureMapping=[{controlRight:"operate",virtualControlRight:"configure"}],filterButton=this.__menuBarButtons.get("filter");filterButton&&filterButton.setVirtualControlRightMappings(configureMapping);let columnsButton=this.__menuBarButtons.get("columns");columnsButton&&columnsButton.setVirtualControlRightMappings(configureMapping),this.__setCanConfirm(!1)}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register("onThemeDataChanged",this.__onThemeDataChanged));for(const[type,button]of this.__typeToggles)this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(button.getId()+".onToggleStateChanged",this.__getTypeToggleStateChangedHandler(button,type)));for(const[severity,button]of this.__severityToggles)this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(button.getId()+".onToggleStateChanged",this.__getSeverityToggleStateChangedHandler(button,severity)));this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged<selectedRowValue>",this.__onSelectedItemChanged)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("filter").getId()+".onPressed",this.__onFilterPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("columns").getId()+".onPressed",this.__onColumnsPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("confirm").getId()+".onPressed",this.__onConfirmPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("confirmAll").getId()+".onPressed",this.__onConfirmAllPressed));this.__elementGridContainer[0].addEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].addEventListener("touchstart",this.__onTouchStart,{passive:!1,capture:!1}),this.__elementGridContainer[0].addEventListener("scroll",this.__onScroll,!0),this.__themedIcons=this.__getThemedIcons();let filter=this.__storage?.get("filter");filter?this.__updateFilter(filter):this.__processFilter();let columns=this.__storage?.get("columns");columns?this.__updateColumns(columns):this.__processColumns()}__detach(){super.__detach();for(const destroy of this.__destroyersToCallOnDetach)destroy();this.__destroyersToCallOnDetach=[];this.__elementGridContainer[0].removeEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].removeEventListener("touchstart",this.__onTouchStart,{passive:!1,capture:!1}),this.__elementGridContainer[0].removeEventListener("scroll",this.__onScroll,!0),this.__updateSubscription(!0)}destroy(){if(!this.__keepAlive){super.destroy(),this.__filterPrompt&&(this.__filterPrompt.destroy(),this.__filterPrompt=null),this.__columnsPopup&&(this.__columnsPopup.destroy(),this.__columnsPopup=null),this.__detailsPopup&&(this.__detailsPopup.destroy(),this.__detailsPopup=null),this.__confirmAllPopup&&(this.__confirmAllPopup.destroy(),this.__confirmAllPopup=null);for(const destroy of this.__destroyersToCallOnDestroy)destroy();this.__destroyersToCallOnDestroy=[]}}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}__onResized=()=>{"Left"!==this.__menuBarPosition&&"Right"!==this.__menuBarPosition||this.__fixVerticalMenuBarWidth()};__onThemeDataChanged=()=>{this.__themedIcons=this.__getThemedIcons(),this.__updateColumns(this.__internalColumns)};__getTypeToggleStateChangedHandler(toggleButton,type){return()=>{this.__typesToShow.set(type,"Active"===toggleButton.getToggleState()),this.__updateDatagridFilter()}}__getSeverityToggleStateChangedHandler(toggleButton,severity){return()=>{this.__severitiesToShow.set(severity,"Active"===toggleButton.getToggleState()),this.__updateDatagridFilter()}}__onSelectedItemChanged=()=>{this.__processSelectedItem(),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedEvent"}),TcHmi.EventProvider.raise(this.__id+".onSelectedItemChanged",this.getSelectedEvent())};__onDataGridPropertyChanged=(event,data,...args)=>{["Sorting","HeaderFontFamily","HeaderFontSize","HeaderFontSizeUnit","HeaderFontStyle","HeaderFontWeight","GridFontFamily","GridFontSize","GridFontSizeUnit","GridFontStyle","GridFontWeight","HeaderHeight","HeaderHeightUnit","RowHeight"].includes(data.propertyName)&&TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",data,...args)};__onFilterPressed=()=>{TcHmi.Access.checkAccess(this,"configure")&&(this.__filterPrompt||(this.__filterPrompt=new Controls.Helpers.FilterPrompt(TcHmi.Type.getSchema("tchmi:server#/definitions/eventFilter"),this.__internalFilter,this),this.__filterPrompt.setBackgroundAction({close:!0,action:"cancel"})),this.__filterPrompt.update(this.__internalFilter,!tchmi_equal(this.__internalFilter,this.__filter)||0===this.__internalFilter.length&&!this.__filter),this.__filterPrompt.prompt().then((newFilter=>{this.__updateFilter(newFilter),this.__storage?.setWithValidation("filter",this.__internalFilter)})),this.__filterPrompt.show())};__onColumnsPressed=()=>{this.__columnsPopup||(this.__columnsPopup=new Beckhoff.TcHmiEventGridPopups.ColumnsPopup(this.__elementColumnsPopup[0],this),this.__columnsPopup.registerOkButtonHandler((()=>{TcHmi.Access.checkAccess(this,"configure")&&(this.__updateColumns(this.__columnsPopup.getSettings()),this.__storage?.setWithValidation("columns",this.__internalColumns))})),this.__columnsPopup.registerResetButtonHandler((()=>{this.__storage?.delete("columns"),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(this.__columns??[],!1)}))),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(this.__internalColumns,!(tchmi_equal(this.__internalColumns,this.__columns)||0===this.__internalColumns.length&&!this.__columns)),this.__columnsPopup.show()};__onConfirmPressed=()=>{let event=this.__datagrid.getSelectedRowValue();TcHmi.Server.Events.isAlarm(event)&&TcHmi.Server.Events.confirmAlarm(event,(data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+"] Unable to confirm alarm with id "+event.id+" in domain "+event.domain+". Error: "+TcHmi.Log.buildMessage(data.details))}))};__onConfirmAllPressed=()=>{this.__confirmAllPopup||(this.__confirmAllPopup=new Beckhoff.TcHmiEventGridPopups.ConfirmAllPopup(this.__elementConfirmAllPopup[0],this));let commands=new Map;commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter()},((command,data)=>{command.readValue?this.__confirmAllPopup.update(command.readValue.map(TcHmi.Server.Events.parseServerEvent).filter(TcHmi.Server.Events.isAlarm)):TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:'Missing property: "readValue" in command for symbol: "ListEvents" in response from server with id: '+data.response?.id,domain:this.__type}))})),TcHmi.Server.requestEx({requestType:"ReadWrite",commands:Array.from(commands.keys())},null,this.__getServerResponseHandler(commands)),this.__confirmAllPopup.update([]),this.__confirmAllPopup.show()};__onDoubleclick=event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate")||!TcHmi.Access.checkAccess(this,"viewDetails"))return;if(!(event.target instanceof Element))return;let tableRow=event.target;for(;tableRow&&!tableRow.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")&&!tableRow.classList.contains("tchmi-datagrid-template-row");)tableRow=tableRow.parentElement;tableRow&&(TcHmi.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails())};__onTouchStart=event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate")||!TcHmi.Access.checkAccess(this,"viewDetails"))return;if(!(event.target instanceof Element))return;let tableRow=event.target;for(;tableRow&&(!tableRow.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")||!tableRow.classList.contains("tchmi-datagrid-template-row"));)tableRow=tableRow.parentElement;let now=Date.now();tableRow&&(now-this.__doubletapStartTime<300?(TcHmi.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails(),this.__doubletapStartTime=0,event.preventDefault()):this.__doubletapStartTime=now)};__onScroll=event=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&TcHmi.Access.checkAccess(this,"viewDetails")&&(this.__doubletapStartTime=0)};__showDetails(){this.__allowDetailsPopup&&(this.__detailsPopup||(this.__detailsPopup=new Beckhoff.TcHmiEventGridPopups.DetailsPopup(this.__elementDetailsPopup[0],this)),this.__detailsPopup.update(this.__datagrid.getSelectedRowValue()),this.__detailsPopup.show())}__processSelectedItem(){let event=this.__datagrid.getSelectedRowValue();null===event?(this.__menuBarButtons.get("confirm").setIsEnabled(!1),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.hide()):(this.__menuBarButtons.get("confirm").setIsEnabled(TcHmi.Server.Events.isAlarm(event)&&event.confirmationState===TcHmi.Server.Events.ConfirmationState.WaitForConfirmation),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.update(event))}__updateSubscription(unsubscribeOnly=!1){if(TCHMI_DESIGNER)return;if(null!==this.__subscriptionId&&TcHmi.Server.unsubscribeEx(this.__subscriptionId,null,(data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.details))})),this.__subscriptionId=null,unsubscribeOnly||!this.__isAttached)return;let commands=this.__getToggleButtonCommands(),[confirmableCommand,confirmableHandler]=this.__getConfirmAllCommand();commands.set(confirmableCommand,confirmableHandler);let[canConfirmCommand,canConfirmHandler]=this.__getCanConfirmCommand();commands.set(canConfirmCommand,canConfirmHandler),commands.size>0&&(this.__subscriptionId=TcHmi.Server.subscribeEx(Array.from(commands.keys()),this.__serverInterval??TcHmi.Config.get().tcHmiServer.websocketIntervalTime??500,null,this.__getServerResponseHandler(commands)))}__getServerResponseHandler(commands){const propertiesToCheck=["symbol","customerData","writeValue","filter","orderBy","limit","offset"];return data=>{if(data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.response.error));else if(data.response.commands&&0!==data.response.commands.length)for(const command of data.response.commands)if(command.error)TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.response.commands[0].error));else for(const[checkCommand,handler]of commands){let matches=!0;for(let prop of Object.keys(checkCommand))if(propertiesToCheck.includes(prop)&&!tchmi_equal(checkCommand[prop],command[prop])){matches=!1;break}if(matches){handler(command,data);break}}else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:"Missing commands in response from server with id: "+data.response.id,domain:this.__type}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));else TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.details))}}__getToggleButtonCommands(){const commands=new Map;function getToggleButtonSubscriptionHandler(toggleButton){return(command,data)=>{toggleButton.setText(command.maxEntries?command.maxEntries.toString():"0")}}for(const[type,button]of this.__typeToggles){if(!button)continue;const filter=new TcHmi.FilterInstance("type","==",type).and(this.__internalFilter).getFilter();commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:filter},getToggleButtonSubscriptionHandler(button))}for(const[severity,button]of this.__severityToggles){if(!button)continue;const filter=new TcHmi.FilterInstance("severity","==",severity).and(this.__noPayloadsFilter).getFilter();commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:filter},getToggleButtonSubscriptionHandler(button))}return commands}__getConfirmAllCommand(){return[{commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter(),limit:0},(command,data)=>{this.__menuBarButtons.get("confirmAll")?.setIsEnabled((command.maxEntries??0)>0)}]}__getConfirmAllFilter(){return new TcHmi.FilterInstance("type","==",TcHmi.Server.Events.Type.Alarm).and("confirmationState","==",TcHmi.Server.Events.ConfirmationState.WaitForConfirmation).and(this.__internalFilter).getFilter()}__getCanConfirmCommand(){return[{commandOptions:["SendErrorMessage","SendWriteValue"],symbol:"GetSymbolAccess",writeValue:"ConfirmAlarm"},(cmd,data)=>{this.__setCanConfirm((cmd.readValue??TcHmi.Server.ACCESS.NONE)>=TcHmi.Server.ACCESS.WRITE)}]}__getThemedIcons(){let getThemedIconValue=name=>{let themedResource=TcHmi.Theme.Resources.get(this,name);return themedResource.error===TcHmi.Errors.NONE&&themedResource.value?(themedResource.value.imagePath=TcHmi.Theme.Resources.resolveBasePath(this,themedResource)+themedResource.value.imagePath,themedResource.value):null},icons={types:new Map,severities:new Map};return icons.types.set(TcHmi.Server.Events.Type.Message,getThemedIconValue("MessageIcon")),icons.types.set(TcHmi.Server.Events.Type.Alarm,getThemedIconValue("AlarmIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Verbose,getThemedIconValue("VerboseIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Info,getThemedIconValue("InfoIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Warning,getThemedIconValue("WarningIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Error,getThemedIconValue("ErrorIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Critical,getThemedIconValue("CriticalIcon")),icons}setColumns(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Columns"));let resolverInfo=this.__objectResolvers.get("columns");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("columns",{resolver:resolver,watchCallback:this.__onResolverForColumnsWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForColumnsWatchCallback)})}__onResolverForColumnsWatchCallback=data=>{this.__isAttached||this.__suspendObjectResolver("columns"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.getColumns())||(this.__columns=data.value,this.__processColumns()):TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=Columns] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))};getColumns(){return void 0!==this.__columns?this.__internalColumns:void 0}__processColumns(){this.__updateColumns(this.__columns??[],!0)}__updateColumns(columns,forceRaiseEvent=!1){const raiseEvent=forceRaiseEvent||!tchmi_equal(this.__internalColumns,columns);this.__internalColumns=columns,raiseEvent&&TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Columns"});let columnConfig=columns.map((column=>{let dgColumn;return dgColumn=this.__availableColumns[column.columnName]?tchmi_clone_object(this.__availableColumns[column.columnName]):{name:column.columnName,label:column.label??column.columnName,control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:50,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},void 0!==column.width&&(dgColumn.width=column.width,column.widthUnit&&(dgColumn.widthUnit=column.widthUnit)),("type"===dgColumn.name||"severity"===dgColumn.name)&&dgColumn.dataDefinitions&&Array.isArray(dgColumn.dataDefinitions)&&dgColumn.dataDefinitions.forEach((definition=>{let icon="type"===dgColumn.name?this.__themedIcons.types.get(definition.value):this.__themedIcons.severities.get(definition.value);icon&&(definition.source=icon.imagePath,definition.width=icon.width,definition.height=icon.height)})),dgColumn.sortable&&void 0!==column.sortable&&(dgColumn.sortable=column.sortable),column.format&&!1!==column.format.active&&(dgColumn.format=column.format),dgColumn.ignoreEscapeSequences=this.__ignoreEscapeSequences,dgColumn}));this.__datagrid.setSrcColumn(columnConfig)}setFilter(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Filter"));let resolverInfo=this.__objectResolvers.get("filter");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("filter",{resolver:resolver,watchCallback:this.__onResolverForFilterWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForFilterWatchCallback)})}__onResolverForFilterWatchCallback=data=>{this.__isAttached||this.__suspendObjectResolver("filter"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.getFilter())||(this.__filter=data.value,this.__processFilter()):TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=Filter] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))};getFilter(){return this.__filter?this.__internalFilter:this.__filter}__processFilter(){this.__updateFilter(this.__filter??[],!0)}__updateFilter(filter,forceRaiseEvent=!1){const raiseEvent=forceRaiseEvent||!tchmi_equal(this.__internalFilter,filter);this.__internalFilter=filter,raiseEvent&&TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Filter"}),this.__isAttached&&(this.__noPayloadsFilter=new TcHmi.FilterInstance(filter).wrapInBrackets().and("type","!=",TcHmi.Server.Events.Type.Payload),this.__updateDatagridFilter(),this.__updateSubscription())}__updateDatagridFilter(){let hideFilter=new TcHmi.FilterInstance(this.__noPayloadsFilter);for(const[type,show]of this.__typesToShow)show||hideFilter.and("type","!=",type);for(const[severity,show]of this.__severitiesToShow)show||hideFilter.and("severity","!=",severity);this.__datagrid.setFilter(hideFilter.getFilter())}setSorting(valueNew){this.__datagrid.setSorting(valueNew),this.__sortingInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Sorting"}),this.__sortingInitialized=!0)}getSorting(){return this.__sortingInitialized?this.__datagrid.getSorting():void 0}setServerInterval(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerInterval")),convertedValue!==this.__serverInterval&&(this.__serverInterval=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerInterval"}),this.__processServerInterval())}getServerInterval(){return this.__serverInterval}__processServerInterval(){void 0!==this.__serverInterval&&null!==this.__serverInterval?this.__datagrid.setDataSymbol(new TcHmi.Symbol(`%s%ListEvents|Interval=${this.__serverInterval}%/s%`)):this.__datagrid.setDataSymbol(new TcHmi.Symbol("%s%ListEvents%/s%")),this.__updateSubscription()}setHeaderFontFamily(valueNew){this.__datagrid.setHeaderFontFamily(valueNew),this.__headerFontFamilyInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontFamily"}),this.__headerFontFamilyInitialized=!0)}getHeaderFontFamily(){return this.__headerFontFamilyInitialized?this.__datagrid.getHeaderFontFamily():void 0}setHeaderFontSize(valueNew){this.__datagrid.setHeaderFontSize(valueNew),this.__headerFontSizeInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSize"}),this.__headerFontSizeInitialized=!0)}getHeaderFontSize(){return this.__headerFontSizeInitialized?this.__datagrid.getHeaderFontSize():void 0}setHeaderFontSizeUnit(valueNew){this.__datagrid.setHeaderFontSizeUnit(valueNew),this.__headerFontSizeUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSizeUnit"}),this.__headerFontSizeUnitInitialized=!0)}getHeaderFontSizeUnit(){return this.__headerFontSizeUnitInitialized?this.__datagrid.getHeaderFontSizeUnit():void 0}setHeaderFontStyle(valueNew){this.__datagrid.setHeaderFontStyle(valueNew),this.__headerFontStyleInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontStyle"}),this.__headerFontStyleInitialized=!0)}getHeaderFontStyle(){return this.__headerFontStyleInitialized?this.__datagrid.getHeaderFontStyle():void 0}setHeaderFontWeight(valueNew){this.__datagrid.setHeaderFontWeight(valueNew),this.__headerFontWeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontWeight"}),this.__headerFontWeightInitialized=!0)}getHeaderFontWeight(){return this.__headerFontWeightInitialized?this.__datagrid.getHeaderFontWeight():void 0}setGridFontFamily(valueNew){this.__datagrid.setGridFontFamily(valueNew),this.__datagrid.setRowNumbersFontFamily(valueNew),this.__gridFontFamilyInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontFamily"}),this.__gridFontFamilyInitialized=!0)}getGridFontFamily(){return this.__gridFontFamilyInitialized?this.__datagrid.getGridFontFamily():void 0}setGridFontSize(valueNew){this.__datagrid.setGridFontSize(valueNew),this.__datagrid.setRowNumbersFontSize(valueNew),this.__gridFontSizeInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSize"}),this.__gridFontSizeInitialized=!0)}getGridFontSize(){return this.__gridFontSizeInitialized?this.__datagrid.getGridFontSize():void 0}setGridFontSizeUnit(valueNew){this.__datagrid.setGridFontSizeUnit(valueNew),this.__datagrid.setRowNumbersFontSizeUnit(valueNew),this.__gridFontSizeUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSizeUnit"}),this.__gridFontSizeUnitInitialized=!0)}getGridFontSizeUnit(){return this.__gridFontSizeUnitInitialized?this.__datagrid.getGridFontSizeUnit():void 0}setGridFontStyle(valueNew){this.__datagrid.setGridFontStyle(valueNew),this.__datagrid.setRowNumbersFontStyle(valueNew),this.__gridFontStyleInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontStyle"}),this.__gridFontStyleInitialized=!0)}getGridFontStyle(){return this.__gridFontStyleInitialized?this.__datagrid.getGridFontStyle():void 0}setGridFontWeight(valueNew){this.__datagrid.setGridFontWeight(valueNew),this.__datagrid.setRowNumbersFontWeight(valueNew),this.__gridFontWeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontWeight"}),this.__gridFontWeightInitialized=!0)}getGridFontWeight(){return this.__gridFontWeightInitialized?this.__datagrid.getGridFontWeight():void 0}setHeaderHeight(valueNew){this.__datagrid.setHeaderHeight(valueNew),this.__headerHeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeight"}),this.__headerHeightInitialized=!0)}getHeaderHeight(){return this.__headerHeightInitialized?this.__datagrid.getHeaderHeight():void 0}setHeaderHeightUnit(valueNew){this.__datagrid.setHeaderHeightUnit(valueNew),this.__headerHeightUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeightUnit"}),this.__headerHeightUnitInitialized=!0)}getHeaderHeightUnit(){return this.__headerHeightUnitInitialized?this.__datagrid.getHeaderHeightUnit():void 0}setRowHeight(valueNew){this.__datagrid.setRowHeight(valueNew),this.__rowHeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"RowHeight"}),this.__rowHeightInitialized=!0)}getRowHeight(){return this.__rowHeightInitialized?this.__datagrid.getRowHeight():void 0}getRowHeightUnit(){return"px"}setIgnoreEscapeSequences(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("IgnoreEscapeSequences")),convertedValue!==this.__ignoreEscapeSequences&&(this.__ignoreEscapeSequences=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IgnoreEscapeSequences"}),this.__processColumns())}getIgnoreEscapeSequences(){return this.__ignoreEscapeSequences}setAllowDetailsPopup(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowDetailsPopup")),convertedValue!==this.__allowDetailsPopup&&(this.__allowDetailsPopup=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowDetailsPopup"}),this.__processAllowDetailsPopup())}getAllowDetailsPopup(){return this.__allowDetailsPopup}__processAllowDetailsPopup(){}setShowMenuBar(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ShowMenuBar")),convertedValue!==this.__showMenuBar&&(this.__showMenuBar=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowMenuBar"}),this.__processShowMenuBar())}getShowMenuBar(){return this.__showMenuBar}__processShowMenuBar(){this.__showMenuBar?(TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display",null),this.__fixVerticalMenuBarWidth()):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display","none")}setMenuBarPosition(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);(null===convertedValue||"Top"!==convertedValue&&"Bottom"!==convertedValue&&"Left"!==convertedValue&&"Right"!==convertedValue)&&(convertedValue=this.getAttributeDefaultValueInternal("MenuBarPosition")),convertedValue!==this.__menuBarPosition&&(this.__menuBarPosition=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"MenuBarPosition"}),this.__processMenuBarPosition())}getMenuBarPosition(){return this.__menuBarPosition}__processMenuBarPosition(){switch(this.__menuBarPosition){case"Top":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction",null),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Bottom":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","column-reverse"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Left":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column");break;case"Right":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row-reverse"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column")}this.__fixVerticalMenuBarWidth()}setButtonFontFamily(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontFamily")),convertedValue!==this.__buttonFontFamily&&(this.__buttonFontFamily=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontFamily"}),this.__processButtonFontFamily())}getButtonFontFamily(){return this.__buttonFontFamily}__processButtonFontFamily(){for(const button of this.__typeToggles.values())button&&button.setTextFontFamily(this.__buttonFontFamily??null);for(const button of this.__severityToggles.values())button&&button.setTextFontFamily(this.__buttonFontFamily??null)}setButtonFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontSize")),convertedValue!==this.__buttonFontSize&&(this.__buttonFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSize"}),this.__processButtonFontSize())}getButtonFontSize(){return this.__buttonFontSize}__processButtonFontSize(){for(const button of this.__typeToggles.values())button&&button.setTextFontSize(this.__buttonFontSize??null);for(const button of this.__severityToggles.values())button&&button.setTextFontSize(this.__buttonFontSize??null)}setButtonFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toDimensionUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontSizeUnit")),convertedValue!==this.__buttonFontSizeUnit&&(this.__buttonFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSizeUnit"}),this.__processButtonFontSizeUnit())}getButtonFontSizeUnit(){return this.__buttonFontSizeUnit}__processButtonFontSizeUnit(){for(const button of this.__typeToggles.values())button&&button.setTextFontSizeUnit(this.__buttonFontSizeUnit??null);for(const button of this.__severityToggles.values())button&&button.setTextFontSizeUnit(this.__buttonFontSizeUnit??null)}setButtonFontStyle(valueNew){let convertedValue=TcHmi.ValueConverter.toFontStyle(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontStyle")),convertedValue!==this.__buttonFontStyle&&(this.__buttonFontStyle=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontStyle"}),this.__processButtonFontStyle())}getButtonFontStyle(){return this.__buttonFontStyle}__processButtonFontStyle(){for(const button of this.__typeToggles.values())button&&button.setTextFontStyle(this.__buttonFontStyle??null);for(const button of this.__severityToggles.values())button&&button.setTextFontStyle(this.__buttonFontStyle??null)}setButtonFontWeight(valueNew){let convertedValue=TcHmi.ValueConverter.toFontWeight(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontWeight")),convertedValue!==this.__buttonFontWeight&&(this.__buttonFontWeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontWeight"}),this.__processButtonFontWeight())}getButtonFontWeight(){return this.__buttonFontWeight}__processButtonFontWeight(){for(const button of this.__typeToggles.values())button&&button.setTextFontWeight(this.__buttonFontWeight??null);for(const button of this.__severityToggles.values())button&&button.setTextFontWeight(this.__buttonFontWeight??null)}setButtonHeight(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonHeight")),convertedValue!==this.__buttonHeight&&(this.__buttonHeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonHeight"}),this.__processButtonHeight())}getButtonHeight(){return this.__buttonHeight}__processButtonHeight(){for(const button of this.__typeToggles.values())button&&(button.setHeight(this.__buttonHeight??null),button.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const button of this.__severityToggles.values())button&&(button.setHeight(this.__buttonHeight??null),button.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const button of this.__menuBarButtons.values())button&&(button.setHeight(this.__buttonHeight??null),button.setWidth(this.__buttonHeight??null));this.__fixVerticalMenuBarWidth()}getButtonHeightUnit(){return"px"}__fixVerticalMenuBarWidth(){let flexboxes=this.__elementMenuBar.add(this.__elementMenuBar.children());if(TcHmi.StyleProvider.setSimpleElementStyle(flexboxes,"min-width",null),"Left"===this.__menuBarPosition||"Right"===this.__menuBarPosition)for(let i=flexboxes.length-1;i>=0;i--){let lastElement=flexboxes[i].lastElementChild;if(lastElement){let menuBarWidth=lastElement.getBoundingClientRect().right-flexboxes[i].getBoundingClientRect().left;TcHmi.StyleProvider.setSimpleElementStyle(flexboxes[i],"min-width",menuBarWidth+"px")}}}getSelectedEvent(){return this.__datagrid?this.__datagrid.getSelectedRowValue():null}confirmSelectedAlarm(ctx){if(!ctx)throw new TypeError("Parameter 'ctx' must be defined.");if(!ctx.success||!ctx.error)throw new TypeError("Parameter 'ctx' must be defined properly. Either 'success' or 'error' or both are missing.");if("function"!=typeof ctx.success||"function"!=typeof ctx.error)throw new TypeError("Parameter 'ctx' must be defined properly. Either 'success' or 'error' or both are not of type 'function'.");let alarm=this.getSelectedEvent();alarm?TcHmi.Server.Events.isAlarm(alarm)?TcHmi.Server.Events.confirmAlarm(alarm,(data=>{data.error!==TcHmi.Errors.NONE?(TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+"] Unable to confirm alarm with id "+alarm.id+" in domain "+alarm.domain+". Error: "+TcHmi.Log.buildMessage(data.details)),ctx.error(data.error,data.details)):ctx.success(data.error)})):ctx.error(TcHmi.Errors.E_INVALID,{code:TcHmi.Errors.E_INVALID,message:TcHmi.Errors[TcHmi.Errors.E_INVALID],reason:"The selected event is not an alarm. Select an alarm to be able to confirm it.",domain:this.__type}):ctx.success(TcHmi.Errors.NONE)}confirmAllAlarms(ctx){if(!ctx)throw new TypeError("Parameter 'ctx' must be defined.");if(!ctx.success||!ctx.error)throw new TypeError("Parameter 'ctx' must be defined properly. Either 'success' or 'error' or both are missing.");if("function"!=typeof ctx.success||"function"!=typeof ctx.error)throw new TypeError("Parameter 'ctx' must be defined properly. Either 'success' or 'error' or both are not of type 'function'.");const commands=new Map;commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter()},((command,data)=>{if(!command.readValue){let error={code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:'Missing property: "readValue" in command for symbol: "ListEvents" in response from server with id: '+data.response?.id,domain:this.__type};return TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(error)),void ctx.error(TcHmi.Errors.E_SERVER_READVALUE_MISSING,error)}const alarms=command.readValue.map(TcHmi.Server.Events.parseServerEvent).filter(TcHmi.Server.Events.isAlarm);let confirmErrors=[];for(let i=0,ii=alarms.length;i<ii;i++)TcHmi.Server.Events.confirmAlarm(alarms[i],(data=>{if(data.error!==TcHmi.Errors.NONE&&(TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+"] Unable to confirm alarm with id "+alarms[i].id+" in domain "+alarms[i].domain+". Error: "+TcHmi.Log.buildMessage(data.details)),data.details&&confirmErrors.push(data.details)),"object"==typeof data.details&&null!==data.details&&data.details.code===TcHmi.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__setCanConfirm(!1),i===alarms.length-1)if(1===confirmErrors.length)ctx.error(confirmErrors[0].code,confirmErrors[0]);else if(confirmErrors.length>1){let error={code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"[Source=Control, Module="+this.__type+(TcHmiEventGrid.#tchmiFQN!==this.__type?", Origin="+TcHmiEventGrid.#tchmiFQN:"")+", Id="+this.getId()+"] Unable to confirm multiple alarms.",domain:this.__type,errors:confirmErrors};ctx.error(TcHmi.Errors.ERROR,error)}else ctx.success(TcHmi.Errors.NONE)}))})),TcHmi.Server.requestEx({requestType:"ReadWrite",commands:Array.from(commands.keys())},null,this.__getServerResponseHandler(commands))}__processIsEnabled(){super.__processIsEnabled(),this.getIsEnabled()||this.__hideAllPopups()}__processAccessConfig(){super.__processAccessConfig(),!1!==TcHmi.Access.checkAccess(this,"operate")&&!1!==TcHmi.Access.checkAccess(this,"observe")||this.__hideAllPopups(),TcHmi.Access.checkAccess(this,"configure")||(this.__filterPrompt&&this.__filterPrompt.hide(),this.__columnsPopup&&this.__columnsPopup.hide()),TcHmi.Access.checkAccess(this,"viewDetails")||this.__detailsPopup&&this.__detailsPopup.hide()}__hideAllPopups(){this.__filterPrompt&&this.__filterPrompt.hide(),this.__columnsPopup&&this.__columnsPopup.hide(),this.__detailsPopup&&this.__detailsPopup.hide(),this.__confirmAllPopup&&this.__confirmAllPopup.hide()}__setCanConfirm(value){this.__canConfirm!==value&&(this.__canConfirm=value,this.__detailsPopup&&this.__detailsPopup.__setCanConfirm(value),TcHmi.Access.setControlRightOverride(this.__menuBarButtons.get("confirm"),"operate",value?null:"Deny"),TcHmi.Access.setControlRightOverride(this.__menuBarButtons.get("confirmAll"),"operate",value?null:"Deny"))}__getCanConfirm(){return this.__canConfirm}}Beckhoff.TcHmiEventGrid=TcHmiEventGrid}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiEventGrid","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiEventGrid),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiEventGridPopups){TcHmiEventGridPopups.Popup=class{constructor(element,name,control){if(this.__name=name,this.__parentControl=control,this.__element=element,this.__elementContent=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-content")[0],this.__elementFooter=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-footer")[0],!this.__element||!this.__elementContent||!this.__elementFooter)throw new Error("Invalid Template.html")}__name;__parentControl;__element;__elementContent;__elementFooter;__eventDestroyers=[];__isShowing=!1;show(){this.__isShowing||(TcHmi.TopMostLayer.add(this.__parentControl,this.__element,{removeCb:()=>{this.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(TcHmi.TopMostLayer.remove(this.__parentControl,this.__element),this.__isShowing=!1)}destroy(){for(let i=0,ii=this.__eventDestroyers.length;i<ii;i++)this.__eventDestroyers[i]();this.__eventDestroyers=[]}isShowing(){return this.__isShowing}}}(Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiEventGridPopups){class SettingsPopup extends TcHmiEventGridPopups.Popup{constructor(element,name,control){super(element,name,control);let resetButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.resetButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Reset_Config%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Reset_Config%/l%","data-tchmi-is-enabled":!1},this.__parentControl),okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.okButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Ok%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Ok%/l%"},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Cancel%/l%"},this.__parentControl);if(!resetButton||!okButton||!cancelButton)throw new Error("Could not create controls for SettingsPopup.");const resetButtonElement=resetButton.getElement()[0];resetButtonElement.classList.add("align-left"),this.__elementFooter.appendChild(resetButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(resetButton.getId()+".onPressed",(()=>{this.__onButtonPressed(this.__resetHandlers,!1)}))),this.__elementFooter.appendChild(okButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",(()=>{this.__onButtonPressed(this.__okHandlers,!0)}))),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",(()=>{this.__onButtonPressed(this.__cancelHandlers,!0)}))),this.__resetButton=resetButton}__resetButton;__resetHandlers=[];__okHandlers=[];__cancelHandlers=[];__updateRequired=!0;__onButtonPressed(handlers,hide){this.__updateRequired=!0;for(let i=0,ii=handlers.length;i<ii;i++)!1===handlers[i]()&&(hide=!1);hide&&this.hide()}registerResetButtonHandler(handler){return this.__resetHandlers.push(handler),()=>{let index=this.__resetHandlers.indexOf(handler);-1!==index&&this.__resetHandlers.splice(index,1)}}registerOkButtonHandler(handler){return this.__okHandlers.push(handler),()=>{let index=this.__okHandlers.indexOf(handler);-1!==index&&this.__okHandlers.splice(index,1)}}registerCancelButtonHandler(handler){return this.__cancelHandlers.push(handler),()=>{let index=this.__cancelHandlers.indexOf(handler);-1!==index&&this.__cancelHandlers.splice(index,1)}}update(settings,resetable=!1){this.__settings=tchmi_clone_object(settings),this.__updateRequired=!1,this.__resetButton.setIsEnabled(resetable)}getSettings(){return this.__settings}requiresUpdate(){return this.__updateRequired}}TcHmiEventGridPopups.SettingsPopup=SettingsPopup}(Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiEventGridPopups){class ColumnsPopup extends TcHmiEventGridPopups.SettingsPopup{constructor(element,control){super(element,"columnsPopup",control),this.__elementAvailableColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-available-columns")[0],this.__elementSelectedColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-selected-columns")[0];let elementOrderButtons=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-order-buttons")[0],elementColumnWidth=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-width")[0];this.__elementColumnName=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-name")[0],this.__elementColumnLabel=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-label")[0];let elementColumnSortable=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-sortable")[0];if(!(this.__elementAvailableColumns&&this.__elementSelectedColumns&&elementOrderButtons&&elementColumnWidth&&this.__elementColumnName&&this.__elementColumnLabel&&elementColumnSortable))throw new Error("Invalid Template.html");for(let key in this.__columns)this.__columns.hasOwnProperty(key)&&this.__availableColumns.push({name:key,element:this.__createColumnDiv(this.__columns[key].label,"params::"!==key)});this.__availableColumns.sort(((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order));let upButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.upButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Column_Up%/l%"},this.__parentControl),downButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.downButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Column_Down%/l%"},this.__parentControl),widthTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.widthTextbox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),widthUnitCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__parentControl.getId()}.${this.__name}.widthUnitCombobox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-src-data":[{text:"px",value:"px"},{text:"%",value:"%"},{text:"factor",value:"factor"}],"data-tchmi-content-padding":{left:4,right:4},"data-tchmi-is-enabled":!1},this.__parentControl),nameTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.nameTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:44,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),labelTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.labelTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),sortableCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",`${this.__parentControl.getId()}.${this.__name}.sortableCheckbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-is-enabled":!1},this.__parentControl);if(!(upButton&&downButton&&widthTextbox&&widthUnitCombobox&&nameTextbox&&labelTextbox&&sortableCheckbox))throw new Error("Could not create controls for ColumnsPopup.");this.__upButton=upButton,this.__downButton=downButton,this.__widthTextbox=widthTextbox,this.__widthUnitCombobox=widthUnitCombobox,this.__nameTextbox=nameTextbox,this.__labelTextbox=labelTextbox,this.__sortableCheckbox=sortableCheckbox;let upButtonElement=upButton.getElement()[0];upButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-up-button"),upButtonElement.classList.add("tchmi-event-grid-template-move-up-button"),elementOrderButtons.appendChild(upButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(upButton.getId()+".onPressed",this.__onUpPressed));let downButtonElement=downButton.getElement()[0];downButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-down-button"),downButtonElement.classList.add("tchmi-event-grid-template-move-down-button"),elementOrderButtons.appendChild(downButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(downButton.getId()+".onPressed",this.__onDownPressed)),elementColumnWidth.appendChild(widthTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(widthTextbox.getId()+".onTextChanged",this.__onWidthChanged)),elementColumnWidth.appendChild(widthUnitCombobox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(widthUnitCombobox.getId()+".onSelectionChanged",this.__onWidthUnitChanged)),this.__elementColumnName.appendChild(nameTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(nameTextbox.getId()+".onTextChanged",this.__onNameChanged)),this.__elementColumnLabel.appendChild(labelTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(labelTextbox.getId()+".onTextChanged",this.__onLabelChanged)),elementColumnSortable.appendChild(sortableCheckbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(sortableCheckbox.getId()+".onToggleStateChanged",this.__onSortableChanged)),this.__elementAvailableColumns.addEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.addEventListener("click",this.__onSelectedColumnClick)}__settings=[];__elementAvailableColumns;__elementSelectedColumns;__elementColumnName;__elementColumnLabel;__upButton;__downButton;__widthTextbox;__widthUnitCombobox;__nameTextbox;__labelTextbox;__sortableCheckbox;__availableColumns=new TcHmi.List;__selectedColumns=new TcHmi.List;__columns={type:{label:"Column_Header_Type",order:0,allowSortable:!0},severity:{label:"Column_Header_Severity",order:1,allowSortable:!0},alarmState:{label:"Column_Header_AlarmState",order:2,allowSortable:!0},confirmationState:{label:"Column_Header_ConfirmationState",order:3,allowSortable:!0},domain:{label:"Column_Header_Domain",order:3,allowSortable:!0},sourceDomain:{label:"Column_Header_SourceDomain",order:4,allowSortable:!0},name:{label:"Column_Header_Name",order:5,allowSortable:!0},text:{label:"Column_Header_Text",order:6,allowSortable:!1},timeAndDateRaised:{label:"Column_Header_TimeAndDateRaised",order:7,allowSortable:!0},timeRaised:{label:"Column_Header_TimeRaised",order:8,allowSortable:!0},dateRaised:{label:"Column_Header_DateRaised",order:9,allowSortable:!0},timeAndDateConfirmed:{label:"Column_Header_TimeAndDateConfirmed",order:10,allowSortable:!0},timeConfirmed:{label:"Column_Header_TimeConfirmed",order:11,allowSortable:!0},dateConfirmed:{label:"Column_Header_DateConfirmed",order:12,allowSortable:!0},timeAndDateCleared:{label:"Column_Header_TimeAndDateCleared",order:13,allowSortable:!0},timeCleared:{label:"Column_Header_TimeCleared",order:14,allowSortable:!0},dateCleared:{label:"Column_Header_DateCleared",order:15,allowSortable:!0},"params::":{label:"params::",order:16,allowSortable:!0}};__activeElement=null;__activeColumn=null;destroy(){super.destroy(),this.__elementAvailableColumns.removeEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.removeEventListener("click",this.__onSelectedColumnClick);for(const column of this.__availableColumns)column.name.startsWith("params::")||this.__parentControl.__removeLocalizedElement(column.element);for(const column of this.__selectedColumns)column.name.startsWith("params::")||this.__parentControl.__removeLocalizedElement(column.element)}update(columns,resetable){super.update(columns,resetable);for(let i=0,ii=this.__availableColumns.length;i<ii;i++)this.__availableColumns[i].name.startsWith("params::")||-1===columns.findIndex((column=>column.columnName===this.__availableColumns[i].name))||(this.__selectedColumns.push(this.__availableColumns[i]),this.__availableColumns.splice(i,1),i--,ii--);for(let i=0,ii=this.__selectedColumns.length;i<ii;i++)this.__selectedColumns[i].name.startsWith("params::")?(this.__selectedColumns.splice(i,1),i--,ii--):-1===columns.findIndex((column=>column.columnName===this.__selectedColumns[i].name))&&(this.__availableColumns.push(this.__selectedColumns[i]),this.__selectedColumns.splice(i,1),i--,ii--);columns.filter((column=>column.columnName.startsWith("params::"))).forEach((column=>this.__selectedColumns.push({name:column.columnName,element:this.__createColumnDiv(column.label||column.columnName||"params::")}))),this.__availableColumns.sort(((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order)),this.__selectedColumns.sort(((a,b)=>columns.findIndex((column=>column.columnName===a.name))-columns.findIndex((column=>column.columnName===b.name))));let availableFragment=document.createDocumentFragment();for(let i=0,ii=this.__availableColumns.length;i<ii;i++)availableFragment.appendChild(this.__availableColumns[i].element);this.__elementAvailableColumns.textContent="",this.__elementAvailableColumns.appendChild(availableFragment);let selectedFragment=document.createDocumentFragment();for(let i=0,ii=this.__selectedColumns.length;i<ii;i++)selectedFragment.appendChild(this.__selectedColumns[i].element);this.__elementSelectedColumns.textContent="",this.__elementSelectedColumns.appendChild(selectedFragment),this.__activateColumn(null)}__onAvailableColumnClick=event=>{let target=event.target;if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||target.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let column=target.parentElement,index=this.__availableColumns.findIndex((item=>item.element===column));if(-1===index)return;this.__availableColumns[index].name.startsWith("params::")?(this.__settings.push({columnName:"params::"}),column=this.__createColumnDiv("params::"),this.__elementSelectedColumns.appendChild(column),this.__selectedColumns.push({name:"params::",element:column})):(this.__settings.push({columnName:this.__availableColumns[index].name}),this.__elementSelectedColumns.appendChild(this.__availableColumns[index].element),this.__selectedColumns.push(this.__availableColumns[index]),this.__availableColumns.splice(index,1)),this.__activateColumn(column)}};__onSelectedColumnClick=event=>{let target=event.target;if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column")||target.classList.contains("tchmi-event-grid-template-columns-config-column"))this.__activateColumn(target);else if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||target.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let column=target.parentElement,index=this.__selectedColumns.findIndex((item=>item.element===column));if(-1===index)return;this.__settings.splice(index,1);let changedColumn=this.__selectedColumns[index];if(this.__selectedColumns.splice(index,1),changedColumn.name.startsWith("params::"))this.__elementSelectedColumns.removeChild(changedColumn.element);else{this.__availableColumns.push(changedColumn),this.__availableColumns.sort(((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order));let newIndex=this.__availableColumns.indexOf(changedColumn);-1===newIndex||newIndex>=this.__elementAvailableColumns.children.length?this.__elementAvailableColumns.appendChild(changedColumn.element):this.__elementAvailableColumns.insertBefore(changedColumn.element,this.__elementAvailableColumns.children[newIndex])}this.__activateColumn(null)}};__onUpPressed=()=>{let index=this.__selectedColumns.findIndex((item=>item.element===this.__activeElement));if(-1===index||0===index)return;let activeSetting=this.__settings[index];this.__settings[index]=this.__settings[index-1],this.__settings[index-1]=activeSetting;let activeColumn=this.__selectedColumns[index];this.__selectedColumns[index]=this.__selectedColumns[index-1],this.__selectedColumns[index-1]=activeColumn,this.__activeElement&&this.__activeElement.previousElementSibling&&this.__activeElement.previousElementSibling.insertAdjacentElement("beforebegin",this.__activeElement),this.__updateButtons()};__onDownPressed=()=>{let index=this.__selectedColumns.findIndex((item=>item.element===this.__activeElement));if(-1===index||index===this.__settings.length-1)return;let activeSetting=this.__settings[index];this.__settings[index]=this.__settings[index+1],this.__settings[index+1]=activeSetting;let activeColumn=this.__selectedColumns[index];this.__selectedColumns[index]=this.__selectedColumns[index+1],this.__selectedColumns[index+1]=activeColumn,this.__activeElement&&this.__activeElement.nextElementSibling&&this.__activeElement.nextElementSibling.insertAdjacentElement("afterend",this.__activeElement),this.__updateButtons()};__onWidthChanged=()=>{let text=this.__widthTextbox.getText();if(!text)return this.__widthTextbox.setBackgroundColor(null),void(this.__activeColumn&&void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width&&(delete this.__activeColumn.width,delete this.__activeColumn.widthUnit));let newWidth=parseFloat(text);if(!isNaN(newWidth)&&/^[+-]?\d*\.?\d+(?:[eE][+-]\d+)?$/.test(text)){if(this.__widthTextbox.setBackgroundColor(null),this.__activeColumn&&(this.__activeColumn.width=newWidth,!this.__activeColumn.widthUnit)){let newWidthUnit=this.__widthUnitCombobox.getSelectedValue();newWidthUnit?this.__activeColumn.widthUnit=newWidthUnit:this.__widthUnitCombobox.setSelectedIndex(0)}}else this.__widthTextbox.setBackgroundColor({color:"rgba(255, 0, 0, 1)"})};__onWidthUnitChanged=()=>{if(!this.__activeColumn)return;let newWidthUnit=this.__widthUnitCombobox.getSelectedValue();newWidthUnit?void 0!==this.__activeColumn.width&&(this.__activeColumn.widthUnit=newWidthUnit):delete this.__activeColumn.widthUnit};__onNameChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let newName="params::"+(this.__nameTextbox.getText()||"");this.__activeColumn.columnName=newName,this.__activeColumn.label||(this.__activeElement.firstChild.nodeValue=newName)};__onLabelChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let newLabel=this.__labelTextbox.getText();newLabel?this.__activeColumn.label=newLabel:delete this.__activeColumn.label,this.__activeColumn.label?this.__activeElement.firstChild.nodeValue=this.__activeColumn.label:this.__activeColumn.columnName?this.__activeElement.firstChild.nodeValue=this.__activeColumn.columnName:this.__activeElement.firstChild.nodeValue="params::"};__onSortableChanged=()=>{if(!this.__activeColumn)return;let newSortable=this.__sortableCheckbox.getToggleState();newSortable&&"Active"!==newSortable?this.__activeColumn.sortable=!1:delete this.__activeColumn.sortable};__activateColumn(element){if(this.__activeElement&&this.__activeElement.classList.remove("active"),element){this.__activeElement=element,element.classList.add("active");let index=this.__selectedColumns.findIndex((item=>item.element===element));this.__activeColumn=this.__settings[index]||null}else this.__activeElement=null,this.__activeColumn=null;this.__updateButtons(),this.__updateColumnProperties()}__updateButtons(){this.__upButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.firstElementChild),this.__downButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.lastElementChild)}__updateColumnProperties(){let hideParamsProperties=()=>{this.__nameTextbox.setIsEnabled(!1),this.__labelTextbox.setIsEnabled(!1),this.__elementColumnName.classList.add("hidden"),this.__elementColumnLabel.classList.add("hidden")};if(this.__activeColumn){if(this.__widthTextbox.setIsEnabled(!0),this.__widthUnitCombobox.setIsEnabled(!0),void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width?this.__widthTextbox.setText(this.__activeColumn.width.toString(10)):this.__widthTextbox.setText(null),this.__activeColumn.widthUnit){let index=-1,srcData=this.__widthUnitCombobox.getSrcData();Array.isArray(srcData)&&(index=srcData.findIndex((item=>item.value===this.__activeColumn.widthUnit))),this.__widthUnitCombobox.setSelectedIndex(-1!==index?index:null)}else this.__widthUnitCombobox.setSelectedIndex(null);this.__columns[this.__activeColumn.columnName]?.allowSortable?(this.__sortableCheckbox.setIsEnabled(!0),void 0===this.__activeColumn.sortable?this.__sortableCheckbox.setToggleState("Active"):this.__sortableCheckbox.setToggleState(this.__activeColumn.sortable?"Active":"Normal")):(this.__sortableCheckbox.setIsEnabled(!1),this.__sortableCheckbox.setToggleState("Normal")),this.__activeColumn.columnName.startsWith("params::")?(this.__nameTextbox.setIsEnabled(!0),this.__labelTextbox.setIsEnabled(!0),this.__nameTextbox.setText(this.__activeColumn.columnName.slice(8)),this.__labelTextbox.setText(this.__activeColumn.label||null),this.__elementColumnName.classList.remove("hidden"),this.__elementColumnLabel.classList.remove("hidden")):hideParamsProperties()}else this.__widthTextbox.setIsEnabled(!1),this.__widthUnitCombobox.setIsEnabled(!1),this.__sortableCheckbox.setIsEnabled(!1),this.__widthTextbox.setText(null),this.__widthUnitCombobox.setSelectedIndex(null),this.__sortableCheckbox.setToggleState("Normal"),hideParamsProperties()}__createColumnDiv(label,localize=!1){let columnDiv=document.createElement("div");columnDiv.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column"),columnDiv.classList.add("tchmi-event-grid-template-columns-config-column");let labelSpan=document.createElement("span");labelSpan.textContent=label,localize&&this.__parentControl.__addLocalizedElement(labelSpan,label),columnDiv.appendChild(labelSpan);let columnButton=document.createElement("div");return columnButton.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle"),columnButton.classList.add("tchmi-event-grid-template-columns-config-column-selection-toggle"),columnDiv.appendChild(columnButton),columnDiv}}TcHmiEventGridPopups.ColumnsPopup=ColumnsPopup}(Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiEventGridPopups){class DetailsPopup extends TcHmiEventGridPopups.Popup{static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiEventGridPopups."+this.name;constructor(element,control){super(element,"detailsPopup",control);let confirmButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Details_Confirm%/l%"},this.__parentControl),closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Details_Close%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Details_Close%/l%"},this.__parentControl);if(!confirmButton||!closeButton)throw new Error("Could not create controls for DetailsPopup.");this.__confirmButton=confirmButton;let confirmButtonElement=this.__confirmButton.getElement()[0];confirmButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-button"),confirmButtonElement.classList.add("tchmi-event-grid-template-confirm-button"),this.__elementFooter.appendChild(confirmButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__confirmButton.getId()+".onPressed",(()=>{this.__event&&TcHmi.Server.Events.isAlarm(this.__event)&&TcHmi.Server.Events.confirmAlarm(this.__event,(data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.errorEx("[Source=Control, Module="+TcHmiEventGridPopups.DetailsPopup.#tchmiFQN+", ControlId="+this.__parentControl.getId()+"] Unable to confirm alarm with id "+this.__event.id+" in domain "+this.__event.domain+": "+TcHmi.Log.buildMessage(data.details))}))}))),this.__elementFooter.appendChild(closeButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(closeButton.getId()+".onPressed",(()=>this.hide()))),this.__setCanConfirm(this.__parentControl.__getCanConfirm())}__event=null;__confirmButton;__localizedElements=[];__destroyersToCallOnHide=[];show(){super.show(),this.__destroyersToCallOnHide.push(TcHmi.EventProvider.register("onUserDataChanged",(_evt=>{this.__event&&this.update(this.__event)})))}hide(){super.hide();for(const destroy of this.__destroyersToCallOnHide)destroy();this.__destroyersToCallOnHide=[]}destroy(){super.destroy();for(const element of this.__localizedElements)this.__parentControl.__removeLocalizedElement(element)}update(event){this.__event=event;let fragment=document.createDocumentFragment(),dl=document.createElement("dl");fragment.appendChild(dl);for(const element of this.__localizedElements)this.__parentControl.__removeLocalizedElement(element);let localize=(element,key,parameters)=>{parameters?this.__parentControl.__addLocalizedElement(element,key,...parameters):this.__parentControl.__addLocalizedElement(element,key),this.__localizedElements.push(element)},appendDefinitionItem=(dtContentLocalizationKey,ddContent)=>{let dt=document.createElement("dt");dt.textContent=dtContentLocalizationKey,localize(dt,dtContentLocalizationKey),dl.appendChild(dt);let dd=document.createElement("dd");if(ddContent){let text="object"==typeof ddContent?ddContent.localizationKey:ddContent;this.__parentControl.getIgnoreEscapeSequences()||(text=tchmi_decode_control_characters(text)),dd.textContent=text}else dd.textContent="-";ddContent&&"object"==typeof ddContent&&localize(dd,ddContent.localizationKey,ddContent.formatValues),dl.appendChild(dd)},createObjectDetails=data=>{let dl=document.createElement("dl");for(let key in data)if(data.hasOwnProperty(key)){let dt=document.createElement("dt");dl.appendChild(dt),dt.textContent=key.slice(0,1).toUpperCase()+key.slice(1).replace(/([A-Z]+)/g," $1");let dd=document.createElement("dd");dl.appendChild(dd);let value=data[key];if(null==value||""===value)dd.textContent="-";else if(value instanceof Date)dd.textContent=TcHmi.Localization.formatDate(value);else if("object"==typeof value)dd.appendChild(createObjectDetails(value));else if("string"==typeof value){let parsedJson=null;try{parsedJson=JSON.parse(value)}catch(ex){}if(parsedJson&&"object"==typeof parsedJson)dd.appendChild(createObjectDetails(parsedJson));else{let text=value;this.__parentControl.getIgnoreEscapeSequences()||(text=tchmi_decode_control_characters(text)),dd.textContent=text}}else dd.textContent=value}return dl};appendDefinitionItem("Column_Header_Domain",event.domain),event.type!==TcHmi.Server.Events.Type.Payload&&(appendDefinitionItem("Column_Header_SourceDomain",event.sourceDomain),appendDefinitionItem("Column_Header_Text",event.text)),appendDefinitionItem("Column_Header_Name",event.name);let type="";switch(event.type){case TcHmi.Server.Events.Type.Message:type="Label_Text_Message";break;case TcHmi.Server.Events.Type.Alarm:type="Label_Text_Alarm";break;case TcHmi.Server.Events.Type.Payload:type="Label_Text_Payload"}appendDefinitionItem("Column_Header_Type",{localizationKey:type});const userTimeZone=TcHmi.Server.getCurrentUserConfig().timeZone,timeZoneOffsetMinutes=TcHmi.Server.getCurrentUserConfig().timeZoneOffset/1e3/60,utcOffsetString="UTC "+Math.trunc(timeZoneOffsetMinutes/60).toLocaleString("en-us",{minimumIntegerDigits:2,signDisplay:"always"})+":"+(timeZoneOffsetMinutes%60).toLocaleString("en-us",{minimumIntegerDigits:2,signDisplay:"never"});if(event.type!==TcHmi.Server.Events.Type.Payload){let severity="";switch(event.severity){case TcHmi.Server.Events.Severity.Verbose:severity="Label_Text_Verbose";break;case TcHmi.Server.Events.Severity.Info:severity="Label_Text_Info";break;case TcHmi.Server.Events.Severity.Warning:severity="Label_Text_Warning";break;case TcHmi.Server.Events.Severity.Error:severity="Label_Text_Error";break;case TcHmi.Server.Events.Severity.Critical:severity="Label_Text_Critical"}if(appendDefinitionItem("Column_Header_Severity",{localizationKey:severity}),event.type===TcHmi.Server.Events.Type.Alarm){let alarmState="";switch(event.alarmState){case TcHmi.Server.Events.AlarmState.Raised:alarmState="Label_Text_Raised";break;case TcHmi.Server.Events.AlarmState.Confirmed:alarmState="Label_Text_Confirmed";break;case TcHmi.Server.Events.AlarmState.Cleared:alarmState="Label_Text_Cleared";break;case TcHmi.Server.Events.AlarmState.ClearedAndConfirmed:alarmState="Label_Text_Cleared_And_Confirmed";break;case TcHmi.Server.Events.AlarmState.Invalid:alarmState="Label_Text_Invalid"}event.confirmationState!==TcHmi.Server.Events.ConfirmationState.NotRequired&&event.confirmationState!==TcHmi.Server.Events.ConfirmationState.NotSupported||(alarmState+="_NoConfirmation"),appendDefinitionItem("Column_Header_AlarmState",{localizationKey:alarmState})}appendDefinitionItem("Column_Header_Raised",userTimeZone?{localizationKey:"Date_Format_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeRaised),utcOffsetString,userTimeZone]}:{localizationKey:"Date_Format_Browser_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeRaised),utcOffsetString]}),event.type===TcHmi.Server.Events.Type.Alarm?(void 0!==event.timeCleared&&null!==event.timeCleared&&event.timeCleared.valueOf()>0?appendDefinitionItem("Column_Header_Cleared",userTimeZone?{localizationKey:"Date_Format_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeCleared),utcOffsetString,userTimeZone]}:{localizationKey:"Date_Format_Browser_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeCleared),utcOffsetString]}):appendDefinitionItem("Column_Header_Cleared",""),void 0!==event.timeConfirmed&&null!==event.timeConfirmed&&event.timeConfirmed.valueOf()>0?appendDefinitionItem("Column_Header_Confirmed",userTimeZone?{localizationKey:"Date_Format_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeConfirmed),utcOffsetString,userTimeZone]}:{localizationKey:"Date_Format_Browser_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeConfirmed),utcOffsetString]}):appendDefinitionItem("Column_Header_Confirmed",""),this.__confirmButton.setIsEnabled(event.confirmationState===TcHmi.Server.Events.ConfirmationState.WaitForConfirmation)):this.__confirmButton.setIsEnabled(!1)}else appendDefinitionItem("Column_Header_Received",userTimeZone?{localizationKey:"Date_Format_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeReceived),utcOffsetString,userTimeZone]}:{localizationKey:"Date_Format_Browser_Timezone",formatValues:[TcHmi.Localization.formatDate(event.timeReceived),utcOffsetString]}),this.__confirmButton.setIsEnabled(!1);if(event.type!==TcHmi.Server.Events.Type.Payload){let dtParams=document.createElement("dt");dtParams.textContent="Column_Header_Parameters",localize(dtParams,"Column_Header_Parameters"),dl.appendChild(dtParams);let ddParams=document.createElement("dd");event.params&&Object.keys(event.params).length>0?ddParams.appendChild(createObjectDetails(event.params)):ddParams.textContent="-",dl.appendChild(ddParams)}else{let dtPayload=document.createElement("dt");dtPayload.textContent="Column_Header_Payload",localize(dtPayload,"Column_Header_Payload"),dl.appendChild(dtPayload);let ddPayload=document.createElement("dd");dl.appendChild(ddPayload),void 0!==event.payload&&null!==event.payload?event.payload instanceof Date?ddPayload.textContent=TcHmi.Localization.formatDate(event.payload):"object"==typeof event.payload?ddPayload.appendChild(createObjectDetails(event.payload)):ddPayload.textContent=event.payload:ddPayload.textContent="-"}this.__elementContent.textContent="",this.__elementContent.appendChild(fragment)}getEvent(){return this.__event}__setCanConfirm(value){TcHmi.Access.setControlRightOverride(this.__confirmButton,"operate",value?null:"Deny")}}TcHmiEventGridPopups.DetailsPopup=DetailsPopup}(Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiEventGridPopups){class ConfirmAllPopup extends TcHmiEventGridPopups.Popup{static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiEventGridPopups."+this.name;constructor(element,control){if(super(element,"confirmAllPopup",control),this.__elementAlarmCount=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup-alarm-count")[0],!this.__elementAlarmCount)throw new Error("Invalid Template.html");let datagrid=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",`${this.__parentControl.getId()}.${this.__name}.datagrid`,{"data-tchmi-src-column":[{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/critical.svg"}]},{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Raised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center"},{name:"text",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Text%/l%",control:"TextBlock",width:300,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"}]},this.__parentControl),yesButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_ConfirmAll_Yes%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll_Yes%/l%","data-tchmi-is-enabled":!1},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll_Cancel%/l%"},this.__parentControl);if(!datagrid||!yesButton||!cancelButton)throw new Error("Could not create controls for ConfirmAllPopup.");this.__datagrid=datagrid,this.__yesButton=yesButton,this.__elementContent.appendChild(this.__datagrid.getElement()[0]),this.__elementFooter.appendChild(yesButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(yesButton.getId()+".onPressed",(()=>{for(let i=0,ii=this.__alarms.length;i<ii;i++)TcHmi.Server.Events.confirmAlarm(this.__alarms[i],(data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.errorEx("[Source=Control, Module="+TcHmiEventGridPopups.ConfirmAllPopup.#tchmiFQN+", ControlId="+this.__parentControl.getId()+"] Unable to confirm alarm with id "+this.__alarms[i].id+" in domain "+this.__alarms[i].domain+". Error: "+TcHmi.Log.buildMessage(data.details))}));this.hide()}))),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",(()=>this.hide())))}__alarms=[];__datagrid;__yesButton;__elementAlarmCount;destroy(){super.destroy(),this.__parentControl.__removeLocalizedElement(this.__elementAlarmCount)}update(alarms){this.__alarms=alarms,this.__parentControl.__removeLocalizedElement(this.__elementAlarmCount),this.__datagrid.setSrcData(this.__alarms),this.__yesButton.setIsEnabled(this.__alarms.length>0),1===this.__alarms.length?this.__parentControl.__addLocalizedElement(this.__elementAlarmCount,"Label_Text_ConfirmAll_Sure_Singular"):this.__parentControl.__addLocalizedElement(this.__elementAlarmCount,"Label_Text_ConfirmAll_Sure_Plural",this.__alarms.length),this.__elementContent.style.height=30*this.__alarms.length+70+"px"}getAlarms(){return this.__alarms}}TcHmiEventGridPopups.ConfirmAllPopup=ConfirmAllPopup}(Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));