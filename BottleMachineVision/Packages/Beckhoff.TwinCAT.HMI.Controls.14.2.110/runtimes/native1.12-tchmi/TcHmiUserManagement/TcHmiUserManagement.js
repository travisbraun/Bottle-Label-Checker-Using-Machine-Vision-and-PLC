"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Beckhoff){class TcHmiUserManagement extends TcHmi.Controls.System.TcHmiControl{static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__elementTemplateRoot;__elementBase;__elementDropdown;__resizedEventDestroyEvent=null;__movedEventDestroyEvent=null;__dropdownboxOpen=!1;__textFontSize;__textFontSizeUnit;__userNameFontSize;__userNameFontSizeUnit;__headlineFontSize;__headlineFontSizeUnit;__subHeadlineFontSize;__subHeadlineFontSizeUnit;__dropDownFontSize;__dropDownFontSizeUnit;__textColor;__logoutButton;__switchUserButton;__editUserButton;__userManagementButton;__touches=[];__allowLogout;__allowSwitchUser;__mouseDown=!1;__advanced=!1;__switchUserPopup;__editUserPopup;__manageUserPopup;__localizedElements=new Map;__localizationReader=void 0;__destroyLocalizationWatch=null;__showUsermanagementButtons={editUser:!1,userManagement:!1};__previnit(){if(this.__elementTemplateRoot=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Template")[0],!this.__elementTemplateRoot)throw new Error("Invalid Template.html");if(this.__elementBase=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Base")[0],!this.__elementBase)throw new Error("Invalid Template.html");if(this.__elementDropdown=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiUserManagement-Dropdown")[0],!this.__elementDropdown)throw new Error("Invalid Template.html");this.__elementTemplateRoot.removeChild(this.__elementDropdown);let localizedElements=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__destroyLocalizationWatch=this.__localization.watch((data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}})),super.__previnit()}__init(){super.__init()}__attach(){super.__attach();const passiveEventOptions={passive:!0,capture:!1};document.addEventListener("mouseup",this.__onMouseUp,passiveEventOptions),document.addEventListener("touchend",this.__onMouseUp,passiveEventOptions),this.__destroyOnDetach.push(TcHmi.EventProvider.register(this.getId()+".onPressed",this.__onExpandDropdown),TcHmi.EventProvider.register(this.getId()+".onMouseDown",this.__onExpandDropdownMouseDown),TcHmi.EventProvider.register(this.getId()+".onTouchStart",this.__onExpandDropdownMouseDown),TcHmi.EventProvider.register(this.getId()+".onMouseEnter",this.__onExpandDropdownMouseEnter),TcHmi.EventProvider.register(this.getId()+".onMouseLeave",this.__onExpandDropdownMouseLeave),TcHmi.EventProvider.register(this.getId()+".onTouchEnd",this.__onExpandDropdownMouseLeave),TcHmi.EventProvider.register(this.getId()+".onTouchCancel",this.__onExpandDropdownMouseLeave),TcHmi.EventProvider.register("onUserDataChanged",this.__onUserDataChanged));let userName=TcHmi.Server.getCurrentUser();this.__elementBase.textContent=null!==userName?userName:"<unknown>",this.__getApiAccessForDomains()}__detach(){super.__detach();const passiveEventOptions={passive:!0,capture:!1};document.removeEventListener("mouseup",this.__onMouseUp,passiveEventOptions),document.removeEventListener("touchend",this.__onMouseUp,passiveEventOptions),this.__removeDropDownbutton(this.__logoutButton,this.__onLogout),this.__removeDropDownbutton(this.__switchUserButton,this.__onSwitchUser),this.__removeDropDownbutton(this.__userManagementButton,this.__onUserManagement),this.__removeDropDownbutton(this.__editUserButton,this.__onEditUser)}destroy(){this.__keepAlive||(super.destroy(),this.__switchUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__switchUserPopup?.onHide.remove(this.__onPopupClosed),this.__switchUserPopup?.destroy(),this.__switchUserPopup=void 0,this.__editUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__editUserPopup?.onHide.remove(this.__onPopupClosed),this.__editUserPopup?.destroy(),this.__editUserPopup=void 0,this.__manageUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__manageUserPopup?.onHide.remove(this.__onPopupClosed),this.__manageUserPopup?.destroy(),this.__manageUserPopup=void 0,this.__resizedEventDestroyEvent?.(),this.__resizedEventDestroyEvent=null,this.__movedEventDestroyEvent?.(),this.__movedEventDestroyEvent=null,this.__destroyLocalizationWatch?.(),this.__destroyLocalizationWatch=null)}__onDocumentClick=evt=>{!this.__dropdownboxOpen||this.__element[0].contains(evt.target)||this.__elementDropdown.contains(evt.target)||(this.__setDropDownboxOpen(!1),TcHmi.EventProvider.raise(this.__id+".onUserInteractionCanceled"))};__resizeDropDownBox=evt=>{const documentBCR=document.documentElement.getBoundingClientRect(),controlBCR=this.__element[0].getBoundingClientRect(),dropdownBCR=this.__elementDropdown.getBoundingClientRect(),style={top:controlBCR.top+controlBCR.height+"px",left:controlBCR.left+"px",right:null,"min-width":controlBCR.width+"px","max-height":documentBCR.height-controlBCR.bottom+"px"};documentBCR.height-controlBCR.bottom<controlBCR.top&&dropdownBCR.height>documentBCR.height-controlBCR.bottom?(style.top=controlBCR.top-dropdownBCR.height+"px",style["max-height"]=controlBCR.top+"px",this.__elementDropdown.classList.add("above-control")):this.__elementDropdown.classList.remove("above-control"),documentBCR.width-controlBCR.left<dropdownBCR.width&&controlBCR.right>=dropdownBCR.width&&(style.left=null,style.right=documentBCR.width-controlBCR.right+"px"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementDropdown,style)};__setDropDownboxOpen(valueNew){if(void 0===valueNew&&(valueNew=!this.__dropdownboxOpen),valueNew){this.__dropdownboxOpen=!0;let topMostLayerOptions={removeCb:data=>{this.__dropdownboxOpen=!1,this.__elementTemplateRoot.classList.remove("active"),this.__elementDropdown.classList.remove("active"),null!==this.__resizedEventDestroyEvent&&(this.__resizedEventDestroyEvent(),this.__resizedEventDestroyEvent=null),null!==this.__movedEventDestroyEvent&&(this.__movedEventDestroyEvent(),this.__movedEventDestroyEvent=null);document.removeEventListener("click",this.__onDocumentClick,{passive:!0,capture:!1})},dimBackground:!1,modal:!1};this.__resizedEventDestroyEvent=TcHmi.EventProvider.register(this.__id+".onResized",this.__resizeDropDownBox),this.__movedEventDestroyEvent=TcHmi.EventProvider.register(this.__id+".onMoved",this.__resizeDropDownBox);const passiveEventOptions={passive:!0,capture:!1};document.addEventListener("click",this.__onDocumentClick,passiveEventOptions),TcHmi.TopMostLayer.add(this,this.__elementDropdown,topMostLayerOptions),this.__resizeDropDownBox()}else TcHmi.TopMostLayer.remove(this,this.__elementDropdown)}updateDropdown(){this.__getApiAccessForDomains()}__getApiAccessForDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);let showUsermanagementButtons={editUser:!1,userManagement:!1},accessCount=0;domains.forEach((domain=>{TcHmi.Server.UserManagement.getApiAccess({domain:domain},(data=>{accessCount++,data.error===TcHmi.Errors.NONE&&data.result&&((data.result.updateUser.changeOwnPassword||data.result.updateUser.addGroups&&data.result.updateUser.removeGroups||data.result.updateUser.locale||data.result.updateUser.timeZone)&&TcHmi.Access.checkAccess(this,"EditUserProperties")&&(showUsermanagementButtons.editUser=!0),(data.result.addUser.general||data.result.removeUser.general||data.result.updateUser.addGroups&&data.result.updateUser.removeGroups)&&TcHmi.Access.checkAccess(this,"UserManagement")&&(showUsermanagementButtons.userManagement=!0)),accessCount>=domains.length&&(this.__showUsermanagementButtons=showUsermanagementButtons,this.__fillDropdown())}))}))}}))}__fillDropdown(){let fragment=document.createDocumentFragment();this.__allowLogout&&(this.__removeDropDownbutton(this.__logoutButton,this.__onLogout),this.__logoutButton=this.__createDropDownButton(this.__onLogout,"DropDown_Logout"),fragment.append(this.__logoutButton)),this.__allowSwitchUser&&(this.__removeDropDownbutton(this.__switchUserButton,this.__onSwitchUser),this.__switchUserButton=this.__createDropDownButton(this.__onSwitchUser,"Popup_SwitchUser"),fragment.append(this.__switchUserButton)),this.__showUsermanagementButtons.editUser&&(this.__removeDropDownbutton(this.__editUserButton,this.__onEditUser),this.__editUserButton=this.__createDropDownButton(this.__onEditUser,"DropDown_EditUser"),fragment.append(this.__editUserButton)),this.__showUsermanagementButtons.userManagement&&(this.__removeDropDownbutton(this.__userManagementButton,this.__onUserManagement),this.__userManagementButton=this.__createDropDownButton(this.__onUserManagement,"DropDown_UserManagement"),fragment.append(this.__userManagementButton)),this.__elementDropdown.textContent="",this.__elementDropdown.append(fragment)}__createDropDownButton(clickEventCallback,localizationKey){const passiveEventOptions={passive:!0,capture:!1};let buttonElement=document.createElement("div");return this.__addLocalizedElement(buttonElement,localizationKey),TcHmi.StyleProvider.processFontSize(buttonElement,this.__dropDownFontSize,this.__dropDownFontSizeUnit),buttonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-Dropdown-Element","tchmi-box"),buttonElement.addEventListener("mouseenter",this.__onMouseEnter,passiveEventOptions),buttonElement.addEventListener("mouseleave",this.__onMouseLeave,passiveEventOptions),buttonElement.addEventListener("touchcancel",this.__onMouseLeave,passiveEventOptions),buttonElement.addEventListener("click",clickEventCallback,passiveEventOptions),buttonElement}__removeDropDownbutton(buttonElement,clickEventHandler){if(buttonElement){this.__removeLocalizedElement(buttonElement);const passiveEventOptions={passive:!0,capture:!1};buttonElement.removeEventListener("mouseenter",this.__onMouseEnter,passiveEventOptions),buttonElement.removeEventListener("mouseleave",this.__onMouseLeave,passiveEventOptions),buttonElement.removeEventListener("touchcancel",this.__onMouseLeave,passiveEventOptions),buttonElement.removeEventListener("click",clickEventHandler,passiveEventOptions)}buttonElement=void 0}showSwitchUserPopup(){this.__switchUserPopup||(this.__switchUserPopup=new Beckhoff.TcHmiUserManagementPopups.SwitchUserPopup(this),this.__switchUserPopup.setAdvanced(this.__advanced),this.__switchUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__switchUserPopup.onHide.add(this.__onPopupClosed),this.__switchUserPopup.setTexts({headerText:this.__expandLocalizationSymbol("Popup_SwitchUser"),domainHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Domain"),usernameHeaderText:this.__expandLocalizationSymbol("PopupHeadline_SelectUser"),passwordHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Password"),saveButton:{text:this.__expandLocalizationSymbol("PopupButton_Save"),tooltip:this.__expandLocalizationSymbol("PopupButton_Save")},cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},advancedSwitch:{text:this.__expandLocalizationSymbol("PopupToggleSwitch_Advanced"),tooltip:this.__expandLocalizationSymbol("PopupAdvancedToggleSwitchTooltip_SwitchUser")},usernameInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_EnterYourUserName"),passwordInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_Password"),userComboboxPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_SelectAUser"),feedbackPromptHeadlineFailed:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),feedbackPromptHeadlineSuccess:this.__expandLocalizationSymbol("PopupNotificationHeadline_Success"),feedbackPromptUsername:this.__expandLocalizationSymbol("PopupFeedback_Username"),feedbackPromptPassword:this.__expandLocalizationSymbol("PopupFeedback_Password"),feedbackPromptUserSwitched:this.__expandLocalizationSymbol("PopupNotificationInfo_UserSwitched"),feedbackPromptUserNotSwitched:this.__expandLocalizationSymbol("PopupNotificationInfo_UserNotSwitched"),feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK")})),this.__refreshPopupResources(),this.__switchUserPopup.show()}showEditUserPopup(){this.__editUserPopup||(this.__editUserPopup=new Beckhoff.TcHmiUserManagementPopups.EditUserPopup(this),this.__editUserPopup.setAdvanced(this.__advanced),this.__editUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__editUserPopup.onHide.add(this.__onPopupClosed),this.__editUserPopup.setTexts({headerText:{symbolExpression:this.__expandLocalizationSymbol("PopupHeadline_HelloName"),formatValues:[TcHmi.Server.getCurrentUser()??""]},passwordHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Password"),localizationHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Localization"),userGroupsHeaderText:this.__expandLocalizationSymbol("PopupHeadline_UserGroups"),saveButton:{text:this.__expandLocalizationSymbol("PopupButton_Save"),tooltip:this.__expandLocalizationSymbol("PopupButton_Save")},cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},advancedSwitch:{text:this.__expandLocalizationSymbol("PopupToggleSwitch_Advanced"),tooltip:this.__expandLocalizationSymbol("PopupAdvancedToggleSwitchTooltip_EditUser")},newPasswordInput2Placeholder:this.__expandLocalizationSymbol("PopupPlaceholder_RepeatNewPassword"),newPasswordInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_NewPassword"),oldPasswordInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_OldPassword"),clientLocaleRadioButtonText:this.__expandLocalizationSymbol("PopupRadioChoice_BrowserDefault"),projectLocaleRadioButtonText:this.__expandLocalizationSymbol("PopupRadioChoice_ProjectDefault"),feedbackPromptBothPasswords:this.__expandLocalizationSymbol("PopupFeedback_BothPasswords"),feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK"),feedbackPromptHeadlineFailed:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),feedbackPromptHeadlineSuccess:this.__expandLocalizationSymbol("PopupNotificationHeadline_Success"),feedbackPromptListUserGroupError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),feedbackPromptPasswordMatch:this.__expandLocalizationSymbol("PopupFeedback_PasswordMatch"),feedbackPromptPasswordOld:this.__expandLocalizationSymbol("PopupFeedback_PasswordOld"),feedbackPromptUserInfoNotUpdated:this.__expandLocalizationSymbol("PopupNotificationInfo_UserInfoNotUpdated"),feedbackPromptUserInformationUpdated:this.__expandLocalizationSymbol("PopupNotificationInfo_UserInformationUpdated"),passwordRequirementsCurrentPassword:this.__expandLocalizationSymbol("PopupPasswordRequirements_CurrentPassword"),passwordRequirementsHeadline:this.__expandLocalizationSymbol("PopupPasswordRequirements_Headline"),passwordRequirementsRepitition:this.__expandLocalizationSymbol("PopupPasswordRequirements_Repitition"),popupFeedbackNoGroupsToAdjust:this.__expandLocalizationSymbol("PopupFeedback_NoGroupsToAdjust")})),this.__refreshPopupResources(),this.__editUserPopup.show()}showManageUserPopup(){this.__manageUserPopup||(this.__manageUserPopup=new Beckhoff.TcHmiUserManagementPopups.ManageUserPopup(this),this.__manageUserPopup.setAdvanced(this.__advanced),this.__manageUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__manageUserPopup.onHide.add(this.__onPopupClosed),this.__manageUserPopup.setTexts({headerText:{symbolExpression:this.__expandLocalizationSymbol("PopupHeadline_HelloName"),formatValues:[TcHmi.Server.getCurrentUser()??""]},domainHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Domain"),cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},addUserButton:{text:this.__expandLocalizationSymbol("Popup_AddUser"),tooltip:this.__expandLocalizationSymbol("Popup_AddUser")},deleteUserButton:{text:this.__expandLocalizationSymbol("Popup_DeleteUser"),tooltip:this.__expandLocalizationSymbol("Popup_DeleteUser")},changeUserButton:{text:this.__expandLocalizationSymbol("Popup_ChangeUsers"),tooltip:this.__expandLocalizationSymbol("Popup_ChangeUsers")},feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK"),feedbackPromptNothingToConfigure:this.__expandLocalizationSymbol("PopupFeedback_NothingToConfigure"),addUserLocalizableTexts:{headerText:this.__expandLocalizationSymbol("Popup_AddUser"),usernameHeaderText:this.__expandLocalizationSymbol("PopupHeadline_UserName"),passwordHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Password"),userGroupsHeaderText:this.__expandLocalizationSymbol("PopupHeadline_UserGroups"),localizationHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Localization"),saveButton:{text:this.__expandLocalizationSymbol("PopupButton_Save"),tooltip:this.__expandLocalizationSymbol("PopupButton_Save")},cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},advancedSwitch:{text:this.__expandLocalizationSymbol("PopupToggleSwitch_Advanced"),tooltip:this.__expandLocalizationSymbol("PopupAdvancedToggleSwitchTooltip_AddUser")},usernameInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_EnterUsername"),newPasswordInputPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_NewPassword"),newPasswordInput2Placeholder:this.__expandLocalizationSymbol("PopupPlaceholder_RepeatNewPassword"),forcePasswordChangeCheckboxtext:this.__expandLocalizationSymbol("PopupCheckbox_ForcePasswordChange"),popupFeedbackNoGroupsToAdjust:this.__expandLocalizationSymbol("PopupFeedback_NoGroupsToAdjust"),clientLocaleRadioButtonText:this.__expandLocalizationSymbol("PopupRadioChoice_BrowserDefault"),projectLocaleRadioButtonText:this.__expandLocalizationSymbol("PopupRadioChoice_ProjectDefault"),feedbackPromptHeadlineFailed:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),feedbackPromptHeadlineSuccess:this.__expandLocalizationSymbol("PopupNotificationHeadline_Success"),feedbackPromptBothPasswords:this.__expandLocalizationSymbol("PopupFeedback_BothPasswords"),feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK"),feedbackPromptEnterUsername:this.__expandLocalizationSymbol("PopupFeedback_EnterUsername"),feedbackPromptListUserError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),feedbackPromptListUserGroupError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),feedbackPromptPasswordMatch:this.__expandLocalizationSymbol("PopupFeedback_PasswordMatch"),feedbackPromptUserAdded:this.__expandLocalizationSymbol("PopupNotificationInfo_UserAdded"),feedbackPromptUserAddedError:this.__expandLocalizationSymbol("PopupNotificationInfo_UserAddedError"),feedbackPromptUserGroup:this.__expandLocalizationSymbol("PopupFeedback_Usergroup"),feedbackPromptUsernameExists:this.__expandLocalizationSymbol("PopupFeedback_UsernameExists"),passwordRequirementsHeadline:this.__expandLocalizationSymbol("PopupPasswordRequirements_Headline"),passwordRequirementsRepitition:this.__expandLocalizationSymbol("PopupPasswordRequirements_Repitition")},deleteUserLocalizabletexts:{headerText:this.__expandLocalizationSymbol("Popup_DeleteUser"),userSelectionHeaderText:this.__expandLocalizationSymbol("PopupHeadline_SelectUser"),deleteButton:{text:this.__expandLocalizationSymbol("PopupButton_Delete"),tooltip:this.__expandLocalizationSymbol("PopupButton_Delete")},cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},advancedSwitch:{text:this.__expandLocalizationSymbol("PopupToggleSwitch_Advanced"),tooltip:this.__expandLocalizationSymbol("PopupAdvancedToggleSwitchTooltip_DeleteUser")},userComboboxPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_SelectAUser"),feedbackPromptHeadlineFailed:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),feedbackPromptHeadlineSuccess:this.__expandLocalizationSymbol("PopupNotificationHeadline_Success"),feedbackPromptListUserError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),feedbackPromptUserDeleted:this.__expandLocalizationSymbol("PopupNotificationInfo_UserDeleted"),feedbackPromptUserNotDeleted:this.__expandLocalizationSymbol("PopupNotificationInfo_UserNotDeleted"),deleteConfirmationPromptHeaderText:this.__expandLocalizationSymbol("Popup_DeleteUser"),deleteConfirmationPromptContentText:this.__expandLocalizationSymbol("PopupNotificationInfo_DeleteUserConfirmation"),deleteConfirmationPromptButtonDelete:{text:this.__expandLocalizationSymbol("PopupButton_Delete"),tooltip:this.__expandLocalizationSymbol("PopupButton_Delete")},deleteConfirmationPromptButtonClose:{text:this.__expandLocalizationSymbol("PopupButton_Close"),tooltip:this.__expandLocalizationSymbol("PopupButton_Close")},feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK")},changeUserLocalizableTexts:{headerText:this.__expandLocalizationSymbol("Popup_ChangeUsers"),userSelectionHeaderText:this.__expandLocalizationSymbol("PopupHeadline_SelectUser"),passwordHeaderText:this.__expandLocalizationSymbol("PopupHeadline_Password"),userGroupsHeaderText:this.__expandLocalizationSymbol("PopupHeadline_UserGroups"),saveButton:{text:this.__expandLocalizationSymbol("PopupButton_Save"),tooltip:this.__expandLocalizationSymbol("PopupButton_Save")},cancelButton:{text:this.__expandLocalizationSymbol("PopupButton_Cancel"),tooltip:this.__expandLocalizationSymbol("PopupButton_Cancel")},advancedSwitch:{text:this.__expandLocalizationSymbol("PopupToggleSwitch_Advanced"),tooltip:this.__expandLocalizationSymbol("PopupAdvancedToggleSwitchTooltip_ChangeUser")},userComboboxPlaceholder:this.__expandLocalizationSymbol("PopupPlaceholder_SelectAUser"),popupFeedbackNoGroupsToAdjust:this.__expandLocalizationSymbol("PopupNotificationInfo_NoUserGroups"),forcePasswordChangeCheckboxtext:this.__expandLocalizationSymbol("PopupCheckbox_ForcePasswordChange"),feedbackPromptHeadlineFailed:this.__expandLocalizationSymbol("PopupNotificationHeadline_Failed"),feedbackPromptHeadlineSuccess:this.__expandLocalizationSymbol("PopupNotificationHeadline_Success"),feedbackPromptListUserError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserError"),feedbackPromptListUserGroupError:this.__expandLocalizationSymbol("PopupNotificationInfo_ListUserGroupError"),feedbackPromptUserGroupsNotUpdated:this.__expandLocalizationSymbol("PopupNotificationInfo_UserGroupsNotUpdated"),feedbackPromptUserInformationUpdated:this.__expandLocalizationSymbol("PopupNotificationInfo_UserInformationUpdated"),feedbackPromptButtonOk:this.__expandLocalizationSymbol("PopupButton_OK")}})),this.__refreshPopupResources(),this.__manageUserPopup.show()}__refreshPopupResources(){this.__editUserPopup&&(this.__editUserPopup.setTextFontSize(this.__textFontSize??null),this.__editUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit??null),this.__editUserPopup.setHeadlineFontSize(this.__headlineFontSize??null),this.__editUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit??null),this.__editUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize??null),this.__editUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit??null)),this.__switchUserPopup&&(this.__switchUserPopup.setTextFontSize(this.__textFontSize??null),this.__switchUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit??null),this.__switchUserPopup.setHeadlineFontSize(this.__headlineFontSize??null),this.__switchUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit??null),this.__switchUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize??null),this.__switchUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit??null)),this.__manageUserPopup&&(this.__manageUserPopup.setTextFontSize(this.__textFontSize??null),this.__manageUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit??null),this.__manageUserPopup.setHeadlineFontSize(this.__headlineFontSize??null),this.__manageUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit??null),this.__manageUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize??null),this.__manageUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit??null))}__onExpandDropdown=event=>{this.__setDropDownboxOpen()};__onExpandDropdownMouseDown=event=>{this.__mouseDown=!0,this.__element[0].classList.add("down")};__onExpandDropdownMouseLeave=event=>{this.__dropdownboxOpen||this.__element[0].classList.contains("down")&&this.__element[0].classList.remove("down")};__onExpandDropdownMouseEnter=event=>{this.__mouseDown&&this.__element[0].classList.add("down")};__onMouseUp=event=>{this.__mouseDown=!1,this.__element[0].classList.contains("down")&&this.__element[0].classList.remove("down")};__onLogout=event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),TcHmi.Server.logoutEx2(!0,null)};__onSwitchUser=event=>{this.showSwitchUserPopup()};__onEditUser=event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),this.showEditUserPopup()};__onUserManagement=event=>{TcHmi.TopMostLayer.remove(this,this.__elementDropdown),this.showManageUserPopup()};__onMouseEnter=event=>{this.__hoverComboboxItem(event.target,!0)};__onMouseLeave=event=>{this.__hoverComboboxItem(event.target,!1)};__onTouchstart=event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate"))return;let changedTouches=Array.prototype.slice.apply(event.changedTouches).filter((touch=>touch.target===event.target));0!==changedTouches.length&&(this.__touches=this.__touches.concat(changedTouches.map((touch=>({id:touch.identifier,originalX:touch.clientX,originalY:touch.clientY,element:touch.target})))),changedTouches.forEach((touch=>this.__hoverComboboxItem(touch.target,!0))))};__onUserDataChanged=()=>{const userName=TcHmi.Server.getCurrentUser();if(null!==userName){if(this.__elementBase.textContent===userName)return;this.__elementBase.textContent=userName}else this.__elementBase.textContent="<unknown>";this.__switchUserPopup?.hide(),this.__switchUserPopup?.destroy(),this.__switchUserPopup=null,this.__editUserPopup?.hide(),this.__editUserPopup?.destroy(),this.__editUserPopup=null,this.__manageUserPopup?.hide(),this.__manageUserPopup?.destroy(),this.__manageUserPopup=null,this.__getApiAccessForDomains()};__hoverComboboxItem(element,hover){element.classList.contains("TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-Dropdown-Element")&&(hover?element.classList.add("hover"):this.__touches.some((touch=>touch.element===element))||element.classList.remove("hover"))}__getNotificationElement(){return null}__getWarningElement(){return null}__getAddUserElement(){return null}__getDeleteUserElement(){return null}__getGroupmanagementElement(){return null}__advancedChangedByPopup=advanced=>{this.setAdvancedState(advanced)};getAdvancedState(){return this.__advanced}__onPopupClosed=()=>{this.updateDropdown()};setAdvancedState(valueNew){valueNew!==this.__advanced&&(this.__advanced=valueNew,this.__editUserPopup?.setAdvanced(this.__advanced),this.__switchUserPopup?.setAdvanced(this.__advanced),this.__manageUserPopup?.setAdvanced(this.__advanced))}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}getLocalization(){return this.__localization}__expandLocalizationSymbol(key){return`%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::${key}%/l%`}setTextFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSize")),convertedValue!==this.__textFontSize&&(this.__textFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSize"}),this.__processTextFontSize())}getTextFontSize(){return this.__textFontSize}__processTextFontSize(){this.__refreshPopupResources()}setTextFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextFontSizeUnit")),convertedValue!==this.__textFontSizeUnit&&(this.__textFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextFontSizeUnit"}),this.__processTextFontSizeUnit())}getTextFontSizeUnit(){return this.__textFontSizeUnit}__processTextFontSizeUnit(){this.__processTextFontSize()}setHeadlineFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeadlineFontSize")),convertedValue!==this.__headlineFontSize&&(this.__headlineFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineFontSize"}),this.__processHeadlineFontSize())}getHeadlineFontSize(){return this.__headlineFontSize}__processHeadlineFontSize(){this.__refreshPopupResources()}setHeadlineFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeadlineFontSizeUnit")),convertedValue!==this.__headlineFontSizeUnit&&(this.__headlineFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineFontSizeUnit"}),this.__processHeadlineFontSizeUnit())}getHeadlineFontSizeUnit(){return this.__headlineFontSizeUnit}__processHeadlineFontSizeUnit(){this.__processHeadlineFontSize()}setSubHeadlineFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("SubHeadlineFontSize")),convertedValue!==this.__subHeadlineFontSize&&(this.__subHeadlineFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SubHeadlineFontSize"}),this.__procesSubHeadlineFontSize())}getSubHeadlineFontSize(){return this.__subHeadlineFontSize}__procesSubHeadlineFontSize(){this.__refreshPopupResources()}setSubHeadlineFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("SubHeadlineFontSizeUnit")),convertedValue!==this.__subHeadlineFontSizeUnit&&(this.__subHeadlineFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SubHeadlineFontSizeUnit"}),this.__processSubHeadlineFontSizeUnit())}getSubHeadlineFontSizeUnit(){return this.__subHeadlineFontSizeUnit}__processSubHeadlineFontSizeUnit(){this.__procesSubHeadlineFontSize()}setDropDownFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DropDownFontSize")),convertedValue!==this.__dropDownFontSize&&(this.__dropDownFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DropDownFontSize"}),this.__processDropDownFontSize())}getDropDownFontSize(){return this.__dropDownFontSize}__processDropDownFontSize(){this.__logoutButton&&TcHmi.StyleProvider.processFontSize(this.__logoutButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__switchUserButton&&TcHmi.StyleProvider.processFontSize(this.__switchUserButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__editUserButton&&TcHmi.StyleProvider.processFontSize(this.__editUserButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit),this.__userManagementButton&&TcHmi.StyleProvider.processFontSize(this.__userManagementButton,this.__dropDownFontSize,this.__dropDownFontSizeUnit)}setDropDownFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("DropDownFontSizeUnit")),convertedValue!==this.__dropDownFontSizeUnit&&(this.__dropDownFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"DropDownFontSizeUnit"}),this.__processDropDownFontSizeUnit())}getDropDownFontSizeUnit(){return this.__dropDownFontSizeUnit}__processDropDownFontSizeUnit(){this.__processDropDownFontSize()}setUserNameFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("UserNameFontSize")),convertedValue!==this.__userNameFontSize&&(this.__userNameFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UserNameFontSize"}),this.__processUserNameFontSize())}getUserNameFontSize(){return this.__userNameFontSize}__processUserNameFontSize(){TcHmi.StyleProvider.processFontSize(this.__elementBase,this.__userNameFontSize,this.__userNameFontSizeUnit)}setUserNameFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("UserNameFontSizeUnit")),convertedValue!==this.__userNameFontSizeUnit&&(this.__userNameFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UserNameFontSizeUnit"}),this.__processUserNameFontSizeUnit())}getUserNameFontSizeUnit(){return this.__userNameFontSizeUnit}__processUserNameFontSizeUnit(){this.__processUserNameFontSize()}setTextColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TextColor"));let resolverInfo=this.__objectResolvers.get("textColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,this);this.__objectResolvers.set("textColor",{resolver:resolver,watchCallback:this.__onResolverForTextColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForTextColorWatchCallback)})}__onResolverForTextColorWatchCallback=data=>{!this.__isAttached&&data.destroy&&this.__suspendObjectResolver("textColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__textColor)||(this.__textColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TextColor"}),this.__processTextColor()):TcHmi.Log.errorEx("[Source=Control, Module="+this.__type+(TcHmiUserManagement.#tchmiFQN!==this.__type?", Origin="+TcHmiUserManagement.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=TextColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))};getTextColor(){return this.__textColor}__processTextColor(){TcHmi.StyleProvider.processTextColor(this.__elementBase,this.__textColor)}setAllowLogout(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowLogout")),convertedValue!==this.__allowLogout&&(this.__allowLogout=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowLogout"}),this.__processAllowLogout())}getAllowLogout(){return this.__allowLogout}__processAllowLogout(){this.__getApiAccessForDomains()}setAllowSwitchUser(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowSwitchUser")),convertedValue!==this.__allowSwitchUser&&(this.__allowSwitchUser=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowSwitchUser"}),this.__processAllowSwitchUser())}getAllowSwitchUser(){return this.__allowSwitchUser}__processAllowSwitchUser(){this.__getApiAccessForDomains()}}Beckhoff.TcHmiUserManagement=TcHmiUserManagement}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiUserManagement","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiUserManagement),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class UserManagementPopup extends Controls.Helpers.Popup{constructor(parentControl){super(parentControl)}__localizedTexts=null;__textFontSize=null;__textFontSizeUnit="px";__headlineFontSize=null;__headlineFontSizeUnit="px";__subHeadlineFontSize=null;__subHeadlineFontSizeUnit="px";__selectedDomain;__feedbackPrompt=null;setDomain(domain){this.__selectedDomain=domain}__updateFontSizes(){TcHmi.StyleProvider.processFontSize(this.__element,this.__textFontSize,this.__textFontSizeUnit),TcHmi.StyleProvider.processFontSize(this.__elementHeader,this.__headlineFontSize,this.__headlineFontSizeUnit);let subHeadlines=this.__element.getElementsByTagName("h2");TcHmi.StyleProvider.processFontSize(subHeadlines,this.__subHeadlineFontSize,this.__subHeadlineFontSizeUnit)}refreshParentControlResources(){}setTextFontSize(valueNew){valueNew!==this.__textFontSize&&(this.__textFontSize=valueNew,this.__updateFontSizes())}setTextFontSizeUnit(valueNew){valueNew!==this.__textFontSizeUnit&&(null===valueNew&&(valueNew="px"),this.__textFontSizeUnit=valueNew,this.__updateFontSizes())}setHeadlineFontSize(valueNew){valueNew!==this.__headlineFontSize&&(this.__headlineFontSize=valueNew,this.__updateFontSizes())}setHeadlineFontSizeUnit(valueNew){valueNew!==this.__headlineFontSizeUnit&&(null===valueNew&&(valueNew="px"),this.__headlineFontSizeUnit=valueNew,this.__updateFontSizes())}setSubHeadlineFontSize(valueNew){valueNew!==this.__subHeadlineFontSize&&(this.__subHeadlineFontSize=valueNew,this.__updateFontSizes())}setSubHeadlineFontSizeUnit(valueNew){valueNew!==this.__subHeadlineFontSizeUnit&&(null===valueNew&&(valueNew="px"),this.__subHeadlineFontSizeUnit=valueNew,this.__updateFontSizes())}__createFeedbackPrompt(){let feedbackPrompt=new Controls.Helpers.TextAndButtonsPrompt({ok:{value:void 0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__localizedTexts?.feedbackPromptButtonOk}}},this.__parentControl);return feedbackPrompt.setBackgroundAction({close:!0,action:"ok"}),feedbackPrompt}setTexts(texts){this.__localizedTexts=texts,this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}}TcHmiUserManagementPopups.UserManagementPopup=UserManagementPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class EditUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementPassword=document.createElement("div"),this.__elementPassword.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementPasswordHeader=document.createElement("h2"),this.__elementPassword.append(this.__elementPasswordHeader),this.__elementLocale=document.createElement("div"),this.__elementLocale.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content-radiobuttons","TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementLocaleHeader=document.createElement("h2"),this.__elementLocale.append(this.__elementLocaleHeader),this.__elementGroups=document.createElement("div"),this.__elementGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementGroupList=document.createElement("div"),this.__elementGroupList.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-groups"),this.__destroyers.push(TcHmi.EventProvider.registerDomEvent(this.__elementGroupList,"scroll",this.__onGroupScroll)),this.__elementGroupListInfo=document.createElement("div"),this.__elementGroupsHeader=document.createElement("h2"),this.__elementGroups.append(this.__elementGroupsHeader,this.__elementGroupList),this.__elementContent.append(this.__elementPassword,this.__elementGroups,this.__elementLocale);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.saveButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),oldPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.oldPasswordInput`,null,this.__parentControl),newPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput`,null,this.__parentControl),newPasswordInput2=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput2`,null,this.__parentControl),localeCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.localeCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),clientLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.clientLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`,"data-tchmi-radio-state":"Active"},this.__parentControl),projectLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.projectLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`},this.__parentControl),selectionLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.selectionLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_EditUserPopup`},this.__parentControl);if(!(saveButton&&cancelButton&&advancedSwitch&&oldPasswordInput&&newPasswordInput&&newPasswordInput2&&clientLocaleRadioButton&&projectLocaleRadioButton&&selectionLocaleRadioButton&&localeCombobox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced)),this.__saveButton=saveButton;const saveButtonElement=this.__saveButton.getElement()[0];saveButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(saveButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__saveButton.getId()+".onPressed",this.__onSaveUp)),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancelUp)),this.__oldPasswordInput=oldPasswordInput;const oldPasswordInputElement=this.__oldPasswordInput.getElement()[0];oldPasswordInputElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content-margin"),this.__elementPassword.append(oldPasswordInputElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__oldPasswordInput.getId()+".onTextChanged",(()=>{this.__updatePasswordRequirements()}))),this.__newPasswordInput=newPasswordInput,this.__elementPassword.append(this.__newPasswordInput.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__newPasswordInput.getId()+".onTextChanged",(()=>{this.__updatePasswordRequirements()}))),this.__newPasswordInput_2=newPasswordInput2,this.__elementPassword.append(this.__newPasswordInput_2.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__newPasswordInput_2.getId()+".onTextChanged",(()=>{this.__updatePasswordRequirements()}))),this.__projectLocaleRadioButton=projectLocaleRadioButton,this.__elementLocale.append(this.__projectLocaleRadioButton.getElement()[0]),this.__clientLocaleRadioButton=clientLocaleRadioButton,this.__elementLocale.append(this.__clientLocaleRadioButton.getElement()[0]);let localeItem_Selection=document.createElement("div");localeItem_Selection.classList.add("combobox-selection"),this.__selectionLocaleRadioButton=selectionLocaleRadioButton,localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__selectionLocaleRadioButton.getId()+".onRadioStateChanged",this.__onRadioStateLocaleChanged)),localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),this.__localeCombobox=localeCombobox,localeItem_Selection.append(this.__localeCombobox.getElement()[0]),this.__elementLocale.append(localeItem_Selection),this.__createLocalizationSelection()}__elementPassword;__elementPasswordHeader;__elementGroups;__elementGroupsHeader;__elementGroupList;__elementGroupListInfo;__elementLocale;__elementLocaleHeader;__elementPasswordRequirements;__saveButton;__cancelButton;__advancedSwitch;__oldPasswordInput;__newPasswordInput;__newPasswordInput_2;__localeCombobox;__clientLocaleRadioButton;__projectLocaleRadioButton;__selectionLocaleRadioButton;__groupList=[];__groupCheckboxes=new Map;__groupConfigurations=[];__groupCheckboxEventDestroyer=[];__apiAccessResult;__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__groupConfigurations=TcHmi.Server.getCurrentUserConfig().userIsInGroups,this.__showControlsBasedOnApiAccess(),this.__setLocaleRadioButtonsByUserConfig(),this.__setGroupCheckboxesByUserConfig(),this.__updatePasswordRequirements(),setTimeout((()=>{this.__setGroupScrollData()}),50)}destroy(){this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],super.destroy()}__showControlsBasedOnApiAccess(){let domain=TcHmi.Server.getCurrentUserConfig().domain;TcHmi.Server.UserManagement.getApiAccess({domain:domain??void 0},(data=>{this.__apiAccessResult=data,data.error===TcHmi.Errors.NONE&&data.result&&(data.result.updateUser.changeOwnPassword?(data.result.updateUser.changePassword?this.__oldPasswordInput.setVisibility("Collapsed"):this.__oldPasswordInput.setVisibility("Visible"),this.__elementPassword.classList.remove("not-displayed")):this.__elementPassword.classList.add("not-displayed"),data.result.updateUser.addGroups&&data.result.updateUser.removeGroups&&data.result.listUserGroups.general?(this.__elementGroups.classList.remove("not-displayed"),this.__createUserGroupSelection()):this.__elementGroups.classList.add("not-displayed"),data.result.updateUser.locale?this.__elementLocale.classList.remove("not-displayed"):this.__elementLocale.classList.add("not-displayed"),data.result.listUserGroups.general?this.__advancedSwitch?.setVisibility("Visible"):this.__advancedSwitch?.setVisibility("Collapsed")),this.__createPasswordRequirementsElement()}))}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updatePasswordRequirements(){const oldPassword=this.__oldPasswordInput.getText(),newPassword=this.__newPasswordInput.getText(),newPassword2=this.__newPasswordInput_2.getText();if(!this.__elementPasswordRequirements)return void this.__saveButton.setIsEnabled(!0);let customRuleValues=new Map;customRuleValues.set("RepeatPassword",newPassword===newPassword2&&(newPassword??"").length>0),"Visible"===this.__oldPasswordInput.getVisibility()&&customRuleValues.set("EnterCurrentPassword",(oldPassword??"").length>0),this.__elementPasswordRequirements.validate(newPassword??"",customRuleValues)||!newPassword&&!newPassword2&&!oldPassword?this.__saveButton.setIsEnabled(!0):this.__saveButton.setIsEnabled(!1)}__createPasswordRequirementsElement(){if(this.__elementPasswordRequirements?.remove(),!this.__parentControl)return;let customRules=new Map;"Visible"===this.__oldPasswordInput.getVisibility()&&customRules.set("EnterCurrentPassword",this.__localizedTexts?.passwordRequirementsCurrentPassword??""),customRules.set("RepeatPassword",this.__localizedTexts?.passwordRequirementsRepitition??""),this.__elementPasswordRequirements=new TcHmiUserManagementPopups.PasswordRequirements(this.__parentControl,customRules,(()=>{this.__updatePasswordRequirements()})),this.__elementPasswordRequirements.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline}),this.__elementPassword.append(this.__elementPasswordRequirements)}__createUserGroupSelection(){this.__isShowing&&TcHmi.Server.UserManagement.listUserGroups((data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);this.__advanced||(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),tchmi_equal(this.__groupList,newGroupList)&&0!==newGroupList.length||(this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__elementGroupList.textContent="",this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementGroupListInfo.remove(),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)})),this.__setGroupCheckboxesByUserConfig()):this.__elementGroupList.append(this.__elementGroupListInfo))}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserGroupError?this.__localizedTexts?.feedbackPromptListUserGroupError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserGroupError??"",formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide(),this.__elementGroups.classList.add("not-displayed")}})()}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__name+".UserGroupCheckbox_EditUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__name+".UserGroupCheckbox_EditUser_Popup"+name,{"data-tchmi-text":name,"data-tchmi-toggle-state":"Normal"},this.__parentControl);checkbox&&(this.__groupCheckboxes.set(name,checkbox),this.__elementGroupList.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{"Normal"===checkbox.getToggleState()?this.__groupConfigurations=this.__groupConfigurations.filter((group=>group!==groupName)):this.__groupConfigurations.includes(groupName)||this.__groupConfigurations.push(groupName)}}__setGroupCheckboxesByUserConfig(){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();this.__groupCheckboxes.forEach(((checkbox,group)=>{"__SystemGuest"===currentUserConfigurations.name&&"__SystemGuests"===group||"__SystemUser"===currentUserConfigurations.name&&"__SystemUsers"===group||"__SystemAdministrator"===currentUserConfigurations.name&&"__SystemAdministrators"===group?checkbox.setIsEnabled(!1):checkbox.setIsEnabled(!0),this.__groupConfigurations.includes(group)?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")})),this.__setGroupScrollData()}__createLocalizationSelection(){this.__localeCombobox.setIsEnabled(!1);let locales=TcHmi.Locale.getRegisteredLocales(),currentLocale=TcHmi.Locale.get();locales.sort(),this.__localeCombobox.setSrcData(locales);for(let i=0;i<locales.length;i++){let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();currentUserConfigurations&&currentUserConfigurations.locale?locales[i].includes(currentUserConfigurations.locale)&&this.__localeCombobox.setSelectedIndex(i):locales[i]===currentLocale&&this.__localeCombobox.setSelectedIndex(i)}this.__setLocaleRadioButtonsByUserConfig()}__setLocaleRadioButtonsByUserConfig(){let currentUserConfig=TcHmi.Server.getCurrentUserConfig();if(currentUserConfig.configLocale&&"client"!==currentUserConfig.configLocale){if("project"===currentUserConfig.configLocale)this.__projectLocaleRadioButton&&this.__projectLocaleRadioButton.setRadioState("Active");else if(this.__localeCombobox&&this.__selectionLocaleRadioButton){let registeredLocales=TcHmi.Locale.getRegisteredLocales();if(registeredLocales)for(let i=0,ii=registeredLocales.length;i<ii;i++)registeredLocales[i]===currentUserConfig.configLocale&&(this.__selectionLocaleRadioButton.setRadioState("Active"),this.__localeCombobox.setSelectedIndex(i))}}else this.__clientLocaleRadioButton&&this.__clientLocaleRadioButton.setRadioState("Active")}__checkLocaleRadioButtons(){let locale;return locale=this.__clientLocaleRadioButton&&"Active"===this.__clientLocaleRadioButton.getRadioState()?"client":this.__projectLocaleRadioButton&&"Active"===this.__projectLocaleRadioButton.getRadioState()?"project":this.__selectionLocaleRadioButton&&"Active"===this.__selectionLocaleRadioButton.getRadioState()&&this.__localeCombobox?this.__localeCombobox.getSelectedValue():void 0,locale}__onGroupScroll=e=>{this.__setGroupScrollData()};__setGroupScrollData(){this.__elementGroupList.clientHeight+this.__elementGroupList.scrollTop===this.__elementGroupList.scrollHeight?this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"none":"bottom":this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"top":"center"}__onRadioStateLocaleChanged=()=>{"Active"===this.__selectionLocaleRadioButton.getRadioState()?this.__localeCombobox.setIsEnabled(!0):this.__localeCombobox.setIsEnabled(!1)};__onSaveUp=()=>{let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(this.__oldPasswordInput&&this.__newPasswordInput&&this.__newPasswordInput_2){let passwordOld=this.__oldPasswordInput.getText(),passwordNew=this.__newPasswordInput.getText(),passwordNew2=this.__newPasswordInput_2.getText();if(passwordOld||passwordNew||passwordNew2){if(!passwordOld&&(passwordNew||passwordNew2)&&!this.__apiAccessResult?.result?.updateUser.changePassword)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPasswordOld}),void this.__feedbackPrompt.prompt();if(passwordOld||this.__apiAccessResult?.result?.updateUser.changePassword){if(!passwordNew||!passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptBothPasswords}),void this.__feedbackPrompt.prompt();if(passwordNew!==passwordNew2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPasswordMatch}),void this.__feedbackPrompt.prompt()}}else passwordOld=void 0,passwordNew=void 0,passwordNew2=void 0;let timeZone,groupsToAdd=[],groupsToRemove=[],locale=this.__checkLocaleRadioButtons();this.__groupCheckboxes&&this.__groupList&&currentUserConfigurations&&this.__apiAccessResult?.result?.updateUser.addGroups&&this.__apiAccessResult?.result?.updateUser.removeGroups&&(groupsToRemove=currentUserConfigurations.userIsInGroups.filter((group=>"Normal"===this.__groupCheckboxes.get(group)?.getToggleState())),groupsToAdd=this.__groupList.filter((group=>"Active"===this.__groupCheckboxes.get(group)?.getToggleState()&&!currentUserConfigurations.userIsInGroups.includes(group)))),currentUserConfigurations&&currentUserConfigurations.name&&this.__updateUser(currentUserConfigurations.name,passwordOld,passwordNew,groupsToAdd,groupsToRemove,locale,timeZone)}};__updateUser(username,oldPassword,newPassword,groupsToAdd,groupsToRemove,locale,timeZone){let updateData={};oldPassword&&(updateData.currentPassword=oldPassword),newPassword&&(updateData.password=newPassword),groupsToAdd&&groupsToAdd.length>0&&(updateData.addGroups=groupsToAdd),groupsToRemove&&groupsToRemove.length>0&&(updateData.removeGroups=groupsToRemove),locale&&(updateData.locale=locale),timeZone&&(updateData.timeZone=timeZone),updateData.domain=TcHmi.Server.getCurrentUserConfig().domain??TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,username&&updateData&&TcHmi.Server.UserManagement.updateUser(username,updateData,(data=>{if(data.error===TcHmi.Errors.NONE)this.__showControlsBasedOnApiAccess(),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserInformationUpdated?this.__localizedTexts?.feedbackPromptUserInformationUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserInformationUpdated??"",formatValues:[TcHmi.Server.getCurrentUser()??"the current user"]}}),this.__feedbackPrompt.prompt();else{let error=data.error,message="",reason="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")"),data.details.errors[0].reason&&(reason=data.details.errors[0].reason)),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserInfoNotUpdated?this.__localizedTexts?.feedbackPromptUserInfoNotUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserInfoNotUpdated??"",formatValues:[error,message,reason,username]}}),this.__feedbackPrompt.prompt()}}))}__onAdvanced=()=>{this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__createUserGroupSelection()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}__resetControls(){this.__oldPasswordInput.setText(""),this.__newPasswordInput.setText(""),this.__newPasswordInput_2.setText(""),this.__clientLocaleRadioButton.setRadioState("Active")}__onCancelUp=()=>{this.__resetControls(),this.hide()};__updateFontSizes(){super.__updateFontSizes(),this.__localeCombobox.setDropDownFontSize(this.__textFontSize),this.__localeCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("passwordHeaderText",texts.passwordHeaderText,this.__elementPasswordHeader),this.__applyTextToElement("localizationHeaderText",texts.localizationHeaderText,this.__elementLocaleHeader),this.__applyTextToElement("userGroupsHeaderText",texts.userGroupsHeaderText,this.__elementGroupsHeader),this.__applyTextToElement("popupFeedbackNoGroupsToAdjust",texts.popupFeedbackNoGroupsToAdjust,this.__elementGroupListInfo),this.__applyTextToControl("saveButtonText",texts.saveButton?.text,this.__saveButton,"Text"),this.__applyTextToControl("saveButtonTooltip",texts.saveButton?.tooltip,this.__saveButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("oldPasswordInputPlaceholder",texts.oldPasswordInputPlaceholder,this.__oldPasswordInput,"Placeholder"),this.__applyTextToControl("newPasswordInputPlaceholder",texts.newPasswordInputPlaceholder,this.__newPasswordInput,"Placeholder"),this.__applyTextToControl("newPasswordInput2Placeholder",texts.newPasswordInput2Placeholder,this.__newPasswordInput_2,"Placeholder"),this.__applyTextToControl("clientLocaleRadioButtonText",texts.clientLocaleRadioButtonText,this.__clientLocaleRadioButton,"Text"),this.__applyTextToControl("projectLocaleRadioButtonText",texts.projectLocaleRadioButtonText,this.__projectLocaleRadioButton,"Text"),this.__elementPasswordRequirements?.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline})}}TcHmiUserManagementPopups.EditUserPopup=EditUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class ManageUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementDomains=document.createElement("div"),this.__elementDomains.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementButtons=document.createElement("div"),this.__elementButtons.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementDomainsHeader=document.createElement("h2"),this.__elementDomains.append(this.__elementDomainsHeader),this.__elementFeedback=document.createElement("div"),this.__elementContent.append(this.__elementDomains,this.__elementButtons);const cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),addUserButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.addUserButton`,null,this.__parentControl),deleteUserButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.deleteUserButton`,null,this.__parentControl),changeUserButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.manageUserButton`,null,this.__parentControl),domainCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.domainCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl);if(!(cancelButton&&addUserButton&&deleteUserButton&&changeUserButton&&domainCombobox))throw new Error("Could not create controls for ManageuserPopup.");this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onClose)),this.__addUserButton=addUserButton,this.__destroyers.push(TcHmi.EventProvider.register(this.__addUserButton.getId()+".onPressed",this.__onAddUser)),this.__deleteUserButton=deleteUserButton,this.__destroyers.push(TcHmi.EventProvider.register(this.__deleteUserButton.getId()+".onPressed",this.__onDeleteUser)),this.__changeUserButton=changeUserButton,this.__destroyers.push(TcHmi.EventProvider.register(this.__changeUserButton.getId()+".onPressed",this.__onChangeUser)),this.__elementButtons.append(this.__addUserButton.getElement()[0],this.__deleteUserButton.getElement()[0],this.__changeUserButton.getElement()[0],this.__elementFeedback),this.__domainCombobox=domainCombobox,this.__elementDomains.append(this.__domainCombobox.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__domainCombobox.getId()+".onSelectionChanged",this.__onDomainSelectionChanged))}__elementDomains;__elementDomainsHeader;__elementFeedback;__cancelButton;__addUserButton;__deleteUserButton;__changeUserButton;__domainCombobox;__addUserPopup;__deleteUserPopup;__changeUserPopup;__groupList;__elementButtons;__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.updateDomains()}destroy(){super.destroy(),this.__addUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__addUserPopup?.onHide.remove(this.__onSubPopupClosed),this.__addUserPopup?.destroy(),this.__addUserPopup=void 0,this.__deleteUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__deleteUserPopup?.onHide.remove(this.__onSubPopupClosed),this.__deleteUserPopup?.destroy(),this.__deleteUserPopup=void 0,this.__changeUserPopup?.onAdvancedChanged.remove(this.__advancedChangedByPopup),this.__changeUserPopup?.onHide.remove(this.__onSubPopupClosed),this.__changeUserPopup?.destroy(),this.__changeUserPopup=void 0}updateDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);if(domains.length<1)this.__elementDomains.classList.add("not-displayed"),this.__selectedDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,this.__showButtonsBasedOnApiAccess();else if(1===domains.length)this.__selectedDomain=domains[0],this.__elementDomains.classList.add("not-displayed"),this.__showButtonsBasedOnApiAccess();else{this.__elementDomains.classList.remove("not-displayed");let currentDomain=this.__selectedDomain??TcHmi.Server.getCurrentUserConfig().domain;if(this.__domainCombobox){this.__domainCombobox.setSrcData(domains);let index=domains.findIndex((x=>x===currentDomain));-1===index&&(index=0),this.__domainCombobox.setSelectedIndex(index)}}this.__showButtonsBasedOnApiAccess()}}))}__showButtonsBasedOnApiAccess(){this.__selectedDomain&&TcHmi.Server.UserManagement.getApiAccess({domain:this.__selectedDomain},(data=>{if(data.error===TcHmi.Errors.NONE&&data.result){let showFeedback=!0;data.result.addUser.general&&data.result.listUserGroups.general&&data.result.listUsers.general?(this.__addUserButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__addUserButton?.getElement()[0].classList.add("not-displayed"),data.result.listUsers.general&&data.result.listUsers.groups&&data.result.listUserGroups.general&&data.result.updateUser.removeGroups&&data.result.updateUser.addGroups?(this.__changeUserButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__changeUserButton?.getElement()[0].classList.add("not-displayed"),data.result.listUsers.general&&data.result.removeUser.general?(this.__deleteUserButton?.getElement()[0].classList.remove("not-displayed"),showFeedback=!1):this.__deleteUserButton?.getElement()[0].classList.add("not-displayed"),this.__elementFeedback.classList.toggle("not-displayed",!showFeedback)}else this.__elementFeedback.classList.remove("not-displayed"),this.__addUserButton?.getElement()[0].classList.add("not-displayed"),this.__changeUserButton?.getElement()[0].classList.add("not-displayed"),this.__deleteUserButton?.getElement()[0].classList.add("not-displayed")}))}__performPromptAction(toPerform){this.__onHideManager.trigger()}__onClose=()=>{this.hide()};__onAddUser=()=>{this.__addUserPopup||(this.__addUserPopup=new TcHmiUserManagementPopups.AddUserPopup(this.__parentControl),this.__addUserPopup.setAdvanced(this.__advanced),this.__addUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__addUserPopup.onHide.add(this.__onSubPopupClosed),this.__localizedTexts?.addUserLocalizableTexts&&this.__addUserPopup.setTexts(this.__localizedTexts.addUserLocalizableTexts)),this.__addUserPopup.setDomain(this.__selectedDomain),this.__addUserPopup.show()};__onDeleteUser=()=>{this.__deleteUserPopup||(this.__deleteUserPopup=new TcHmiUserManagementPopups.DeleteUserPopup(this.__parentControl),this.__deleteUserPopup.setAdvanced(this.__advanced),this.__deleteUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__deleteUserPopup.onHide.add(this.__onSubPopupClosed),this.__localizedTexts?.deleteUserLocalizabletexts&&this.__deleteUserPopup?.setTexts(this.__localizedTexts?.deleteUserLocalizabletexts)),this.__deleteUserPopup.setDomain(this.__selectedDomain),this.__deleteUserPopup.show()};__onChangeUser=()=>{this.__changeUserPopup||(this.__changeUserPopup=new TcHmiUserManagementPopups.ChangeUserPopup(this.__parentControl),this.__changeUserPopup.setAdvanced(this.__advanced),this.__changeUserPopup.onAdvancedChanged.add(this.__advancedChangedByPopup),this.__changeUserPopup.onHide.add(this.__onSubPopupClosed),this.__localizedTexts?.changeUserLocalizableTexts&&this.__changeUserPopup?.setTexts(this.__localizedTexts.changeUserLocalizableTexts)),this.__changeUserPopup.setDomain(this.__selectedDomain),this.__changeUserPopup.show()};__onDomainSelectionChanged=()=>{this.__selectedDomain=this.__domainCombobox?.getSelectedValue()??TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,this.__showButtonsBasedOnApiAccess()};__advancedChangedByPopup=advanced=>{advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedChangeCallbacks.trigger(this.__advanced),this.__addUserPopup?.setAdvanced(this.__advanced),this.__changeUserPopup?.setAdvanced(this.__advanced),this.__deleteUserPopup?.setAdvanced(this.__advanced))};__onSubPopupClosed=()=>{this.updateDomains()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__addUserPopup?.setAdvanced(this.__advanced),this.__changeUserPopup?.setAdvanced(this.__advanced),this.__deleteUserPopup?.setAdvanced(this.__advanced))}__updateFontSizes(){super.__updateFontSizes(),this.__addUserPopup&&(this.__addUserPopup.setTextFontSize(this.__textFontSize),this.__addUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit),this.__addUserPopup.setHeadlineFontSize(this.__headlineFontSize),this.__addUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit),this.__addUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize),this.__addUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit)),this.__deleteUserPopup&&(this.__deleteUserPopup.setTextFontSize(this.__textFontSize),this.__deleteUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit),this.__deleteUserPopup.setHeadlineFontSize(this.__headlineFontSize),this.__deleteUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit),this.__deleteUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize),this.__deleteUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit)),this.__changeUserPopup&&(this.__changeUserPopup.setTextFontSize(this.__textFontSize),this.__changeUserPopup.setTextFontSizeUnit(this.__textFontSizeUnit),this.__changeUserPopup.setHeadlineFontSize(this.__headlineFontSize),this.__changeUserPopup.setHeadlineFontSizeUnit(this.__headlineFontSizeUnit),this.__changeUserPopup.setSubHeadlineFontSize(this.__subHeadlineFontSize),this.__changeUserPopup.setSubHeadlineFontSizeUnit(this.__subHeadlineFontSizeUnit)),this.__domainCombobox.setDropDownFontSize(this.__textFontSize),this.__domainCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("domainHeaderText",texts.domainHeaderText,this.__elementDomainsHeader),this.__applyTextToElement("feedbackPromptNothingToConfigure",texts.feedbackPromptNothingToConfigure,this.__elementFeedback),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("addUserButtonText",texts.addUserButton?.text,this.__addUserButton,"Text"),this.__applyTextToControl("addUserButtonTooltip",texts.addUserButton?.tooltip,this.__addUserButton,"Tooltip"),this.__applyTextToControl("deleteUserButtonText",texts.deleteUserButton?.text,this.__deleteUserButton,"Text"),this.__applyTextToControl("deleteUserButtonTooltip",texts.deleteUserButton?.tooltip,this.__deleteUserButton,"Tooltip"),this.__applyTextToControl("changeUserButtonText",texts.changeUserButton?.text,this.__changeUserButton,"Text"),this.__applyTextToControl("changeUserButtonTooltip",texts.changeUserButton?.tooltip,this.__changeUserButton,"Tooltip"),texts.addUserLocalizableTexts&&this.__addUserPopup?.setTexts(texts.addUserLocalizableTexts),texts.deleteUserLocalizabletexts&&this.__deleteUserPopup?.setTexts(texts.deleteUserLocalizabletexts),texts.changeUserLocalizableTexts&&this.__changeUserPopup?.setTexts(texts.changeUserLocalizableTexts)}}TcHmiUserManagementPopups.ManageUserPopup=ManageUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class AddUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementUsername=document.createElement("div"),this.__elementUsername.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementUsernameHeader=document.createElement("h2"),this.__elementUsername.append(this.__elementUsernameHeader),this.__elementPassword=document.createElement("div"),this.__elementPassword.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementPasswordHeader=document.createElement("h2"),this.__elementPassword.append(this.__elementPasswordHeader),this.__elementLocale=document.createElement("div"),this.__elementLocale.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content-radiobuttons","TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementLocaleHeader=document.createElement("h2"),this.__elementLocale.append(this.__elementLocaleHeader),this.__elementGroups=document.createElement("div"),this.__elementGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementGroupsHeader=document.createElement("h2"),this.__elementGroupList=document.createElement("div"),this.__elementGroupList.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-groups"),this.__destroyers.push(TcHmi.EventProvider.registerDomEvent(this.__elementGroupList,"scroll",this.__onGroupScroll)),this.__elementGroups.append(this.__elementGroupsHeader,this.__elementGroupList),this.__elementGroupListInfo=document.createElement("div"),this.__elementContent.append(this.__elementUsername,this.__elementPassword,this.__elementGroups,this.__elementLocale);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.saveButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),usernameInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",`${this.__name}.usernameInput`,null,this.__parentControl),newPasswordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput`,{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_NewPassword%/l%"},this.__parentControl),newPasswordInput2=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.newPasswordInput2`,null,this.__parentControl),forcePasswordChangeCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",`${this.__name}.forcePasswordChangeCheckbox`,null,this.__parentControl),localeCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.localeCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),clientLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.clientLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_AddUserPopup`,"data-tchmi-radio-state":"Active"},this.__parentControl),projectLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.projectLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_AddUserPopup`},this.__parentControl),selectionLocaleRadioButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.selectionLocaleRadioButton`,{"data-tchmi-radio-group":`${this.__name}.ToggleGroup_Locale_AddUserPopup`},this.__parentControl);if(!(saveButton&&cancelButton&&advancedSwitch&&usernameInput&&newPasswordInput&&newPasswordInput2&&forcePasswordChangeCheckbox&&clientLocaleRadioButton&&projectLocaleRadioButton&&selectionLocaleRadioButton&&localeCombobox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced)),this.__saveButton=saveButton;const saveButtonElement=this.__saveButton.getElement()[0];saveButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(saveButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__saveButton.getId()+".onPressed",this.__onSaveUp)),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancelUp)),this.__usernameInput=usernameInput,this.__elementUsername.append(this.__usernameInput.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__usernameInput.getId()+".onTextChanged",(()=>{this.__updateSaveButton()}))),this.__newPasswordInput=newPasswordInput,this.__elementPassword.append(this.__newPasswordInput.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__newPasswordInput.getId()+".onTextChanged",(()=>{this.__updateSaveButton()}))),this.__newPasswordInput_2=newPasswordInput2,this.__elementPassword.append(this.__newPasswordInput_2.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__newPasswordInput_2.getId()+".onTextChanged",(()=>{this.__updateSaveButton()}))),this.__forcePasswordChangeCheckbox=forcePasswordChangeCheckbox,this.__elementPassword.append(this.__forcePasswordChangeCheckbox.getElement()[0]),this.__projectLocaleRadioButton=projectLocaleRadioButton,this.__elementLocale.append(this.__projectLocaleRadioButton.getElement()[0]),this.__clientLocaleRadioButton=clientLocaleRadioButton,this.__elementLocale.append(this.__clientLocaleRadioButton.getElement()[0]);let localeItem_Selection=document.createElement("div");localeItem_Selection.classList.add("combobox-selection"),this.__selectionLocaleRadioButton=selectionLocaleRadioButton,localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__selectionLocaleRadioButton.getId()+".onRadioStateChanged",this.__onRadioStateLocaleChanged)),localeItem_Selection.append(this.__selectionLocaleRadioButton.getElement()[0]),this.__localeCombobox=localeCombobox,localeItem_Selection.append(this.__localeCombobox.getElement()[0]),this.__elementLocale.append(localeItem_Selection),this.__createLocalizationSelection();let currentUserConfig=TcHmi.Server.getCurrentUserConfig();this.__groupConfigurations.push(currentUserConfig.defaultUserGroup??"__SystemUsers")}__elementUsername;__elementUsernameHeader;__elementPassword;__elementPasswordHeader;__elementGroups;__elementGroupsHeader;__elementGroupList;__elementGroupListInfo;__elementLocale;__elementLocaleHeader;__elementPasswordRequirements;__saveButton;__cancelButton;__advancedSwitch;__usernameInput;__newPasswordInput;__newPasswordInput_2;__forcePasswordChangeCheckbox;__localeCombobox;__clientLocaleRadioButton;__projectLocaleRadioButton;__selectionLocaleRadioButton;__groupList=[];__groupCheckboxes=new Map;__groupConfigurations=[];__groupCheckboxEventDestroyer=[];__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__showControlsBasedOnApiAccess(),this.__createPasswordRequirementsElement(),this.__updateSaveButton(),setTimeout((()=>{this.__setGroupScrollData()}),50)}destroy(){this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],super.destroy()}__showControlsBasedOnApiAccess(){TcHmi.Server.UserManagement.getApiAccess({domain:this.__selectedDomain},(data=>{data.error===TcHmi.Errors.NONE&&data.result&&(data.result.addUser.general?(this.__elementContent.classList.remove("not-displayed"),this.__elementPassword.classList.remove("not-displayed")):(this.__elementContent.classList.add("not-displayed"),this.__elementPassword.classList.remove("not-displayed")),data.result.addUser.groups&&data.result.listUserGroups.general?(this.__elementGroups.classList.remove("not-displayed"),this.__createUserGroupSelection()):this.__elementGroups.classList.add("not-displayed"),data.result.addUser.locale?this.__elementLocale.classList.remove("not-displayed"):this.__elementLocale.classList.add("not-displayed"))}))}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updateSaveButton(){const newPassword=this.__newPasswordInput.getText(),newPassword2=this.__newPasswordInput_2.getText();if(!this.__elementPasswordRequirements)return void this.__saveButton.setIsEnabled(!0);let customRuleValues=new Map;customRuleValues.set("RepeatPassword",newPassword===newPassword2&&(newPassword??"").length>0),this.__elementPasswordRequirements.validate(newPassword??"",customRuleValues)&&this.__usernameInput.getText()?this.__saveButton.setIsEnabled(!0):this.__saveButton.setIsEnabled(!1)}__createPasswordRequirementsElement(){if(this.__elementPasswordRequirements?.remove(),!this.__parentControl)return;let customRules=new Map;customRules.set("RepeatPassword",this.__localizedTexts?.passwordRequirementsRepitition??""),this.__elementPasswordRequirements=new TcHmiUserManagementPopups.PasswordRequirements(this.__parentControl,customRules,(()=>{this.__updateSaveButton()})),this.__elementPasswordRequirements.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline}),this.__elementPassword.append(this.__elementPasswordRequirements)}__createUserGroupSelection(){this.__isShowing&&TcHmi.Server.UserManagement.listUserGroups((data=>{if(data.error===TcHmi.Errors.NONE){if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);this.__advanced||(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),tchmi_equal(this.__groupList,newGroupList)&&0!==newGroupList.length||(this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__elementGroupList.textContent="",this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementGroupListInfo.remove(),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)})),this.__groupConfigurations.forEach((group=>{this.__groupCheckboxes.get(group)?.setToggleState("Active")}))):this.__elementGroupList.append(this.__elementGroupListInfo),this.__setGroupScrollData())}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserGroupError?this.__localizedTexts?.feedbackPromptListUserGroupError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserGroupError??"",formatValues:[error,message]}}),this.__feedbackPrompt.prompt(),this.__elementGroups.classList.add("not-displayed")}}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__name+".UserGroupCheckbox_AddUser_Popup"+name)){let checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__name+".UserGroupCheckbox_AddUser_Popup"+name,{"data-tchmi-text":name,"data-tchmi-toggle-state":"Normal"},this.__parentControl);checkbox&&(this.__groupCheckboxes?.set(name,checkbox),this.__elementGroupList.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{"Normal"===checkbox.getToggleState()?this.__groupConfigurations=this.__groupConfigurations.filter((group=>group!==groupName)):this.__groupConfigurations.includes(groupName)||this.__groupConfigurations.push(groupName)}}__createLocalizationSelection(){this.__localeCombobox.setIsEnabled(!1);let locales=TcHmi.Locale.getRegisteredLocales();locales.sort();let currentLocale=TcHmi.Locale.get();this.__localeCombobox.setSrcData(locales);for(let i=0;i<locales.length;i++){let userConfig=TcHmi.Server.getCurrentUserConfig();userConfig&&userConfig.locale?locales[i].includes(userConfig.locale)&&this.__localeCombobox.setSelectedIndex(i):locales[i]===currentLocale&&this.__localeCombobox.setSelectedIndex(i)}}__checkLocaleRadioButtons(){let locale,userconfig=TcHmi.Server.getCurrentUserConfig();return locale=userconfig?userconfig.locale:"client",locale=this.__clientLocaleRadioButton&&"Active"===this.__clientLocaleRadioButton.getRadioState()?"client":this.__projectLocaleRadioButton&&"Active"===this.__projectLocaleRadioButton.getRadioState()?"project":this.__selectionLocaleRadioButton&&"Active"===this.__selectionLocaleRadioButton.getRadioState()&&this.__localeCombobox?this.__localeCombobox.getSelectedValue():void 0,locale}__onGroupScroll=e=>{this.__setGroupScrollData()};__setGroupScrollData(){this.__elementGroupList.clientHeight+this.__elementGroupList.scrollTop===this.__elementGroupList.scrollHeight?this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"none":"bottom":this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"top":"center"}__onRadioStateLocaleChanged=()=>{"Active"===this.__selectionLocaleRadioButton.getRadioState()?this.__localeCombobox.setIsEnabled(!0):this.__localeCombobox.setIsEnabled(!1)};__onAdvanced=()=>{this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__createUserGroupSelection()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}setDomain(domain){super.setDomain(domain),this.__showControlsBasedOnApiAccess()}__onSaveUp=()=>{if(this.__usernameInput&&this.__newPasswordInput&&this.__newPasswordInput_2){const username=this.__usernameInput.getText(),password1=this.__newPasswordInput.getText(),password2=this.__newPasswordInput_2.getText(),forcePasswordChange="Active"===this.__forcePasswordChangeCheckbox?.getToggleState();if(!username)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptEnterUsername}),void this.__feedbackPrompt.prompt();if(!password1||""===password1||!password2||""===password2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptBothPasswords}),void this.__feedbackPrompt.prompt();if(password1!==password2)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPasswordMatch}),void this.__feedbackPrompt.prompt();{let groupsToAdd=this.__groupConfigurations;if(0===groupsToAdd.length)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptUserGroup}),void this.__feedbackPrompt.prompt();let timeZone,locale=this.__checkLocaleRadioButtons();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails){let keys=Object.keys(data.userDetails);for(let name of keys)if(name===username)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUsernameExists?this.__localizedTexts?.feedbackPromptUsernameExists.symbolExpression:this.__localizedTexts?.feedbackPromptUsernameExists??"",formatValues:[username]}}),void this.__feedbackPrompt.prompt()}TcHmi.Server.UserManagement.addUserEx(username,password1,{groups:groupsToAdd,locale:locale,timeZone:timeZone,domain:this.__selectedDomain},{timeout:2e3},(data=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);return TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserAddedError?this.__localizedTexts?.feedbackPromptUserAddedError.symbolExpression:this.__localizedTexts?.feedbackPromptUserAddedError??"",formatValues:[result.error,result.message]}}),void this.__feedbackPrompt.prompt()}{let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage","SendWriteValue","Add"],symbol:`TcHmiSrv.Config::USERGROUPUSERS::${this.__selectedDomain}::${username}::USERGROUPUSERS_FORCE_PASSWORD_CHANGE`,writeValue:forcePasswordChange}]};TcHmi.Server.request(request,(data=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserError?this.__localizedTexts?.feedbackPromptListUserError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserError??"",formatValues:[result.error,result.message]}}),this.__feedbackPrompt.prompt()}else this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserAdded?this.__localizedTexts?.feedbackPromptUserAdded.symbolExpression:this.__localizedTexts?.feedbackPromptUserAdded??"",formatValues:[username]}}),this.__feedbackPrompt.prompt(),this.__resetControls(),this.hide()}))}}))}else{const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserError?this.__localizedTexts?.feedbackPromptListUserError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserError??"",formatValues:[result.error,result.message]}}),this.__feedbackPrompt.prompt()}}))}}};__getErrorAndMessage(data){let error=data.error,message="";return data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),{error:error,message:message}}__resetControls(){this.__usernameInput?.setText(""),this.__newPasswordInput?.setText(""),this.__newPasswordInput_2?.setText(""),this.__clientLocaleRadioButton?.setRadioState("Active");let currentUserConfig=TcHmi.Server.getCurrentUserConfig();this.__groupConfigurations=[currentUserConfig.defaultUserGroup],this.__groupCheckboxes.forEach(((checkbox,group)=>{"__SystemUsers"===group?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")})),this.__forcePasswordChangeCheckbox?.setToggleState("Normal")}__onCancelUp=()=>{this.__resetControls(),this.hide()};__updateFontSizes(){super.__updateFontSizes(),this.__localeCombobox.setDropDownFontSize(this.__textFontSize),this.__localeCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("usernameHeaderText",texts.usernameHeaderText,this.__elementUsernameHeader),this.__applyTextToElement("passwordHeaderText",texts.passwordHeaderText,this.__elementPasswordHeader),this.__applyTextToElement("localizationHeaderText",texts.localizationHeaderText,this.__elementLocaleHeader),this.__applyTextToElement("userGroupsHeaderText",texts.userGroupsHeaderText,this.__elementGroupsHeader),this.__applyTextToElement("popupFeedbackNoGroupsToAdjust",texts.popupFeedbackNoGroupsToAdjust,this.__elementGroupListInfo),this.__applyTextToControl("saveButtonText",texts.saveButton?.text,this.__saveButton,"Text"),this.__applyTextToControl("saveButtonTooltip",texts.saveButton?.tooltip,this.__saveButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("usernameInputPlaceholder",texts.usernameInputPlaceholder,this.__usernameInput,"Placeholder"),this.__applyTextToControl("newPasswordInputPlaceholder",texts.newPasswordInputPlaceholder,this.__newPasswordInput,"Placeholder"),this.__applyTextToControl("newPasswordInput2Placeholder",texts.newPasswordInput2Placeholder,this.__newPasswordInput_2,"Placeholder"),this.__applyTextToControl("forcePasswordChangeCheckboxtext",texts.forcePasswordChangeCheckboxtext,this.__forcePasswordChangeCheckbox,"Text"),this.__applyTextToControl("clientLocaleRadioButtonText",texts.clientLocaleRadioButtonText,this.__clientLocaleRadioButton,"Text"),this.__applyTextToControl("projectLocaleRadioButtonText",texts.projectLocaleRadioButtonText,this.__projectLocaleRadioButton,"Text"),this.__elementPasswordRequirements?.setTexts({headerText:this.__localizedTexts?.passwordRequirementsHeadline})}}TcHmiUserManagementPopups.AddUserPopup=AddUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class DeleteUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementUserSelection=document.createElement("div"),this.__elementUserSelection.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementUserSelectionHeader=document.createElement("h2"),this.__elementUserSelection.append(this.__elementUserSelectionHeader),this.__elementContent.append(this.__elementUserSelection);const deleteButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.deleteButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.userCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl);if(!(deleteButton&&cancelButton&&advancedSwitch&&userCombobox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced)),this.__deleteButton=deleteButton;const deleteButtonElement=this.__deleteButton.getElement()[0];deleteButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(deleteButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__deleteButton.getId()+".onPressed",this.__onConfirm)),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancel)),this.__userCombobox=userCombobox,this.__elementUserSelection.append(this.__userCombobox.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__userCombobox.getId()+".onSelectionChanged",this.__onUserCombobox))}__elementUserSelection;__elementUserSelectionHeader;__deleteButton;__cancelButton;__advancedSwitch;__userCombobox;__selectedUserName;__deleteConfirmationPrompt=null;__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__updateComboboxData()}destroy(){super.destroy()}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updateComboboxData(){if(!this.__isShowing)return;let currentSelection=this.__userCombobox?.getSelectedValue();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{(async()=>{if(data.error===TcHmi.Errors.NONE){if(data.userDetails){let userList=Object.keys(data.userDetails);"Normal"===this.__advancedSwitch?.getToggleState()&&(userList=userList.filter((user=>!user.startsWith("__")))),userList.sort();let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(currentUserConfigurations?.name){let userIndex=userList.indexOf(currentUserConfigurations.name);-1!==userIndex&&userList.splice(userIndex,1)}this.__userCombobox&&this.__userCombobox.setSrcData(userList)}}else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserError?this.__localizedTexts?.feedbackPromptListUserError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserError??"",formatValues:[error,message]}}),await this.__feedbackPrompt.prompt(),this.hide()}if(currentSelection){let srcData=this.__userCombobox?.getSrcData();if(srcData&&srcData.length>0&&currentSelection){let index=srcData.indexOf(currentSelection);-1!==index?this.__userCombobox?.setSelectedIndex(index):this.__userCombobox?.setSelectedIndex(0)}else this.__userCombobox?.setSelectedIndex(null)}})()}))}__onUserCombobox=()=>{this.__updatePopupControls()};__updatePopupControls(){this.__userCombobox&&(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName?this.__deleteButton?.setIsEnabled(!0):this.__deleteButton?.setIsEnabled(!1))}__deleteUser(username){TcHmi.Server.UserManagement.removeUserEx(username,{domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE)this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserDeleted?this.__localizedTexts?.feedbackPromptUserDeleted.symbolExpression:this.__localizedTexts?.feedbackPromptUserDeleted??"",formatValues:[username]}}),this.__feedbackPrompt.prompt(),this.__updateComboboxData();else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserNotDeleted?this.__localizedTexts?.feedbackPromptUserNotDeleted.symbolExpression:this.__localizedTexts?.feedbackPromptUserNotDeleted??"",formatValues:[error,message,this.__selectedUserName]}}),this.__feedbackPrompt.prompt()}}))}__onConfirm=()=>{(async()=>{if(this.__selectedUserName){this.__deleteConfirmationPrompt||(this.__deleteConfirmationPrompt=new Controls.Helpers.TextAndButtonsPrompt({yes:{value:!0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30}},no:{value:!1,attributes:{"data-tchmi-width":60,"data-tchmi-height":30}}},this.__parentControl),this.__deleteConfirmationPrompt.setBackgroundAction({close:!0,action:"no"}),this.__deleteConfirmationPrompt.setTexts({headerText:this.__localizedTexts?.deleteConfirmationPromptHeaderText,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.deleteConfirmationPromptContentText?this.__localizedTexts?.deleteConfirmationPromptContentText.symbolExpression:this.__localizedTexts?.deleteConfirmationPromptContentText??"",formatValues:[this.__selectedUserName]},buttons:{yes:{text:this.__localizedTexts?.deleteConfirmationPromptButtonDelete?.text,tooltip:this.__localizedTexts?.deleteConfirmationPromptButtonDelete?.tooltip},no:{text:this.__localizedTexts?.deleteConfirmationPromptButtonClose?.text,tooltip:this.__localizedTexts?.deleteConfirmationPromptButtonClose?.tooltip}}}));await this.__deleteConfirmationPrompt.prompt()&&this.__deleteUser(this.__selectedUserName)}})()};__onAdvanced=()=>{this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__updateComboboxData()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}setDomain(domain){super.setDomain(domain),this.__updateComboboxData()}__onCancel=()=>{this.hide()};__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox.setDropDownFontSize(this.__textFontSize),this.__userCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("userSelectionHeaderText",texts.userSelectionHeaderText,this.__elementUserSelectionHeader),this.__applyTextToControl("deleteButtonText",texts.deleteButton?.text,this.__deleteButton,"Text"),this.__applyTextToControl("deleteButtonTooltip",texts.deleteButton?.tooltip,this.__deleteButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("userComboboxPlaceholder",texts.userComboboxPlaceholder,this.__userCombobox,"ComboboxText")}}TcHmiUserManagementPopups.DeleteUserPopup=DeleteUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class ChangeUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementUserSelection=document.createElement("div"),this.__elementUserSelection.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementUserSelectionHeader=document.createElement("h2"),this.__elementUserSelection.append(this.__elementUserSelectionHeader),this.__elementPassword=document.createElement("div"),this.__elementPassword.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementPasswordHeader=document.createElement("h2"),this.__elementPassword.append(this.__elementPasswordHeader),this.__elementGroups=document.createElement("div"),this.__elementGroups.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementGroupsHeader=document.createElement("h2"),this.__elementGroupList=document.createElement("div"),this.__elementGroupList.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-groups"),this.__elementGroups.append(this.__elementGroupsHeader,this.__elementGroupList),this.__elementGroupListInfo=document.createElement("div"),this.__destroyers.push(TcHmi.EventProvider.registerDomEvent(this.__elementGroupList,"scroll",this.__onGroupScroll)),this.__elementContent.append(this.__elementUserSelection,this.__elementPassword,this.__elementGroups);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.saveButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.userCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),forcePasswordChangeCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",`${this.__name}.forcePasswordChangeCheckbox`,null,this.__parentControl);if(!(saveButton&&cancelButton&&advancedSwitch&&userCombobox&&forcePasswordChangeCheckbox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced)),this.__saveButton=saveButton;const saveButtonElement=this.__saveButton.getElement()[0];saveButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(saveButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__saveButton.getId()+".onPressed",this.__onConfirm)),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancel)),this.__userCombobox=userCombobox,this.__elementUserSelection.append(this.__userCombobox.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__userCombobox.getId()+".onSelectionChanged",this.__onUserCombobox)),this.__forcePasswordChangeCheckbox=forcePasswordChangeCheckbox,this.__elementPassword.append(this.__forcePasswordChangeCheckbox.getElement()[0])}__elementUserSelection;__elementUserSelectionHeader;__elementPassword;__elementPasswordHeader;__elementGroups;__elementGroupsHeader;__elementGroupList;__elementGroupListInfo;__saveButton;__cancelButton;__advancedSwitch;__userCombobox;__forcePasswordChangeCheckbox;__groupList=null;__groupCheckboxes=new Map;__userList={};__selectedUserDetails;__selectedUserName;__groupConfigurations=new Map;__groupCheckboxEventDestroyer=[];__apiAccessResult;__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__groupConfigurations.clear(),this.__showControlsBasedOnApiAccess(),setTimeout((()=>{this.__setGroupScrollData()}),50)}__showControlsBasedOnApiAccess(){if(!this.__isShowing)return;let domain=TcHmi.Server.getCurrentUserConfig().domain;TcHmi.Server.UserManagement.getApiAccess({domain:domain??void 0},(data=>{this.__apiAccessResult=data,data.error===TcHmi.Errors.NONE&&data.result&&(data.result.listUsers.general&&data.result.listUsers.groups&&data.result.listUserGroups.general&&data.result.updateUser.removeGroups&&data.result.updateUser.addGroups?(this.__elementGroups.classList.remove("not-displayed"),this.__elementPassword.classList.remove("not-displayed"),this.__updateComboboxData(),this.__createUserGroupSelection()):this.hide())}))}destroy(){this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],super.destroy()}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updateComboboxData(){let currentSelection=this.__userCombobox.getSelectedValue();TcHmi.Server.UserManagement.listUsersEx({domain:this.__selectedDomain},null,(data=>{(async()=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserError?this.__localizedTexts?.feedbackPromptListUserError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserError??"",formatValues:[result.error,result.message]}}),await this.__feedbackPrompt.prompt(),this.hide()}else{data.userDetails&&(this.__userList=data.userDetails);let users=Object.keys(this.__userList);"Normal"===this.__advancedSwitch.getToggleState()&&(users=users.filter((user=>!user.startsWith("__")))),users.sort(),this.__userCombobox.setSrcData(users),users.length>0?this.__userCombobox.setSelectedIndex(0):this.__userCombobox.setSelectedIndex(null)}let srcData=this.__userCombobox.getSrcData();if(srcData&&srcData.length>0&&currentSelection){let index=srcData.indexOf(currentSelection);-1!==index?this.__userCombobox.setSelectedIndex(index):this.__userCombobox.setSelectedIndex(0)}else this.__userCombobox.setSelectedIndex(null);this.__updatePopupControls()})()}))}__onUserCombobox=()=>{this.__updatePopupControls()};__updatePopupControls(){if(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName){let user=this.__userList[this.__selectedUserName];if(user){this.__selectedUserDetails=user;let userGroupsConfig=this.__groupConfigurations.get(this.__selectedUserName);return userGroupsConfig||(userGroupsConfig=this.__selectedUserDetails?.groups?[...this.__selectedUserDetails.groups]:[],this.__groupConfigurations.set(this.__selectedUserName,userGroupsConfig)),this.__saveButton.setIsEnabled(!0),this.__groupCheckboxes.forEach(((checkbox,group)=>{checkbox.setTooltip(null),checkbox.setIsEnabled(!0),userGroupsConfig?.includes(group)?checkbox.setToggleState("Active"):checkbox.setToggleState("Normal")})),"__SystemGuest"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemGuests")?.setIsEnabled(!1),"__SystemUser"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemUsers")?.setIsEnabled(!1),"__SystemAdministrator"===this.__selectedUserName&&this.__groupCheckboxes.get("__SystemAdministrators")?.setIsEnabled(!1),void this.__updateForcePasswordChange()}}this.__selectedUserDetails=void 0,this.__saveButton.setIsEnabled(!1),this.__groupCheckboxes.forEach((checkbox=>{checkbox.setIsEnabled(!1),checkbox.setToggleState("Normal"),checkbox.setTooltip(TcHmi.Symbol.read("Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser",TcHmi.SymbolType.LocalizedText)??null)})),this.__updateForcePasswordChange()}__updateForcePasswordChange(){let username=this.__selectedUserName;if(!username)return this.__forcePasswordChangeCheckbox.setIsEnabled(!1),void this.__forcePasswordChangeCheckbox.setToggleState("Normal");this.__forcePasswordChangeCheckbox.setIsEnabled(!0);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage","SendWriteValue"],symbol:`TcHmiSrv.Config::USERGROUPUSERS::${this.__selectedDomain}::${username}::USERGROUPUSERS_FORCE_PASSWORD_CHANGE`}]};TcHmi.Server.request(request,(data=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserGroupError?this.__localizedTexts?.feedbackPromptListUserGroupError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserGroupError??"",formatValues:[result.error,result.message]}}),this.__feedbackPrompt.prompt()}else username===this.__selectedUserName&&this.__forcePasswordChangeCheckbox.setToggleState(!0===data.response?.commands?.[0].readValue?"Active":"Normal")}))}__createUserGroupSelection(){TcHmi.Server.UserManagement.listUserGroups((data=>{(async()=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptListUserGroupError?this.__localizedTexts?.feedbackPromptListUserGroupError.symbolExpression:this.__localizedTexts?.feedbackPromptListUserGroupError??"",formatValues:[result.error,result.message]}}),await this.__feedbackPrompt.prompt(),this.hide()}else if(data.groupDetailsList){let newGroupList=Object.keys(data.groupDetailsList);"Normal"===this.__advancedSwitch.getToggleState()&&(newGroupList=newGroupList.filter((group=>!group.startsWith("__")))),tchmi_equal(this.__groupList,newGroupList)||(this.__groupCheckboxEventDestroyer.forEach((destroyer=>{destroyer()})),this.__groupCheckboxEventDestroyer=[],this.__groupCheckboxes.forEach((checkbox=>{checkbox.destroy()})),this.__groupCheckboxes.clear(),this.__groupList=newGroupList,this.__groupList.length>0?(this.__elementGroupList.textContent="",this.__elementGroupListInfo.remove(),this.__groupList.forEach((group=>{this.__createGroupCheckbox(group)}))):this.__elementGroupList.append(this.__elementGroupListInfo),this.__updatePopupControls(),this.__setGroupScrollData())}})()}))}__createGroupCheckbox(name){if(void 0===TcHmi.Controls.get(this.__name+".UserGroupCheckbox_"+name)){let checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__name+".UserGroupCheckbox_"+name,{"data-tchmi-text":name,"data-tchmi-toggle-state":"Normal"},this.__parentControl);checkbox&&(this.__groupCheckboxes.set(name,checkbox),this.__elementGroupList.append(checkbox.getElement()[0]),this.__groupCheckboxEventDestroyer.push(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onGroupCheckbox(checkbox,name))))}}__onGroupCheckbox(checkbox,groupName){return()=>{if(this.__selectedUserName){let userGroupsConfig=this.__groupConfigurations.get(this.__selectedUserName);"Normal"===checkbox.getToggleState()&&userGroupsConfig?this.__groupConfigurations.set(this.__selectedUserName,userGroupsConfig.filter((group=>group!==groupName))):userGroupsConfig&&!userGroupsConfig.includes(groupName)&&userGroupsConfig.push(groupName)}}}__updateUser(username,groupsToAdd,groupsToRemove,forcePasswordChange){let updateData={};groupsToAdd&&groupsToAdd.length>0&&(updateData.addGroups=groupsToAdd),groupsToRemove&&groupsToRemove.length>0&&(updateData.removeGroups=groupsToRemove),updateData.domain=this.__selectedDomain,username&&updateData&&TcHmi.Server.UserManagement.updateUser(username,updateData,(data=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated?this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated??"",formatValues:[result.error,result.message,result.reason,username]}}),this.__feedbackPrompt.prompt()}else{let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage","SendWriteValue"],symbol:`TcHmiSrv.Config::USERGROUPUSERS::${this.__selectedDomain}::${username}`,writeValue:{USERGROUPUSERS_FORCE_PASSWORD_CHANGE:forcePasswordChange}}]};TcHmi.Server.request(request,(data=>{if(data.error!==TcHmi.Errors.NONE){const result=this.__getErrorAndMessage(data);TcHmi.Log.buildMessage(data.details),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated?this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserGroupsNotUpdated??"",formatValues:[result.error,result.message,result.reason,username]}}),this.__feedbackPrompt.prompt()}else this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserInformationUpdated?this.__localizedTexts?.feedbackPromptUserInformationUpdated.symbolExpression:this.__localizedTexts?.feedbackPromptUserInformationUpdated??"",formatValues:[username]}}),this.__feedbackPrompt.prompt(),username===TcHmi.Server.getCurrentUserConfig().name&&this.__showControlsBasedOnApiAccess()}))}}))}__getErrorAndMessage(data){let error=data.error,message="",reason="";return data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")"),data.details.errors[0].reason&&(reason=data.details.errors[0].reason)),{error:error,message:message,reason:reason}}__onConfirm=()=>{let groupsToAdd=[],groupsToRemove=[];this.__groupCheckboxes&&this.__selectedUserDetails&&(groupsToRemove=this.__selectedUserDetails.groups.filter((group=>"Normal"===this.__groupCheckboxes.get(group)?.getToggleState())),groupsToAdd=this.__groupList?.filter((group=>"Active"===this.__groupCheckboxes.get(group)?.getToggleState()&&!this.__selectedUserDetails.groups.includes(group)))??[]),this.__selectedUserName&&this.__updateUser(this.__selectedUserName,groupsToAdd,groupsToRemove,"Active"===this.__forcePasswordChangeCheckbox.getToggleState())};__onAdvanced=()=>{this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__showControlsBasedOnApiAccess()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}setDomain(domain){super.setDomain(domain),this.__isShowing&&this.__showControlsBasedOnApiAccess()}__onGroupScroll=e=>{this.__setGroupScrollData()};__setGroupScrollData(){this.__elementGroupList.clientHeight+this.__elementGroupList.scrollTop===this.__elementGroupList.scrollHeight?this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"none":"bottom":this.__elementGroupList.dataset.scroll=0===this.__elementGroupList.scrollTop?"top":"center"}__onCancel=()=>{this.hide()};__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox.setDropDownFontSize(this.__textFontSize),this.__userCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("userSelectionHeaderText",texts.userSelectionHeaderText,this.__elementUserSelectionHeader),this.__applyTextToElement("passwordHeaderText",texts.passwordHeaderText,this.__elementPasswordHeader),this.__applyTextToElement("userGroupsHeaderText",texts.userGroupsHeaderText,this.__elementGroupsHeader),this.__applyTextToControl("saveButtonText",texts.saveButton?.text,this.__saveButton,"Text"),this.__applyTextToControl("saveButtonTooltip",texts.saveButton?.tooltip,this.__saveButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("userComboboxPlaceholder",texts.userComboboxPlaceholder,this.__userCombobox,"ComboboxText"),this.__applyTextToElement("popupFeedbackNoGroupsToAdjust",texts.popupFeedbackNoGroupsToAdjust,this.__elementGroupListInfo),this.__applyTextToControl("forcePasswordChangeCheckboxtext",texts.forcePasswordChangeCheckboxtext,this.__forcePasswordChangeCheckbox,"Text")}}TcHmiUserManagementPopups.ChangeUserPopup=ChangeUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class SwitchUserPopup extends TcHmiUserManagementPopups.UserManagementPopup{constructor(parentControl){super(parentControl),this.__elementDomain=document.createElement("div"),this.__elementDomain.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementDomainHeader=document.createElement("h2"),this.__elementDomain.append(this.__elementDomainHeader),this.__elementUsername=document.createElement("div"),this.__elementUsername.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementUsernameHeader=document.createElement("h2"),this.__elementUsername.append(this.__elementUsernameHeader),this.__elementPassword=document.createElement("div"),this.__elementPassword.classList.add("TcHmi_Controls_Beckhoff_TcHmiUserManagement-popup-content"),this.__elementPasswordHeader=document.createElement("h2"),this.__elementPassword.append(this.__elementPasswordHeader),this.__elementContent.append(this.__elementDomain,this.__elementUsername,this.__elementPassword);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.saveButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-is-enabled":!0,"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Save%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Save%/l%"},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.cancelButton`,{"data-tchmi-height":30,"data-tchmi-width-mode":"Content","data-tchmi-min-width":60,"data-tchmi-text-padding":{left:7,right:7},"data-tchmi-ignore-escape-sequences":!0,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Cancel%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupButton_Cancel%/l%"},this.__parentControl),advancedSwitch=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleSwitch",`${this.__name}.advancedSwitch`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupToggleSwitch_Advanced%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupAdvancedToggleSwitchTooltip_SwitchUser%/l%"},this.__parentControl),usernameInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiInput",`${this.__name}.usernameInput`,{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_EnterYourUserName%/l%"},this.__parentControl),passwordInput=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiPasswordInput",`${this.__name}.passwordInput`,{"data-tchmi-placeholder":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_Password%/l%"},this.__parentControl),userCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.userCombobox`,{"data-tchmi-combobox-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::PopupPlaceholder_SelectAUser%/l%","data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl),domainCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__name}.domainCombobox`,{"data-tchmi-drop-down-font-size":this.__textFontSize,"data-tchmi-drop-down-font-size-unit":this.__textFontSizeUnit},this.__parentControl);if(!(saveButton&&cancelButton&&advancedSwitch&&usernameInput&&passwordInput&&userCombobox&&domainCombobox))throw new Error("Could not create controls for EditUserPopup.");this.__advancedSwitch=advancedSwitch;const advancedSwitchElement=this.__advancedSwitch.getElement()[0];advancedSwitchElement.classList.add("advanced-switch"),this.__elementFooter.append(advancedSwitchElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__advancedSwitch.getId()+".onToggleStateChanged",this.__onAdvanced)),this.__saveButton=saveButton;const saveButtonElement=this.__saveButton.getElement()[0];saveButtonElement.classList.add("confirmbutton"),this.__elementFooter.append(saveButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__saveButton.getId()+".onPressed",this.__onConfirm)),this.__cancelButton=cancelButton;const cancelButtonElement=this.__cancelButton.getElement()[0];cancelButtonElement.classList.add("cancelbutton"),this.__elementFooter.append(cancelButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(this.__cancelButton.getId()+".onPressed",this.__onCancel)),this.__userCombobox=userCombobox,this.__destroyers.push(TcHmi.EventProvider.register(this.__userCombobox.getId()+".onSelectionChanged",this.__onUserCombobox)),this.__usernameInput=usernameInput,this.__passwordInput=passwordInput,this.__elementPassword.append(this.__passwordInput.getElement()[0]),this.__domainCombobox=domainCombobox,this.__elementDomain.append(this.__domainCombobox.getElement()[0]),this.__destroyers.push(TcHmi.EventProvider.register(this.__domainCombobox.getId()+".onSelectionChanged",this.__onDomainSelectionChanged)),this.__updateUserSelection()}__elementDomain;__elementDomainHeader;__elementUsername;__elementUsernameHeader;__elementPassword;__elementPasswordHeader;__saveButton;__cancelButton;__advancedSwitch;__userCombobox;__usernameInput;__passwordInput;__domainCombobox;__selectedUserName;__userSelectType="Input";__advanced=!1;__advancedChangeCallbacks=new Controls.Helpers.CallbackManager;onAdvancedChanged=this.__advancedChangeCallbacks.getManipulators();__localizedTexts=null;show(){super.show(),this.__updateDomains()}destroy(){super.destroy()}__performPromptAction(toPerform){this.__onHideManager.trigger()}__updateDomains(){TcHmi.Server.readSymbol("ListDomains",(data=>{const domainList=data.response?.commands?.[0].readValue;if(data.error===TcHmi.Errors.NONE&&domainList){const domains=[];for(let[domainName,domain]of Object.entries(domainList))domain?.authExtension&&domains.push(domainName);if(domains.length<1)this.__elementDomain.classList.add("not-displayed"),this.__selectedDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension;else if(1===domains.length)this.__selectedDomain=domains[0],this.__elementDomain.classList.add("not-displayed");else{let defaultDomain=TcHmi.Server.getCurrentUserConfig().defaultAuthExtension;if(this.__domainCombobox){this.__elementDomain.classList.remove("not-displayed"),this.__domainCombobox.setSrcData(domains);let index=domains.findIndex((x=>x===defaultDomain))??0;this.__domainCombobox.setSelectedIndex(index)}}}this.__updateUserSelection()}))}__updateUserSelection(){this.__isShowing&&TcHmi.Server.readSymbol("UserSelectType",(data=>{data.error!==TcHmi.Errors.NONE||0!==data.results?.[0].value?this.__showSelectionInput():this.__showSelectionCombobox()}))}__showSelectionCombobox(){this.__userSelectType="Combobox",this.__usernameInput.getElement()[0].remove(),this.__elementUsername.append(this.__userCombobox.getElement()[0]),this.__advancedSwitch.setVisibility("Visible"),this.__updateComboboxData()}__showSelectionInput(){this.__userSelectType="Input",this.__userCombobox.getElement()[0].remove(),this.__elementUsername.append(this.__usernameInput.getElement()[0]),this.__advancedSwitch.setVisibility("Collapsed"),this.__saveButton.setIsEnabled(!0)}__updateComboboxData(){let currentSelection=this.__userCombobox.getSelectedValue();TcHmi.Server.UserManagement.listUsernamesEx({domain:this.__selectedDomain},null,(data=>{if(data.error===TcHmi.Errors.NONE){if(data.userList){let userList=data.userList.sort();"Normal"===this.__advancedSwitch.getToggleState()&&(userList=userList.filter((user=>!user.startsWith("__"))));let currentUserConfigurations=TcHmi.Server.getCurrentUserConfig();if(currentUserConfigurations.name){let userIndex=userList.indexOf(currentUserConfigurations.name);-1!==userIndex&&userList.splice(userIndex,1)}this.__userCombobox&&this.__userCombobox.setSrcData(userList)}}else this.__showSelectionInput();let srcData=this.__userCombobox.getSrcData();if(srcData&&srcData.length>0&&currentSelection){let index=srcData.indexOf(currentSelection);-1!==index?this.__userCombobox.setSelectedIndex(index):this.__userCombobox.setSelectedIndex(null)}else this.__userCombobox.setSelectedIndex(null)}))}__onUserCombobox=()=>{this.__updatePopupControls()};__updatePopupControls(){this.__userCombobox&&(this.__selectedUserName=this.__userCombobox.getSelectedValue(),this.__selectedUserName?this.__saveButton.setIsEnabled(!0):this.__saveButton.setIsEnabled(!1))}__onConfirm=()=>{if(this.__usernameInput&&"Input"===this.__userSelectType&&(this.__selectedUserName=this.__usernameInput.getText()),!this.__selectedUserName||""===this.__selectedUserName)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptUsername}),void this.__feedbackPrompt.prompt();let password=this.__passwordInput.getText();if(!password||""===password)return this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:this.__localizedTexts?.feedbackPromptPassword}),void this.__feedbackPrompt.prompt();TcHmi.Server.loginEx2((this.__selectedDomain?this.__selectedDomain+"::":"")+this.__selectedUserName,password,!0,!1,null,(data=>{if(data.error===TcHmi.Errors.NONE)this.__updateUserSelection(),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineSuccess,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserSwitched?this.__localizedTexts?.feedbackPromptUserSwitched.symbolExpression:this.__localizedTexts?.feedbackPromptUserSwitched??"",formatValues:[this.__selectedUserName]}}),this.__feedbackPrompt.prompt();else{let error=data.error,message="";data.details?.errors?.[0]&&(data.details.errors[0].code&&(error=data.details.errors[0].code),data.details.errors[0].message&&(message=" ("+data.details.errors[0].message+")")),TcHmi.Log.error("login failed "+TcHmi.Log.buildMessage(data.details)),this.__feedbackPrompt||(this.__feedbackPrompt=this.__createFeedbackPrompt()),this.__feedbackPrompt.setTexts({headerText:this.__localizedTexts?.feedbackPromptHeadlineFailed,contentText:{symbolExpression:"object"==typeof this.__localizedTexts?.feedbackPromptUserNotSwitched?this.__localizedTexts?.feedbackPromptUserNotSwitched.symbolExpression:this.__localizedTexts?.feedbackPromptUserNotSwitched??"",formatValues:[error,message]}}),this.__feedbackPrompt.prompt()}}))};__onAdvanced=()=>{this.__advanced="Active"===this.__advancedSwitch.getToggleState(),this.__advancedChangeCallbacks.trigger(this.__advanced),this.__updateUserSelection()};setAdvanced(advanced){advanced!==this.__advanced&&(this.__advanced=advanced,this.__advancedSwitch.setToggleState(this.__advanced?"Active":"Normal"))}__onCancel=()=>{this.hide()};__onDomainSelectionChanged=()=>{this.__selectedDomain=this.__domainCombobox.getSelectedValue()??TcHmi.Server.getCurrentUserConfig().defaultAuthExtension,this.__updateUserSelection()};__updateFontSizes(){super.__updateFontSizes(),this.__userCombobox.setDropDownFontSize(this.__textFontSize),this.__userCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit),this.__domainCombobox.setDropDownFontSize(this.__textFontSize),this.__domainCombobox.setDropDownFontSizeUnit(this.__textFontSizeUnit)}setTexts(texts){super.setTexts(texts),this.__applyTextToElement("domainHeaderText",texts.domainHeaderText,this.__elementDomainHeader),this.__applyTextToElement("usernameHeaderText",texts.usernameHeaderText,this.__elementUsernameHeader),this.__applyTextToElement("passwordHeaderText",texts.passwordHeaderText,this.__elementPasswordHeader),this.__applyTextToControl("saveButtonText",texts.saveButton?.text,this.__saveButton,"Text"),this.__applyTextToControl("saveButtonTooltip",texts.saveButton?.tooltip,this.__saveButton,"Tooltip"),this.__applyTextToControl("cancelButtonText",texts.cancelButton?.text,this.__cancelButton,"Text"),this.__applyTextToControl("cancelButtonTooltip",texts.cancelButton?.tooltip,this.__cancelButton,"Tooltip"),this.__applyTextToControl("advancedSwitchText",texts.advancedSwitch?.text,this.__advancedSwitch,"Text"),this.__applyTextToControl("advancedSwitchTooltip",texts.advancedSwitch?.tooltip,this.__advancedSwitch,"Tooltip"),this.__applyTextToControl("usernameInputPlaceholder",texts.usernameInputPlaceholder,this.__usernameInput,"Placeholder"),this.__applyTextToControl("passwordInputPlaceholder",texts.passwordInputPlaceholder,this.__passwordInput,"Placeholder"),this.__applyTextToControl("userComboboxPlaceholder",texts.userComboboxPlaceholder,this.__userCombobox,"ComboboxText")}}TcHmiUserManagementPopups.SwitchUserPopup=SwitchUserPopup}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiUserManagementPopups){class PasswordRequirements extends HTMLElement{__elementHeader;__passwordComplexityRules;__passwordComplexityCheckboxes=new Map;__customRules=new Map;__parentControl;__initCallback;__eventDestroyers=[];__localizedTexts=null;__localizationSymbols=new Map;constructor(parentControl,customRules,initCallback){super(),this.__parentControl=parentControl,customRules&&(this.__customRules=customRules),this.__elementHeader=document.createElement("h3"),this.__initCallback=initCallback}connectedCallback(){"TcHmiUserManagement"===TcHmi.Server.getCurrentUserConfig().domain?TcHmi.Server.readSymbol("TcHmiUserManagement.GetComplexityRules",(data=>{data.error===TcHmi.Errors.NONE&&data.response?.commands[0]?.readValue?this.__passwordComplexityRules=data.response?.commands[0]?.readValue:(this.__passwordComplexityRules=void 0,TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=TcHmiUserManagement.GetComplexityRules] `+TcHmi.Log.buildMessage(data.details))),this.__createElement(),this.__initCallback?.()})):(this.__createElement(),this.__initCallback?.())}disconnectedCallback(){for(const[_rule,checkbox]of Object.entries(this.__passwordComplexityCheckboxes))checkbox.destroy();this.__passwordComplexityCheckboxes.clear();for(let e of this.__eventDestroyers)e();this.__eventDestroyers=[],this.__passwordComplexityRules=void 0}__createElement(){this.textContent="",this.append(this.__elementHeader);for(const[rule,text]of this.__customRules)if(!this.__passwordComplexityCheckboxes.has(rule)){const checkbox=TcHmi.Controls.get(this.__parentControl.getId()+"."+rule)??TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+"."+rule,{"data-tchmi-is-read-only":!0},this.__parentControl);if(!checkbox){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}] Could not create password requirement checkboxes.`);continue}text&&("string"==typeof text?(this.__unwatchLocalization(rule),TcHmi.Symbol.isSymbolExpression(text)?TcHmi.Binding.createEx2(text,"Text",checkbox):checkbox.setText(text)):(TcHmi.Binding.removeEx2(null,"Text",checkbox),this.__watchLocalization(rule,text,(text=>checkbox.setText(text))))),this.append(checkbox.getElement()[0]),this.__passwordComplexityCheckboxes.set(rule,checkbox)}if(this.__passwordComplexityRules)for(const[rulename,rule]of Object.entries(this.__passwordComplexityRules))if(!this.__passwordComplexityCheckboxes.has(rulename)){const checkbox=TcHmi.Controls.get(this.__parentControl.getId()+"."+rulename)??TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__parentControl.getId()+"."+rulename,null,this.__parentControl);if(!checkbox){TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}] Could not create password requirement checkboxes.`);continue}checkbox.setIsReadOnly(!0);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:"LocalizeText",writeValue:{domain:"TcHmiUserManagement",name:rulename,params:rule.localizationParameters??void 0}}]};TcHmi.Server.request(request,(data=>{data.error===TcHmi.Errors.NONE&&checkbox.setText(data.response?.commands[0].readValue??null)})),this.append(checkbox.getElement()[0]),this.__passwordComplexityCheckboxes.set(rulename,checkbox)}}validate(password,customRules){let validPassword=!0;for(const[rulename,_text]of this.__customRules){const value=customRules?.get(rulename)??!1;this.__passwordComplexityCheckboxes.get(rulename)?.setToggleState(value?"Active":"Normal"),value||(validPassword=!1)}if(this.__passwordComplexityRules)for(const[rulename,rule]of Object.entries(this.__passwordComplexityRules)){if(!rule.regex)continue;const value=new RegExp(rule.regex,"u").test(password);this.__passwordComplexityCheckboxes.get(rulename)?.setToggleState(value?"Active":"Normal"),value||(validPassword=!1)}return validPassword}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);existing?.destroyWatch(),existing?.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbolExpression),destroyWatch=symbol.watch((data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${this.__parentControl.getType()}, , Id=${this.__parentControl.getId()},\n                        SymbolExpression=${localization.symbolExpression}] `+TcHmi.Log.buildMessage(data.details));let text=data.value??"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)}));this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}setTexts(texts){this.__localizedTexts=texts,this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}__applyTextToElement(name,text,element){null!=text&&("object"==typeof text||TcHmi.Symbol.isSymbolExpression(text)?this.__watchLocalization(name,"string"==typeof text?{symbolExpression:text,formatValues:[]}:text,(text=>{element.textContent=text})):(this.__unwatchLocalization(name),element.textContent=text))}}TcHmiUserManagementPopups.PasswordRequirements=PasswordRequirements,customElements.define("tchmi-password-requirements",PasswordRequirements)}(Beckhoff.TcHmiUserManagementPopups||(Beckhoff.TcHmiUserManagementPopups={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));